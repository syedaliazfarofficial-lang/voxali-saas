

--- FILE: C:\Users\syeda\OneDrive\Desktop\Voxali New\dashboard\src\components\SuperAdmin\AddTenantModal.tsx ---

import React, { useState } from 'react';
import { supabase } from '../../lib/supabase';
import { X, Shield, Building2, Loader2 } from 'lucide-react';

interface AddTenantModalProps {
    isOpen: boolean;
    onClose: () => void;
    onCreated: () => void;
}

export const AddTenantModal: React.FC<AddTenantModalProps> = ({ isOpen, onClose, onCreated }) => {
    const [form, setForm] = useState({
        businessName: '',
        ownerEmail: '',
        ownerPassword: '',
    });
    const [creating, setCreating] = useState(false);
    const [error, setError] = useState('');

    if (!isOpen) return null;

    const handleSubmit = async (e: React.FormEvent) => {
        e.preventDefault();
        setCreating(true);
        setError('');

        try {
            const { data, error: rpcError } = await supabase.rpc('rpc_create_tenant_and_owner', {
                p_salon_name: form.businessName,
                p_owner_name: form.businessName + ' Owner',
                p_owner_email: form.ownerEmail,
                p_owner_password: form.ownerPassword,
            });

            if (rpcError) throw rpcError;
            if (data && !data.success) throw new Error(data.error);

            setForm({ businessName: '', ownerEmail: '', ownerPassword: '' });
            onCreated();
            onClose();
        } catch (err: any) {
            console.error('Error creating tenant:', err);
            setError(err.message || 'Failed to create tenant');
        } finally {
            setCreating(false);
        }
    };

    return (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
            <div className="bg-sa-navy border border-sa-border rounded-2xl w-full max-w-md shadow-2xl shadow-black/40">
                {/* Header */}
                <div className="flex items-center justify-between px-6 py-5 border-b border-sa-border">
                    <div className="flex items-center gap-3">
                        <div className="p-2 rounded-lg bg-sa-accent/10">
                            <Building2 className="w-5 h-5 text-sa-accent" />
                        </div>
                        <div>
                            <h3 className="text-lg font-bold text-sa-platinum">Add New Tenant</h3>
                            <p className="text-xs text-sa-muted">Create a new salon with an owner account</p>
                        </div>
                    </div>
                    <button onClick={onClose} className="p-2 rounded-lg hover:bg-white/5 text-sa-muted hover:text-sa-platinum transition-colors">
                        <X className="w-5 h-5" />
                    </button>
                </div>

                {/* Form */}
                <form onSubmit={handleSubmit} className="p-6 space-y-5">
                    {/* Business Name */}
                    <div>
                        <label className="text-[10px] font-bold text-sa-muted uppercase tracking-[0.15em] mb-2 block">
                            Business Name
                        </label>
                        <input
                            type="text"
                            required
                            value={form.businessName}
                            onChange={e => setForm({ ...form, businessName: e.target.value })}
                            className="w-full bg-sa-slate/50 border border-sa-border rounded-xl px-4 py-3 text-sm text-sa-platinum placeholder:text-sa-muted/40 outline-none focus:border-sa-accent/50 focus:bg-sa-slate/80 transition-all"
                            placeholder="e.g. Luxe Beauty Spa"
                        />
                    </div>

                    {/* Owner Section */}
                    <div className="pt-4 border-t border-sa-border">
                        <div className="flex items-center gap-2 mb-4">
                            <Shield className="w-4 h-4 text-sa-accent" />
                            <h4 className="text-xs font-bold text-sa-accent uppercase tracking-wider">Owner Account</h4>
                        </div>

                        <div className="space-y-4">
                            <div>
                                <label className="text-[10px] font-bold text-sa-muted uppercase tracking-[0.15em] mb-2 block">
                                    Owner Email
                                </label>
                                <input
                                    type="email"
                                    required
                                    value={form.ownerEmail}
                                    onChange={e => setForm({ ...form, ownerEmail: e.target.value })}
                                    className="w-full bg-sa-slate/50 border border-sa-border rounded-xl px-4 py-3 text-sm text-sa-platinum placeholder:text-sa-muted/40 outline-none focus:border-sa-accent/50 focus:bg-sa-slate/80 transition-all"
                                    placeholder="owner@salon.com"
                                />
                            </div>
                            <div>
                                <label className="text-[10px] font-bold text-sa-muted uppercase tracking-[0.15em] mb-2 block">
                                    Password
                                </label>
                                <input
                                    type="password"
                                    required
                                    minLength={6}
                                    value={form.ownerPassword}
                                    onChange={e => setForm({ ...form, ownerPassword: e.target.value })}
                                    className="w-full bg-sa-slate/50 border border-sa-border rounded-xl px-4 py-3 text-sm text-sa-platinum placeholder:text-sa-muted/40 outline-none focus:border-sa-accent/50 focus:bg-sa-slate/80 transition-all"
                                    placeholder="Min 6 characters"
                                />
                            </div>
                        </div>
                    </div>

                    {/* Error */}
                    {error && (
                        <div className="bg-red-500/10 border border-red-500/20 text-red-400 px-4 py-3 rounded-xl text-sm font-medium">
                            {error}
                        </div>
                    )}

                    {/* Actions */}
                    <div className="flex gap-3 pt-2">
                        <button
                            type="button"
                            onClick={onClose}
                            className="flex-1 px-4 py-3 rounded-xl border border-sa-border text-sa-muted hover:text-sa-platinum hover:bg-white/[0.03] transition-all font-medium text-sm"
                        >
                            Cancel
                        </button>
                        <button
                            type="submit"
                            disabled={creating}
                            className="flex-1 px-4 py-3 bg-sa-gradient text-white rounded-xl font-bold text-sm hover:shadow-lg hover:shadow-sa-accent/20 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                        >
                            {creating ? (
                                <><Loader2 className="w-4 h-4 animate-spin" /> Creating...</>
                            ) : (
                                'Create Tenant'
                            )}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    );
};

--- FILE: C:\Users\syeda\OneDrive\Desktop\Voxali New\dashboard\src\components\SuperAdmin\AIMonitorPage.tsx ---

import React from 'react';
import { Bot, Phone, Clock, TrendingUp } from 'lucide-react';

const mockData = [
    { salon: 'Luxe Beauty Spa', calls30d: 342, lastActive: '2 min ago', status: 'active', trend: '+18%' },
    { salon: 'Golden Cuts Studio', calls30d: 287, lastActive: '15 min ago', status: 'active', trend: '+12%' },
    { salon: 'Elite Hair Lounge', calls30d: 156, lastActive: '1 hr ago', status: 'active', trend: '+5%' },
    { salon: 'Bella Nails & Spa', calls30d: 98, lastActive: '3 hr ago', status: 'active', trend: '+22%' },
    { salon: 'The Style Bar', calls30d: 67, lastActive: '1 day ago', status: 'idle', trend: '-3%' },
];

const summaryCards = [
    { label: 'Total AI Calls (30d)', value: '1,847', icon: Phone, color: 'text-blue-400', bg: 'bg-blue-500/10' },
    { label: 'Avg per Salon', value: '190', icon: Bot, color: 'text-violet-400', bg: 'bg-violet-500/10' },
    { label: 'Peak Hour', value: '2–4 PM', icon: Clock, color: 'text-amber-400', bg: 'bg-amber-500/10' },
    { label: 'Month-over-Month', value: '+14%', icon: TrendingUp, color: 'text-emerald-400', bg: 'bg-emerald-500/10' },
];

export const AIMonitorPage: React.FC = () => {
    return (
        <div className="space-y-8">
            {/* Header */}
            <div>
                <h1 className="text-3xl font-black text-sa-platinum tracking-tight">AI Monitor</h1>
                <p className="text-sa-muted mt-1">Bella AI usage across all tenants</p>
            </div>

            {/* Summary Cards */}
            <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-5">
                {summaryCards.map((card) => (
                    <div key={card.label} className="p-5 rounded-2xl bg-sa-navy border border-sa-border">
                        <div className="flex items-center gap-3 mb-3">
                            <div className={`p-2.5 rounded-xl ${card.bg}`}>
                                <card.icon className={`w-4 h-4 ${card.color}`} />
                            </div>
                            <span className="text-xs text-sa-muted font-medium">{card.label}</span>
                        </div>
                        <div className="text-2xl font-black text-sa-platinum">{card.value}</div>
                    </div>
                ))}
            </div>

            {/* Usage Table */}
            <div className="bg-sa-navy rounded-2xl border border-sa-border overflow-hidden">
                <div className="px-6 py-4 border-b border-sa-border">
                    <h2 className="text-lg font-bold text-sa-platinum">Usage by Salon</h2>
                    <p className="text-sa-muted text-xs mt-0.5">AI call volume in the last 30 days</p>
                </div>
                <table className="w-full">
                    <thead>
                        <tr className="border-b border-sa-border">
                            <th className="text-left px-6 py-3 text-[10px] font-bold text-sa-muted uppercase tracking-[0.15em]">Salon</th>
                            <th className="text-left px-6 py-3 text-[10px] font-bold text-sa-muted uppercase tracking-[0.15em]">AI Calls (30d)</th>
                            <th className="text-left px-6 py-3 text-[10px] font-bold text-sa-muted uppercase tracking-[0.15em]">Trend</th>
                            <th className="text-left px-6 py-3 text-[10px] font-bold text-sa-muted uppercase tracking-[0.15em]">Last Active</th>
                            <th className="text-left px-6 py-3 text-[10px] font-bold text-sa-muted uppercase tracking-[0.15em]">Status</th>
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-sa-border">
                        {mockData.map((row, i) => (
                            <tr key={i} className="hover:bg-white/[0.02] transition-colors">
                                <td className="px-6 py-4">
                                    <div className="flex items-center gap-3">
                                        <div className="w-8 h-8 rounded-lg bg-sa-slate flex items-center justify-center">
                                            <Bot className="w-4 h-4 text-sa-accent" />
                                        </div>
                                        <span className="font-semibold text-sm text-sa-platinum">{row.salon}</span>
                                    </div>
                                </td>
                                <td className="px-6 py-4">
                                    <span className="text-sm font-bold text-sa-platinum">{row.calls30d.toLocaleString()}</span>
                                </td>
                                <td className="px-6 py-4">
                                    <span className={`text-xs font-semibold ${row.trend.startsWith('+') ? 'text-emerald-400' : 'text-red-400'}`}>
                                        {row.trend}
                                    </span>
                                </td>
                                <td className="px-6 py-4 text-sm text-sa-muted">{row.lastActive}</td>
                                <td className="px-6 py-4">
                                    <span className={`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-[11px] font-semibold ${row.status === 'active'
                                            ? 'bg-emerald-500/10 text-emerald-400 border border-emerald-500/20'
                                            : 'bg-amber-500/10 text-amber-400 border border-amber-500/20'
                                        }`}>
                                        <span className={`w-1.5 h-1.5 rounded-full ${row.status === 'active' ? 'bg-emerald-400' : 'bg-amber-400'}`} />
                                        {row.status === 'active' ? 'Active' : 'Idle'}
                                    </span>
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>
        </div>
    );
};

--- FILE: C:\Users\syeda\OneDrive\Desktop\Voxali New\dashboard\src\components\SuperAdmin\SalonsList.tsx ---

import React, { useState, useEffect } from 'react';
import { supabase } from '../../lib/supabase';
import { Building2, Plus, MoreVertical, Shield } from 'lucide-react';
import { showToast } from '../ui/ToastNotification';

export const SalonsList = () => {
    const [salons, setSalons] = useState<any[]>([]);
    const [loading, setLoading] = useState(true);
    const [isCreateModalOpen, setIsCreateModalOpen] = useState(false);

    // Form State
    const [newSalon, setNewSalon] = useState({
        name: '',
        ownerName: '',
        ownerEmail: '',
        ownerPassword: ''
    });
    const [creating, setCreating] = useState(false);

    useEffect(() => {
        fetchSalons();
    }, []);

    const fetchSalons = async () => {
        try {
            const { data, error } = await supabase
                .from('tenants')
                .select(`
                    *,
                    profiles:profiles(full_name, email, role)
                `)
                .order('created_at', { ascending: false });

            if (data) {
                // Filter to find the 'owner' profile for each tenant
                const processed = data.map(tenant => ({
                    ...tenant,
                    owner: tenant.profiles?.find((p: any) => p.role === 'owner')
                }));
                setSalons(processed);
            }
        } catch (error) {
            console.error('Error fetching salons:', error);
        } finally {
            setLoading(false);
        }
    };

    const handleCreateSalon = async (e: React.FormEvent) => {
        e.preventDefault();
        setCreating(true);

        try {
            const { data, error } = await supabase.rpc('rpc_create_tenant_and_owner', {
                p_salon_name: newSalon.name,
                p_owner_name: newSalon.ownerName,
                p_owner_email: newSalon.ownerEmail,
                p_owner_password: newSalon.ownerPassword
            });

            if (error) throw error;
            if (data && !data.success) throw new Error(data.error);

            showToast('Salon created successfully!', 'success');
            setIsCreateModalOpen(false);
            setNewSalon({ name: '', ownerName: '', ownerEmail: '', ownerPassword: '' });
            fetchSalons(); // Refresh list
        } catch (error: any) {
            console.error('Error creating salon:', error);
            showToast(error.message || 'Failed to create salon', 'error');
        } finally {
            setCreating(false);
        }
    };

    if (loading) return <div className="text-white p-8">Loading Salons...</div>;

    return (
        <div className="space-y-6">
            <div className="flex justify-between items-center">
                <h2 className="text-2xl font-bold text-white">All Salons</h2>
                <button
                    onClick={() => setIsCreateModalOpen(true)}
                    className="px-4 py-2 bg-luxe-gold text-luxe-obsidian rounded-lg font-bold hover:bg-yellow-500 transition-colors flex items-center gap-2"
                >
                    <Plus className="w-4 h-4" />
                    Add Salon
                </button>
            </div>

            <div className="bg-white/5 rounded-2xl border border-white/10 overflow-hidden">
                <table className="w-full">
                    <thead className="bg-white/5 border-b border-white/10">
                        <tr>
                            <th className="text-left p-4 text-white/60 text-sm font-medium">Salon Name</th>
                            <th className="text-left p-4 text-white/60 text-sm font-medium">Owner</th>
                            <th className="text-left p-4 text-white/60 text-sm font-medium">Status</th>
                            <th className="text-left p-4 text-white/60 text-sm font-medium">Created At</th>
                            <th className="text-right p-4 text-white/60 text-sm font-medium">Actions</th>
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-white/5">
                        {salons.map((salon) => (
                            <tr key={salon.id} className="hover:bg-white/5 transition-colors">
                                <td className="p-4">
                                    <div className="flex items-center gap-3">
                                        <div className="w-10 h-10 rounded-lg bg-white/10 flex items-center justify-center text-white">
                                            <Building2 className="w-5 h-5" />
                                        </div>
                                        <div>
                                            <div className="font-medium text-white">{salon.name}</div>
                                            <div className="text-xs text-white/40">{salon.slug}</div>
                                        </div>
                                    </div>
                                </td>
                                <td className="p-4">
                                    {salon.owner ? (
                                        <div>
                                            <div className="text-white text-sm">{salon.owner.full_name}</div>
                                            <div className="text-white/40 text-xs">{salon.owner.email}</div>
                                        </div>
                                    ) : (
                                        <span className="text-red-400 text-xs">No Owner Found</span>
                                    )}
                                </td>
                                <td className="p-4">
                                    <span className="px-2 py-1 rounded-full text-xs font-medium bg-green-500/20 text-green-400 border border-green-500/20">
                                        Active
                                    </span>
                                </td>
                                <td className="p-4 text-white/60 text-sm">
                                    {new Date(salon.created_at).toLocaleDateString()}
                                </td>
                                <td className="p-4 text-right">
                                    <button aria-label="Actions" className="p-2 hover:bg-white/10 rounded-lg text-white/60 hover:text-white transition-colors">
                                        <MoreVertical className="w-4 h-4" />
                                    </button>
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>

            {/* Create Salon Modal */}
            {isCreateModalOpen && (
                <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                    <div className="bg-luxe-obsidian border border-white/10 rounded-2xl w-full max-w-md p-6 shadow-2xl">
                        <h3 className="text-xl font-bold text-white mb-6">Add New Salon</h3>
                        <form onSubmit={handleCreateSalon} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-white/60 mb-1">Salon Name</label>
                                <input
                                    type="text"
                                    required
                                    value={newSalon.name}
                                    onChange={e => setNewSalon({ ...newSalon, name: e.target.value })}
                                    className="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-luxe-gold/50"
                                    placeholder="e.g. Luxe Beauty Spa"
                                />
                            </div>

                            <div className="pt-4 border-t border-white/10">
                                <h4 className="text-sm font-bold text-luxe-gold mb-3 flex items-center gap-2">
                                    <Shield className="w-4 h-4" /> Owner Account
                                </h4>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-white/60 mb-1">Owner Name</label>
                                        <input
                                            type="text"
                                            required
                                            value={newSalon.ownerName}
                                            onChange={e => setNewSalon({ ...newSalon, ownerName: e.target.value })}
                                            className="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-luxe-gold/50"
                                            placeholder="Full Name"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-white/60 mb-1">Owner Email</label>
                                        <input
                                            type="email"
                                            required
                                            value={newSalon.ownerEmail}
                                            onChange={e => setNewSalon({ ...newSalon, ownerEmail: e.target.value })}
                                            className="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-luxe-gold/50"
                                            placeholder="owner@salon.com"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-white/60 mb-1">Password</label>
                                        <input
                                            type="password"
                                            required
                                            value={newSalon.ownerPassword}
                                            onChange={e => setNewSalon({ ...newSalon, ownerPassword: e.target.value })}
                                            className="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-luxe-gold/50"
                                            placeholder="Min 6 characters"
                                        />
                                    </div>
                                </div>
                            </div>

                            <div className="flex gap-3 mt-8">
                                <button
                                    type="button"
                                    onClick={() => setIsCreateModalOpen(false)}
                                    className="flex-1 px-4 py-3 rounded-xl border border-white/10 text-white/60 hover:text-white hover:bg-white/5 transition-colors font-medium"
                                >
                                    Cancel
                                </button>
                                <button
                                    type="submit"
                                    disabled={creating}
                                    className="flex-1 px-4 py-3 bg-luxe-gold text-luxe-obsidian rounded-xl font-bold hover:bg-yellow-500 transition-colors disabled:opacity-50"
                                >
                                    {creating ? 'Creating...' : 'Create Salon'}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            )}
        </div>
    );
};

--- FILE: C:\Users\syeda\OneDrive\Desktop\Voxali New\dashboard\src\components\SuperAdmin\SuperAdminDashboard.tsx ---

import React, { useState, useEffect } from 'react';
import { supabase } from '../../lib/supabase';
import { Building2, Users, DollarSign, Bot, TrendingUp, Activity } from 'lucide-react';

export const SuperAdminDashboard: React.FC = () => {
    const [stats, setStats] = useState({
        totalSalons: 0,
        totalUsers: 0,
    });
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        fetchStats();
    }, []);

    const fetchStats = async () => {
        try {
            const { count: salonCount } = await supabase
                .from('tenants')
                .select('*', { count: 'exact', head: true });

            const { count: userCount } = await supabase
                .from('profiles')
                .select('*', { count: 'exact', head: true });

            setStats({
                totalSalons: salonCount || 0,
                totalUsers: userCount || 0,
            });
        } catch (error) {
            console.error('Error fetching stats:', error);
        } finally {
            setLoading(false);
        }
    };

    const statCards = [
        {
            label: 'Active Salons',
            value: loading ? '—' : stats.totalSalons,
            icon: Building2,
            change: '+12%',
            color: 'text-blue-400',
            bgColor: 'bg-blue-500/10',
            borderColor: 'border-blue-500/20',
        },
        {
            label: 'Monthly Revenue',
            value: '$12,450',
            icon: DollarSign,
            change: '+8.2%',
            color: 'text-emerald-400',
            bgColor: 'bg-emerald-500/10',
            borderColor: 'border-emerald-500/20',
        },
        {
            label: 'Total AI Calls',
            value: '1,847',
            icon: Bot,
            change: '+24%',
            color: 'text-violet-400',
            bgColor: 'bg-violet-500/10',
            borderColor: 'border-violet-500/20',
        },
        {
            label: 'Active Users',
            value: loading ? '—' : stats.totalUsers,
            icon: Users,
            change: '+5%',
            color: 'text-amber-400',
            bgColor: 'bg-amber-500/10',
            borderColor: 'border-amber-500/20',
        },
    ];

    const recentActivity = [
        { salon: 'Luxe Beauty Spa', action: 'New booking created', time: '2 min ago', icon: Activity },
        { salon: 'Golden Cuts Studio', action: 'AI call completed', time: '15 min ago', icon: Bot },
        { salon: 'Elite Hair Lounge', action: 'New client registered', time: '1 hr ago', icon: Users },
        { salon: 'Luxe Beauty Spa', action: 'Payment received — $85', time: '2 hr ago', icon: DollarSign },
        { salon: 'Golden Cuts Studio', action: 'Staff member added', time: '3 hr ago', icon: Users },
    ];

    return (
        <div className="space-y-8">
            {/* Header */}
            <div>
                <h1 className="text-3xl font-black text-sa-platinum tracking-tight">
                    Dashboard Overview
                </h1>
                <p className="text-sa-muted mt-1">Welcome back, Super Admin. Here's your system status.</p>
            </div>

            {/* Stats Grid */}
            <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-5">
                {statCards.map((card) => (
                    <div
                        key={card.label}
                        className={`p-6 rounded-2xl bg-sa-navy border ${card.borderColor} hover:border-sa-accent/30 transition-all duration-300 group`}
                    >
                        <div className="flex justify-between items-start mb-4">
                            <div className={`p-3 rounded-xl ${card.bgColor}`}>
                                <card.icon className={`w-5 h-5 ${card.color}`} />
                            </div>
                            <div className="flex items-center gap-1 text-emerald-400 text-xs font-semibold">
                                <TrendingUp className="w-3 h-3" />
                                {card.change}
                            </div>
                        </div>
                        <div className="text-3xl font-black text-sa-platinum mb-1">{card.value}</div>
                        <div className="text-sa-muted text-sm">{card.label}</div>
                    </div>
                ))}
            </div>

            {/* Recent Activity */}
            <div className="bg-sa-navy rounded-2xl border border-sa-border overflow-hidden">
                <div className="px-6 py-4 border-b border-sa-border">
                    <h2 className="text-lg font-bold text-sa-platinum">Recent Activity</h2>
                    <p className="text-sa-muted text-xs mt-0.5">Latest actions across all salons</p>
                </div>
                <div className="divide-y divide-sa-border">
                    {recentActivity.map((item, i) => (
                        <div key={i} className="px-6 py-4 flex items-center gap-4 hover:bg-white/[0.02] transition-colors">
                            <div className="p-2 rounded-lg bg-sa-slate/70">
                                <item.icon className="w-4 h-4 text-sa-accent" />
                            </div>
                            <div className="flex-1 min-w-0">
                                <p className="text-sm text-sa-platinum font-medium">{item.action}</p>
                                <p className="text-xs text-sa-muted">{item.salon}</p>
                            </div>
                            <span className="text-xs text-sa-muted/60 whitespace-nowrap">{item.time}</span>
                        </div>
                    ))}
                </div>
            </div>
        </div>
    );
};

--- FILE: C:\Users\syeda\OneDrive\Desktop\Voxali New\dashboard\src\components\SuperAdmin\SuperAdminLayout.tsx ---

import React, { useState, useCallback } from 'react';
import {
    LayoutDashboard,
    Building2,
    Bot,
    LogOut,
    ChevronRight,
    Zap,
} from 'lucide-react';
import { useAuth } from '../../context/AuthContext';
import { SuperAdminDashboard } from './SuperAdminDashboard';
import { TenantsPage } from './TenantsPage';
import { AIMonitorPage } from './AIMonitorPage';

const navItems = [
    { icon: LayoutDashboard, label: 'Overview', id: 'overview' },
    { icon: Building2, label: 'Tenants', id: 'tenants' },
    { icon: Bot, label: 'AI Monitor', id: 'ai_monitor' },
];

export const SuperAdminLayout: React.FC = () => {
    const [activeTab, setActiveTab] = useState('overview');
    const { forceLogout } = useAuth();

    const handleLogout = useCallback(async () => {
        await forceLogout();
    }, [forceLogout]);

    const handleImpersonate = (tenantId: string, tenantName?: string) => {
        // Set both flags for impersonation
        localStorage.setItem('voxali_impersonate_tenant', tenantId);
        localStorage.setItem('admin_viewing_tenant', 'true');
        if (tenantName) {
            localStorage.setItem('voxali_impersonate_name', tenantName);
        }
        // Reload to pick up the new tenant context
        window.location.reload();
    };

    return (
        <div className="flex h-screen bg-sa-midnight text-sa-platinum overflow-hidden font-sans">
            {/* Sidebar */}
            <aside className="w-64 h-screen bg-sa-navy border-r border-sa-border flex flex-col">
                {/* Logo */}
                <div className="p-6 pb-8">
                    <div className="flex items-center gap-3">
                        <div className="w-10 h-10 rounded-xl bg-sa-gradient flex items-center justify-center shadow-lg shadow-sa-accent/20">
                            <Zap className="w-5 h-5 text-white" />
                        </div>
                        <div>
                            <h1 className="text-lg font-black tracking-tight text-sa-platinum">VOXALI</h1>
                            <p className="text-[10px] uppercase tracking-[0.25em] text-sa-accent/70 font-semibold">Super Admin</p>
                        </div>
                    </div>
                </div>

                {/* Navigation */}
                <nav className="flex-1 px-3 space-y-1">
                    <div className="text-[10px] font-bold text-sa-muted/50 uppercase tracking-[0.2em] px-3 mb-3">
                        Management
                    </div>
                    {navItems.map((item) => {
                        const isActive = activeTab === item.id;
                        return (
                            <button
                                key={item.id}
                                onClick={() => setActiveTab(item.id)}
                                className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 group ${isActive
                                        ? 'bg-sa-accent/10 text-sa-accent border border-sa-accent/20'
                                        : 'text-sa-muted hover:text-sa-platinum hover:bg-white/[0.03] border border-transparent'
                                    }`}
                            >
                                <item.icon className={`w-5 h-5 ${isActive ? 'text-sa-accent' : 'text-sa-muted/60 group-hover:text-sa-platinum'}`} />
                                <span className="font-medium text-sm">{item.label}</span>
                                {isActive && (
                                    <ChevronRight className="ml-auto w-4 h-4 text-sa-accent/60" />
                                )}
                            </button>
                        );
                    })}
                </nav>

                {/* Bottom */}
                <div className="p-4 space-y-3">
                    <div className="px-4 py-3 rounded-xl bg-sa-slate/50 border border-sa-border">
                        <p className="text-xs font-bold text-sa-platinum">Super Admin</p>
                        <p className="text-[10px] text-sa-muted mt-0.5">Full system access</p>
                    </div>
                    <button
                        onClick={handleLogout}
                        className="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-red-400/70 hover:text-red-400 hover:bg-red-400/5 transition-all"
                    >
                        <LogOut className="w-5 h-5" />
                        <span className="font-medium text-sm">Logout</span>
                    </button>
                </div>
            </aside>

            {/* Main Content */}
            <main className="flex-1 overflow-y-auto custom-scrollbar">
                <div className="p-8 max-w-7xl mx-auto">
                    {activeTab === 'overview' && <SuperAdminDashboard />}
                    {activeTab === 'tenants' && <TenantsPage onImpersonate={handleImpersonate} />}
                    {activeTab === 'ai_monitor' && <AIMonitorPage />}
                </div>
            </main>
        </div>
    );
};

--- FILE: C:\Users\syeda\OneDrive\Desktop\Voxali New\dashboard\src\components\SuperAdmin\TenantsPage.tsx ---

import React, { useState, useEffect } from 'react';
import { supabase } from '../../lib/supabase';
import { Building2, Plus, Eye, Search, RefreshCw } from 'lucide-react';
import { AddTenantModal } from './AddTenantModal';

interface TenantsPageProps {
    onImpersonate: (tenantId: string, tenantName?: string) => void;
}

export const TenantsPage: React.FC<TenantsPageProps> = ({ onImpersonate }) => {
    const [tenants, setTenants] = useState<any[]>([]);
    const [loading, setLoading] = useState(true);
    const [search, setSearch] = useState('');
    const [isModalOpen, setIsModalOpen] = useState(false);

    useEffect(() => {
        fetchTenants();
    }, []);

    const fetchTenants = async () => {
        setLoading(true);
        try {
            const { data, error } = await supabase
                .from('tenants')
                .select(`
                    *,
                    profiles:profiles(full_name, email, role)
                `)
                .order('created_at', { ascending: false });

            if (data) {
                const processed = data.map(tenant => ({
                    ...tenant,
                    owner: tenant.profiles?.find((p: any) => p.role === 'owner'),
                }));
                setTenants(processed);
            }
            if (error) console.error('Error:', error);
        } catch (error) {
            console.error('Error fetching tenants:', error);
        } finally {
            setLoading(false);
        }
    };

    const filteredTenants = tenants.filter(t =>
        (t.name || '').toLowerCase().includes(search.toLowerCase()) ||
        (t.owner?.email || '').toLowerCase().includes(search.toLowerCase())
    );

    return (
        <div className="space-y-6">
            {/* Header */}
            <div className="flex justify-between items-start">
                <div>
                    <h1 className="text-3xl font-black text-sa-platinum tracking-tight">Tenants</h1>
                    <p className="text-sa-muted mt-1">Manage all salons on the platform</p>
                </div>
                <button
                    onClick={() => setIsModalOpen(true)}
                    className="px-5 py-2.5 bg-sa-gradient text-white rounded-xl font-bold text-sm hover:shadow-lg hover:shadow-sa-accent/20 transition-all flex items-center gap-2"
                >
                    <Plus className="w-4 h-4" />
                    Add Tenant
                </button>
            </div>

            {/* Search & Filter Bar */}
            <div className="flex items-center gap-3">
                <div className="relative flex-1 max-w-md">
                    <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-sa-muted/50" />
                    <input
                        type="text"
                        value={search}
                        onChange={e => setSearch(e.target.value)}
                        placeholder="Search by name or email..."
                        className="w-full bg-sa-navy border border-sa-border rounded-xl pl-11 pr-4 py-2.5 text-sm text-sa-platinum placeholder:text-sa-muted/40 outline-none focus:border-sa-accent/50 transition-all"
                    />
                </div>
                <button
                    onClick={fetchTenants}
                    className="p-2.5 rounded-xl border border-sa-border text-sa-muted hover:text-sa-platinum hover:bg-white/[0.03] transition-all"
                    title="Refresh"
                >
                    <RefreshCw className={`w-4 h-4 ${loading ? 'animate-spin' : ''}`} />
                </button>
            </div>

            {/* Table */}
            <div className="bg-sa-navy rounded-2xl border border-sa-border overflow-hidden">
                <table className="w-full">
                    <thead>
                        <tr className="border-b border-sa-border">
                            <th className="text-left px-6 py-4 text-[10px] font-bold text-sa-muted uppercase tracking-[0.15em]">Salon Name</th>
                            <th className="text-left px-6 py-4 text-[10px] font-bold text-sa-muted uppercase tracking-[0.15em]">Owner Email</th>
                            <th className="text-left px-6 py-4 text-[10px] font-bold text-sa-muted uppercase tracking-[0.15em]">Status</th>
                            <th className="text-left px-6 py-4 text-[10px] font-bold text-sa-muted uppercase tracking-[0.15em]">Created</th>
                            <th className="text-right px-6 py-4 text-[10px] font-bold text-sa-muted uppercase tracking-[0.15em]">Actions</th>
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-sa-border">
                        {loading ? (
                            <tr>
                                <td colSpan={5} className="px-6 py-12 text-center text-sa-muted text-sm">
                                    Loading tenants...
                                </td>
                            </tr>
                        ) : filteredTenants.length === 0 ? (
                            <tr>
                                <td colSpan={5} className="px-6 py-12 text-center text-sa-muted text-sm">
                                    {search ? 'No tenants match your search' : 'No tenants found. Create one to get started.'}
                                </td>
                            </tr>
                        ) : (
                            filteredTenants.map((tenant) => (
                                <tr key={tenant.id} className="hover:bg-white/[0.02] transition-colors group">
                                    <td className="px-6 py-4">
                                        <div className="flex items-center gap-3">
                                            <div className="w-9 h-9 rounded-lg bg-sa-slate flex items-center justify-center text-sa-accent">
                                                <Building2 className="w-4 h-4" />
                                            </div>
                                            <div>
                                                <div className="font-semibold text-sm text-sa-platinum">{tenant.name || tenant.salon_name || 'Unnamed'}</div>
                                                <div className="text-[11px] text-sa-muted/50">{tenant.id?.slice(0, 8)}...</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td className="px-6 py-4">
                                        {tenant.owner ? (
                                            <span className="text-sm text-sa-platinum">{tenant.owner.email}</span>
                                        ) : (
                                            <span className="text-xs text-red-400/70 italic">No owner</span>
                                        )}
                                    </td>
                                    <td className="px-6 py-4">
                                        <span className="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-[11px] font-semibold bg-emerald-500/10 text-emerald-400 border border-emerald-500/20">
                                            <span className="w-1.5 h-1.5 rounded-full bg-emerald-400" />
                                            Active
                                        </span>
                                    </td>
                                    <td className="px-6 py-4 text-sm text-sa-muted">
                                        {new Date(tenant.created_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
                                    </td>
                                    <td className="px-6 py-4 text-right">
                                        <button
                                            onClick={() => onImpersonate(tenant.id, tenant.name || tenant.salon_name)}
                                            className="inline-flex items-center gap-2 px-3.5 py-2 rounded-lg bg-sa-accent/10 text-sa-accent border border-sa-accent/20 hover:bg-sa-accent/20 hover:border-sa-accent/40 transition-all text-xs font-semibold opacity-0 group-hover:opacity-100"
                                        >
                                            <Eye className="w-3.5 h-3.5" />
                                            Access Dashboard
                                        </button>
                                    </td>
                                </tr>
                            ))
                        )}
                    </tbody>
                </table>
            </div>

            <AddTenantModal
                isOpen={isModalOpen}
                onClose={() => setIsModalOpen(false)}
                onCreated={fetchTenants}
            />
        </div>
    );
};

--- FILE: C:\Users\syeda\OneDrive\Desktop\Voxali New\dashboard\src\components\ui\ConfirmModal.tsx ---

import React from 'react';
import { AlertTriangle, X } from 'lucide-react';

interface ConfirmModalProps {
    open: boolean;
    title: string;
    message: string;
    confirmLabel?: string;
    cancelLabel?: string;
    danger?: boolean;
    loading?: boolean;
    onConfirm: () => void;
    onCancel: () => void;
}

export const ConfirmModal: React.FC<ConfirmModalProps> = ({
    open,
    title,
    message,
    confirmLabel = 'Confirm',
    cancelLabel = 'Cancel',
    danger = false,
    loading = false,
    onConfirm,
    onCancel,
}) => {
    if (!open) return null;

    return (
        <div
            className="fixed inset-0 bg-black/60 backdrop-blur-sm z-[9998] flex items-center justify-center p-4"
            onClick={onCancel}
        >
            <div
                className="bg-luxe-obsidian border border-white/10 rounded-2xl p-8 w-full max-w-md shadow-2xl animate-in fade-in zoom-in-95 duration-200"
                onClick={e => e.stopPropagation()}
            >
                <div className="flex items-start gap-4 mb-6">
                    {danger && (
                        <div className="p-3 bg-red-500/10 rounded-2xl border border-red-500/20 flex-shrink-0">
                            <AlertTriangle className="w-6 h-6 text-red-400" />
                        </div>
                    )}
                    <div className="flex-1">
                        <h3 className="text-lg font-bold mb-1">{title}</h3>
                        <p className="text-sm text-white/50 leading-relaxed">{message}</p>
                    </div>
                    <button
                        onClick={onCancel}
                        className="p-2 hover:bg-white/10 rounded-xl transition-all flex-shrink-0"
                    >
                        <X className="w-5 h-5 text-white/40" />
                    </button>
                </div>
                <div className="flex items-center gap-3 justify-end">
                    <button
                        onClick={onCancel}
                        className="px-6 py-2.5 rounded-xl border border-white/10 text-white/60 hover:text-white hover:bg-white/5 transition-all text-sm font-bold"
                    >
                        {cancelLabel}
                    </button>
                    <button
                        onClick={onConfirm}
                        disabled={loading}
                        className={`px-6 py-2.5 rounded-xl font-bold text-sm shadow-lg transition-all hover:scale-[1.02] active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 ${danger
                                ? 'bg-red-500 text-white shadow-red-500/20 hover:bg-red-600'
                                : 'bg-gold-gradient text-luxe-obsidian shadow-luxe-gold/20'
                            }`}
                    >
                        {confirmLabel}
                    </button>
                </div>
            </div>
        </div>
    );
};

--- FILE: C:\Users\syeda\OneDrive\Desktop\Voxali New\dashboard\src\components\ui\ToastNotification.tsx ---

import React, { useState, useEffect, useCallback } from 'react';
import { CheckCircle2, XCircle, Info, X } from 'lucide-react';

type ToastVariant = 'success' | 'error' | 'info';

interface Toast {
    id: number;
    message: string;
    variant: ToastVariant;
    exiting?: boolean;
}

let toastIdCounter = 0;
let globalAddToast: ((message: string, variant?: ToastVariant) => void) | null = null;

/** Call this from anywhere to show a toast */
export function showToast(message: string, variant: ToastVariant = 'success') {
    globalAddToast?.(message, variant);
}

const variantConfig: Record<ToastVariant, {
    icon: React.ElementType;
    border: string;
    bg: string;
    text: string;
    glow: string;
    iconColor: string;
}> = {
    success: {
        icon: CheckCircle2,
        border: 'border-luxe-gold/30',
        bg: 'bg-luxe-obsidian/90',
        text: 'text-white',
        glow: 'shadow-[0_0_30px_rgba(212,175,55,0.15)]',
        iconColor: 'text-luxe-gold',
    },
    error: {
        icon: XCircle,
        border: 'border-red-500/30',
        bg: 'bg-luxe-obsidian/90',
        text: 'text-white',
        glow: 'shadow-[0_0_30px_rgba(239,68,68,0.15)]',
        iconColor: 'text-red-400',
    },
    info: {
        icon: Info,
        border: 'border-blue-500/30',
        bg: 'bg-luxe-obsidian/90',
        text: 'text-white',
        glow: 'shadow-[0_0_30px_rgba(96,165,250,0.15)]',
        iconColor: 'text-blue-400',
    },
};

export const ToastProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
    const [toasts, setToasts] = useState<Toast[]>([]);

    const addToast = useCallback((message: string, variant: ToastVariant = 'success') => {
        const id = ++toastIdCounter;
        setToasts(prev => [...prev.slice(-4), { id, message, variant }]);

        // Auto dismiss after 3s
        setTimeout(() => {
            setToasts(prev => prev.map(t => t.id === id ? { ...t, exiting: true } : t));
            setTimeout(() => {
                setToasts(prev => prev.filter(t => t.id !== id));
            }, 300);
        }, 3000);
    }, []);

    const dismiss = useCallback((id: number) => {
        setToasts(prev => prev.map(t => t.id === id ? { ...t, exiting: true } : t));
        setTimeout(() => {
            setToasts(prev => prev.filter(t => t.id !== id));
        }, 300);
    }, []);

    useEffect(() => {
        globalAddToast = addToast;
        return () => { globalAddToast = null; };
    }, [addToast]);

    return (
        <>
            {children}
            {/* Toast Container */}
            <div className="fixed top-5 right-5 z-[9999] flex flex-col gap-3 pointer-events-none" style={{ maxWidth: 380 }}>
                {toasts.map(toast => {
                    const cfg = variantConfig[toast.variant];
                    const Icon = cfg.icon;
                    return (
                        <div
                            key={toast.id}
                            className={`
                                pointer-events-auto flex items-center gap-3 px-5 py-3.5 rounded-2xl border
                                backdrop-blur-xl ${cfg.bg} ${cfg.border} ${cfg.glow}
                                transition-all duration-300 ease-out
                                ${toast.exiting
                                    ? 'opacity-0 translate-x-8 scale-95'
                                    : 'opacity-100 translate-x-0 scale-100 animate-in slide-in-from-right-4'
                                }
                            `}
                        >
                            <Icon className={`w-5 h-5 flex-shrink-0 ${cfg.iconColor}`} />
                            <span className={`text-sm font-semibold flex-1 ${cfg.text}`}>{toast.message}</span>
                            <button
                                onClick={() => dismiss(toast.id)}
                                className="p-1 rounded-lg hover:bg-white/10 transition-colors flex-shrink-0"
                            >
                                <X className="w-3.5 h-3.5 text-white/40" />
                            </button>
                        </div>
                    );
                })}
            </div>
        </>
    );
};

--- FILE: C:\Users\syeda\OneDrive\Desktop\Voxali New\dashboard\src\components\Analytics.tsx ---

import React, { useState, useEffect, useCallback } from 'react';
import {
    TrendingUp,
    BarChart3,
    PieChart as PieIcon,
    DollarSign,
    Calendar,
    Loader2,
    Download
} from 'lucide-react';
import {
    XAxis,
    YAxis,
    CartesianGrid,
    Tooltip,
    ResponsiveContainer,
    AreaChart,
    Area,
    BarChart,
    Bar,
    PieChart,
    Pie,
    Cell,
} from 'recharts';
import { supabase } from '../lib/supabase';
import { TENANT_ID } from '../config/constants';

interface RevDay { day: string; revenue: number; booking_count: number }
interface ServiceRow { service_name: string; booking_count: number; total_revenue: number }
interface StatusRow { status: string; count: number }

const STATUS_COLORS: Record<string, string> = {
    confirmed: '#22c55e',
    completed: '#D4AF37',
    pending: '#f97316',
    pending_deposit: '#eab308',
    cancelled: '#ef4444',
    no_show: '#6b7280',
    checked_in: '#3b82f6',
    in_progress: '#8b5cf6',
};

export const Analytics: React.FC = () => {
    const [revData, setRevData] = useState<RevDay[]>([]);
    const [services, setServices] = useState<ServiceRow[]>([]);
    const [statuses, setStatuses] = useState<StatusRow[]>([]);
    const [days, setDays] = useState(30);
    const [loading, setLoading] = useState(true);

    const fetchAll = useCallback(async () => {
        if (!TENANT_ID) return;
        setLoading(true);
        try {
            const [revRes, svcRes, stRes] = await Promise.all([
                supabase.rpc('rpc_analytics_revenue', { p_tenant_id: TENANT_ID, p_days: days }),
                supabase.rpc('rpc_analytics_services', { p_tenant_id: TENANT_ID }),
                supabase.rpc('rpc_analytics_statuses', { p_tenant_id: TENANT_ID }),
            ]);
            if (revRes.data) setRevData((revRes.data as RevDay[]).map(r => ({
                day: new Date(r.day).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
                revenue: Number(r.revenue),
                booking_count: Number(r.booking_count),
            })));
            if (svcRes.data) setServices((svcRes.data as ServiceRow[]).map(s => ({ ...s, total_revenue: Number(s.total_revenue), booking_count: Number(s.booking_count) })));
            if (stRes.data) setStatuses((stRes.data as StatusRow[]).map(s => ({ ...s, count: Number(s.count) })));
        } catch (err) {
            console.error('Analytics fetch error:', err);
        } finally {
            setLoading(false);
        }
    }, [days]);

    useEffect(() => { fetchAll(); }, [fetchAll]);

    const totalRevenue = revData.reduce((s, r) => s + r.revenue, 0);
    const totalBookings = revData.reduce((s, r) => s + r.booking_count, 0);
    const avgPerBooking = totalBookings > 0 ? totalRevenue / totalBookings : 0;

    const exportCSV = () => {
        const header = 'Date,Revenue,Bookings\n';
        const rows = revData.map(r => `${r.day},${r.revenue},${r.booking_count}`).join('\n');
        const blob = new Blob([header + rows], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = `luxe_analytics_${days}d.csv`; a.click();
        URL.revokeObjectURL(url);
    };

    if (loading) {
        return (
            <div className="flex items-center justify-center h-64">
                <Loader2 className="w-8 h-8 text-luxe-gold animate-spin" />
            </div>
        );
    }

    return (
        <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
            {/* Controls */}
            <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                <div className="flex items-center gap-3">
                    <div className="p-3 bg-luxe-gold/10 rounded-2xl border border-luxe-gold/20">
                        <BarChart3 className="w-6 h-6 text-luxe-gold" />
                    </div>
                    <div>
                        <h3 className="text-xl font-bold">Revenue Analytics</h3>
                        <p className="text-xs text-white/40 uppercase tracking-widest">Performance Insights</p>
                    </div>
                </div>
                <div className="flex items-center gap-3">
                    <select
                        aria-label="Select time range"
                        value={days}
                        onChange={(e) => setDays(Number(e.target.value))}
                        className="bg-white/5 border border-white/10 rounded-xl text-xs px-4 py-2.5 outline-none focus:border-luxe-gold/50"
                    >
                        <option value={7}>Last 7 Days</option>
                        <option value={14}>Last 14 Days</option>
                        <option value={30}>Last 30 Days</option>
                        <option value={90}>Last 90 Days</option>
                    </select>
                    <button
                        onClick={exportCSV}
                        className="flex items-center gap-2 bg-luxe-gold/10 text-luxe-gold px-4 py-2.5 rounded-xl font-bold border border-luxe-gold/20 hover:bg-luxe-gold/20 transition-all text-xs"
                    >
                        <Download className="w-4 h-4" />
                        EXPORT CSV
                    </button>
                </div>
            </div>

            {/* Summary Cards */}
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                <SummaryCard label="Total Revenue" value={`$${totalRevenue.toLocaleString()}`} icon={DollarSign} />
                <SummaryCard label="Total Bookings" value={String(totalBookings)} icon={Calendar} />
                <SummaryCard label="Avg / Booking" value={`$${avgPerBooking.toFixed(0)}`} icon={TrendingUp} />
            </div>

            {/* Revenue Chart */}
            <div className="glass-panel p-6">
                <h4 className="font-bold mb-4 flex items-center gap-2">
                    <TrendingUp className="w-5 h-5 text-luxe-gold" />
                    Revenue Over Time
                </h4>
                <div className="h-[300px]">
                    {revData.length > 0 ? (
                        <ResponsiveContainer width="100%" height="100%">
                            <AreaChart data={revData}>
                                <defs>
                                    <linearGradient id="analyticsGrad" x1="0" y1="0" x2="0" y2="1">
                                        <stop offset="5%" stopColor="#D4AF37" stopOpacity={0.3} />
                                        <stop offset="95%" stopColor="#D4AF37" stopOpacity={0} />
                                    </linearGradient>
                                </defs>
                                <CartesianGrid strokeDasharray="3 3" stroke="#ffffff05" vertical={false} />
                                <XAxis dataKey="day" axisLine={false} tickLine={false} tick={{ fill: '#ffffff40', fontSize: 11 }} interval="preserveStartEnd" />
                                <YAxis axisLine={false} tickLine={false} tick={{ fill: '#ffffff40', fontSize: 11 }} tickFormatter={(v: number) => `$${v}`} />
                                <Tooltip
                                    contentStyle={{ backgroundColor: '#1A1A1A', border: '1px solid rgba(255,255,255,0.1)', borderRadius: '12px' }}
                                    itemStyle={{ color: '#D4AF37' }}
                                />
                                <Area type="monotone" dataKey="revenue" name="Revenue" stroke="#D4AF37" strokeWidth={2} fillOpacity={1} fill="url(#analyticsGrad)" />
                                <Area type="monotone" dataKey="booking_count" name="Bookings" stroke="#22c55e" strokeWidth={1.5} fillOpacity={0} />
                            </AreaChart>
                        </ResponsiveContainer>
                    ) : (
                        <div className="flex items-center justify-center h-full text-white/30 text-sm">No data for this period</div>
                    )}
                </div>
            </div>

            {/* Bottom Row: Services + Status */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                {/* Top Services */}
                <div className="glass-panel p-6">
                    <h4 className="font-bold mb-4 flex items-center gap-2">
                        <BarChart3 className="w-5 h-5 text-luxe-gold" />
                        Top Services
                    </h4>
                    {services.length > 0 ? (
                        <div className="h-[250px]">
                            <ResponsiveContainer width="100%" height="100%">
                                <BarChart data={services} layout="vertical">
                                    <CartesianGrid strokeDasharray="3 3" stroke="#ffffff05" horizontal={false} />
                                    <XAxis type="number" axisLine={false} tickLine={false} tick={{ fill: '#ffffff40', fontSize: 11 }} tickFormatter={(v: number) => `$${v}`} />
                                    <YAxis type="category" dataKey="service_name" axisLine={false} tickLine={false} tick={{ fill: '#ffffff80', fontSize: 12 }} width={110} />
                                    <Tooltip
                                        contentStyle={{ backgroundColor: '#1A1A1A', border: '1px solid rgba(255,255,255,0.1)', borderRadius: '12px' }}
                                        formatter={(value: number, name: string) => [name === 'total_revenue' ? `$${value}` : value, name === 'total_revenue' ? 'Revenue' : 'Bookings']}
                                    />
                                    <Bar dataKey="total_revenue" name="Revenue" fill="#D4AF37" radius={[0, 6, 6, 0]} barSize={20} />
                                </BarChart>
                            </ResponsiveContainer>
                        </div>
                    ) : (
                        <p className="text-white/30 text-sm text-center py-12">No booking data yet</p>
                    )}
                </div>

                {/* Booking Statuses */}
                <div className="glass-panel p-6">
                    <h4 className="font-bold mb-4 flex items-center gap-2">
                        <PieIcon className="w-5 h-5 text-luxe-gold" />
                        Booking Statuses
                    </h4>
                    {statuses.length > 0 ? (
                        <div className="flex items-center gap-6">
                            <div className="h-[220px] w-[220px] flex-shrink-0">
                                <ResponsiveContainer width="100%" height="100%">
                                    <PieChart>
                                        <Pie data={statuses} dataKey="count" nameKey="status" cx="50%" cy="50%" innerRadius={55} outerRadius={90} paddingAngle={3} strokeWidth={0}>
                                            {statuses.map((s, i) => (
                                                <Cell key={i} fill={STATUS_COLORS[s.status] ?? '#6b7280'} />
                                            ))}
                                        </Pie>
                                        <Tooltip
                                            contentStyle={{ backgroundColor: '#1A1A1A', border: '1px solid rgba(255,255,255,0.1)', borderRadius: '12px' }}
                                        />
                                    </PieChart>
                                </ResponsiveContainer>
                            </div>
                            <div className="flex-1 space-y-2">
                                {statuses.map((s) => (
                                    <div key={s.status} className="flex items-center justify-between text-sm">
                                        <div className="flex items-center gap-2">
                                            <div className="w-3 h-3 rounded-full" style={{ backgroundColor: STATUS_COLORS[s.status] ?? '#6b7280' }} />
                                            <span className="text-white/70 capitalize">{s.status.replace('_', ' ')}</span>
                                        </div>
                                        <span className="font-bold">{s.count}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    ) : (
                        <p className="text-white/30 text-sm text-center py-12">No status data yet</p>
                    )}
                </div>
            </div>
        </div>
    );
};

const SummaryCard: React.FC<{ label: string; value: string; icon: React.ElementType }> = ({ label, value, icon: Icon }) => (
    <div className="glass-panel p-6 flex items-center gap-4 group hover:gold-border transition-all">
        <div className="w-12 h-12 rounded-2xl bg-luxe-gold/10 flex items-center justify-center group-hover:bg-luxe-gold/20 transition-colors">
            <Icon className="w-6 h-6 text-luxe-gold" />
        </div>
        <div>
            <p className="text-white/40 text-[10px] font-black uppercase tracking-[0.2em]">{label}</p>
            <h3 className="text-2xl font-black">{value}</h3>
        </div>
    </div>
);

--- FILE: C:\Users\syeda\OneDrive\Desktop\Voxali New\dashboard\src\components\BellaAI.tsx ---

import React, { useState, useEffect, useCallback } from 'react';
import {
    Bot,
    ShieldAlert,
    ShieldCheck,
    Save,
    Loader2,

    RotateCcw,
    Megaphone,
    Power,
    PowerOff
} from 'lucide-react';
import { supabase } from '../lib/supabase';
import { TENANT_ID } from '../config/constants';
import { showToast } from './ui/ToastNotification';

interface AgentConfig {
    id: string;
    system_prompt: string;
    announcements: string;
    is_active: boolean;
    updated_at: string;
}

export const BellaAI: React.FC = () => {
    const [config, setConfig] = useState<AgentConfig | null>(null);
    const [editPrompt, setEditPrompt] = useState('');
    const [editAnnouncements, setEditAnnouncements] = useState('');
    const [loading, setLoading] = useState(true);
    const [saving, setSaving] = useState(false);
    const [hasChanges, setHasChanges] = useState(false);

    const fetchConfig = useCallback(async () => {
        if (!TENANT_ID) return;
        setLoading(true);
        const { data, error } = await supabase
            .from('ai_agent_config')
            .select('*')
            .eq('tenant_id', TENANT_ID)
            .single();
        if (!error && data) {
            const c = data as AgentConfig;
            setConfig(c);
            setEditPrompt(c.system_prompt);
            setEditAnnouncements(c.announcements || '');
        }
        setLoading(false);
    }, []);

    useEffect(() => { fetchConfig(); }, [fetchConfig]);

    useEffect(() => {
        if (!config) return;
        setHasChanges(editPrompt !== config.system_prompt || editAnnouncements !== (config.announcements || ''));
    }, [editPrompt, editAnnouncements, config]);

    const handleSave = async () => {
        if (!config) return;
        setSaving(true);
        const { error } = await supabase
            .from('ai_agent_config')
            .update({
                system_prompt: editPrompt,
                announcements: editAnnouncements,
                updated_at: new Date().toISOString(),
            })
            .eq('id', config.id);
        if (!error) {
            setConfig(prev => prev ? { ...prev, system_prompt: editPrompt, announcements: editAnnouncements } : prev);
            setHasChanges(false);
            showToast('Saved successfully!');
        }
        setSaving(false);
    };

    const handleToggle = async () => {
        if (!config) return;
        const newVal = !config.is_active;
        const { error } = await supabase
            .from('ai_agent_config')
            .update({ is_active: newVal, updated_at: new Date().toISOString() })
            .eq('id', config.id);
        if (!error) {
            setConfig(prev => prev ? { ...prev, is_active: newVal } : prev);
            showToast(newVal ? 'Bella is now ONLINE' : 'Bella is now OFFLINE');
        }
    };

    const handleReset = () => {
        if (!config) return;
        setEditPrompt(config.system_prompt);
        setEditAnnouncements(config.announcements || '');
    };

    if (loading) {
        return (
            <div className="flex items-center justify-center h-64">
                <Loader2 className="w-8 h-8 text-luxe-gold animate-spin" />
            </div>
        );
    }

    if (!config) {
        return (
            <div className="glass-panel p-16 flex flex-col items-center justify-center text-center">
                <Bot className="w-12 h-12 text-white/10 mb-4" />
                <h4 className="font-bold text-lg text-white/50">No AI config found</h4>
                <p className="text-white/30 text-sm mt-1">Run the SQL migration to create the ai_agent_config table and seed data.</p>
            </div>
        );
    }

    return (
        <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500">


            {/* Header */}
            <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                <div className="flex items-center gap-3">
                    <div className="p-3 bg-luxe-gold/10 rounded-2xl border border-luxe-gold/20">
                        <Bot className="w-6 h-6 text-luxe-gold" />
                    </div>
                    <div>
                        <h3 className="text-xl font-bold">Bella AI Configuration</h3>
                        <p className="text-xs text-white/40 uppercase tracking-widest">System Prompt & Controls</p>
                    </div>
                </div>

                <div className="flex items-center gap-3">
                    {/* Status Badge */}
                    <div className={`flex items-center gap-2 px-4 py-2 rounded-full border ${config.is_active
                        ? 'bg-green-500/10 text-green-400 border-green-500/20'
                        : 'bg-red-500/10 text-red-400 border-red-500/20'
                        }`}>
                        <div className={`w-2 h-2 rounded-full ${config.is_active ? 'bg-green-500 animate-pulse' : 'bg-red-500'}`} />
                        <span className="text-xs font-bold uppercase tracking-wider">{config.is_active ? 'ONLINE' : 'OFFLINE'}</span>
                    </div>

                    {/* Toggle Button */}
                    <button
                        onClick={handleToggle}
                        className={`p-2.5 rounded-xl border transition-all flex items-center gap-2 text-xs font-bold ${config.is_active
                            ? 'bg-red-500/10 text-red-400 border-red-500/20 hover:bg-red-500/20'
                            : 'bg-green-500/10 text-green-400 border-green-500/20 hover:bg-green-500/20'
                            }`}
                    >
                        {config.is_active ? <PowerOff className="w-4 h-4" /> : <Power className="w-4 h-4" />}
                        {config.is_active ? 'STOP' : 'START'}
                    </button>
                </div>
            </div>

            {/* Emergency Banner */}
            {!config.is_active && (
                <div className="bg-red-500/10 border border-red-500/20 rounded-2xl p-4 flex items-center gap-3">
                    <ShieldAlert className="w-6 h-6 text-red-400 flex-shrink-0" />
                    <div>
                        <p className="font-bold text-red-400 text-sm">Bella is currently OFFLINE</p>
                        <p className="text-red-400/60 text-xs mt-0.5">All incoming calls will go to voicemail. Click START to resume.</p>
                    </div>
                </div>
            )}

            {/* System Prompt Editor */}
            <div className="glass-panel p-6 border border-white/5">
                <div className="flex justify-between items-center mb-4">
                    <h4 className="font-bold flex items-center gap-2">
                        <ShieldCheck className="w-5 h-5 text-luxe-gold" />
                        System Prompt
                    </h4>
                    <span className="text-[10px] text-white/30">
                        Last updated: {new Date(config.updated_at).toLocaleString()}
                    </span>
                </div>
                <textarea
                    value={editPrompt}
                    onChange={(e) => setEditPrompt(e.target.value)}
                    className="w-full bg-white/5 border border-white/10 rounded-xl p-4 text-sm outline-none focus:border-luxe-gold/50 h-[400px] resize-y transition-all font-mono leading-relaxed"
                    spellCheck={false}
                />
                <p className="text-[10px] text-white/30 mt-2">{editPrompt.length} characters</p>
            </div>

            {/* Announcements */}
            <div className="glass-panel p-6 border border-white/5">
                <h4 className="font-bold flex items-center gap-2 mb-4">
                    <Megaphone className="w-5 h-5 text-luxe-gold" />
                    Shop Announcements
                </h4>
                <p className="text-xs text-white/40 mb-3">Bella will mention these to callers. e.g. "We're closing early today at 3 PM."</p>
                <textarea
                    value={editAnnouncements}
                    onChange={(e) => setEditAnnouncements(e.target.value)}
                    placeholder="Enter any temporary announcements here..."
                    className="w-full bg-white/5 border border-white/10 rounded-xl p-4 text-sm outline-none focus:border-luxe-gold/50 h-32 resize-none transition-all"
                />
            </div>

            {/* Action Bar */}
            <div className="flex justify-end gap-3 sticky bottom-4">
                {hasChanges && (
                    <button
                        onClick={handleReset}
                        className="flex items-center gap-2 px-6 py-3 rounded-xl border border-white/10 text-white/60 hover:text-white hover:bg-white/5 transition-all text-sm font-bold"
                    >
                        <RotateCcw className="w-4 h-4" />
                        DISCARD
                    </button>
                )}
                <button
                    onClick={handleSave}
                    disabled={saving || !hasChanges}
                    className="flex items-center gap-2 bg-gold-gradient text-luxe-obsidian px-8 py-3 rounded-xl font-bold shadow-lg shadow-luxe-gold/20 hover:scale-[1.02] active:scale-[0.98] transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                >
                    {saving ? <Loader2 className="w-4 h-4 animate-spin" /> : <Save className="w-4 h-4" />}
                    SAVE CHANGES
                </button>
            </div>
        </div>
    );
};

--- FILE: C:\Users\syeda\OneDrive\Desktop\Voxali New\dashboard\src\components\BookingsCalendar.tsx ---

import React, { useRef, useState, useEffect, useCallback } from 'react';
import {
    Plus, Clock, Scissors, Loader2, X, UserPlus,
    ChevronLeft, ChevronRight, Calendar as CalendarIcon, List, DollarSign
} from 'lucide-react';
import { supabase } from '../lib/supabase';
import { TENANT_ID } from '../config/constants';
import { showToast } from './ui/ToastNotification';

interface Staff { id: string; full_name: string; role: string; color: string; }
interface Service { id: string; name: string; duration: number; price: number; }
interface Booking {
    id: string; stylist_id: string; client_name: string; service_name: string;
    start_hour: number; duration_hours: number; status: string;
    start_at: string; date_label: string; price: number;
    payment_status: string; source: string;
}

type ViewMode = 'today' | 'weekly' | 'monthly';

const timeSlots = Array.from({ length: 13 }, (_, i) => `${i + 8}:00`);

const statusColors: Record<string, { bg: string; text: string; border: string }> = {
    confirmed: { bg: 'bg-luxe-gold', text: 'text-luxe-obsidian', border: 'border-luxe-gold/50' },
    completed: { bg: 'bg-green-500/20', text: 'text-green-400', border: 'border-green-500/30' },
    pending: { bg: 'bg-yellow-500/15', text: 'text-yellow-300', border: 'border-yellow-500/30' },
    checked_in: { bg: 'bg-blue-500/20', text: 'text-blue-400', border: 'border-blue-500/30' },
    in_progress: { bg: 'bg-purple-500/20', text: 'text-purple-400', border: 'border-purple-500/30' },
    cancelled: { bg: 'bg-red-500/10', text: 'text-red-400/60', border: 'border-red-500/20' },
    no_show: { bg: 'bg-red-500/10', text: 'text-red-300/60', border: 'border-red-500/20' },
    pending_deposit: { bg: 'bg-orange-500/15', text: 'text-orange-300', border: 'border-orange-500/30' },
};

// Helper: get date range based on view mode
function getDateRange(view: ViewMode): { start: Date; end: Date; label: string } {
    const now = new Date();
    if (view === 'today') {
        const start = new Date(now); start.setHours(0, 0, 0, 0);
        const end = new Date(now); end.setHours(23, 59, 59, 999);
        return { start, end, label: now.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' }) };
    }
    if (view === 'weekly') {
        const dayOfWeek = now.getDay();
        const start = new Date(now);
        start.setDate(now.getDate() - dayOfWeek);
        start.setHours(0, 0, 0, 0);
        const end = new Date(start);
        end.setDate(start.getDate() + 6);
        end.setHours(23, 59, 59, 999);
        const startLabel = start.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        const endLabel = end.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        return { start, end, label: `${startLabel} - ${endLabel}` };
    }
    // monthly
    const start = new Date(now.getFullYear(), now.getMonth(), 1);
    const end = new Date(now.getFullYear(), now.getMonth() + 1, 0, 23, 59, 59, 999);
    return { start, end, label: now.toLocaleDateString('en-US', { month: 'long', year: 'numeric' }) };
}

export const BookingsCalendar: React.FC = () => {
    const [staff, setStaff] = useState<Staff[]>([]);
    const [services, setServices] = useState<Service[]>([]);
    const [bookings, setBookings] = useState<Booking[]>([]);
    const [loading, setLoading] = useState(true);
    const [showModal, setShowModal] = useState(false);
    const [saving, setSaving] = useState(false);
    const [viewMode, setViewMode] = useState<ViewMode>('today');
    const scrollRef = useRef<HTMLDivElement>(null);

    // Walk-in form
    const [wName, setWName] = useState('');
    const [wPhone, setWPhone] = useState('');
    const [wService, setWService] = useState('');
    const [wStylist, setWStylist] = useState('');
    const [wTime, setWTime] = useState('');

    const fetchData = useCallback(async () => {
        if (!TENANT_ID) return;
        setLoading(true);

        // Fetch staff
        const { data: staffData } = await supabase
            .from('staff').select('id, full_name, role, color')
            .eq('tenant_id', TENANT_ID).eq('is_active', true).order('created_at');

        // Fetch services
        const { data: svcData } = await supabase
            .from('services').select('id, name, duration, price')
            .eq('tenant_id', TENANT_ID).eq('is_active', true).order('name');

        // Fetch bookings for the selected date range
        const { start, end } = getDateRange(viewMode);
        const { data: bookData } = await supabase
            .from('bookings').select(`
                id, stylist_id, status, start_at, end_at, total_price, payment_status, source,
                clients(name), services(name)
            `)
            .eq('tenant_id', TENANT_ID)
            .gte('start_at', start.toISOString())
            .lte('start_at', end.toISOString())
            .not('status', 'eq', 'cancelled')
            .order('start_at');

        if (staffData) setStaff(staffData);
        if (svcData) setServices(svcData);
        if (bookData) {
            setBookings(bookData.map((b: any) => {
                const startDt = new Date(b.start_at);
                const endDt = new Date(b.end_at);
                return {
                    id: b.id,
                    stylist_id: b.stylist_id,
                    client_name: b.clients?.name || 'Walk-in',
                    service_name: b.services?.name || 'Service',
                    start_hour: startDt.getHours() + startDt.getMinutes() / 60,
                    duration_hours: (endDt.getTime() - startDt.getTime()) / 3600000,
                    status: b.status,
                    start_at: b.start_at,
                    date_label: startDt.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }),
                    price: b.total_price || 0,
                    payment_status: b.payment_status || 'unpaid',
                    source: b.source || 'phone',
                };
            }));
        }
        setLoading(false);
    }, [viewMode]);

    useEffect(() => { fetchData(); }, [fetchData]);

    const handleWalkin = async () => {
        if (!wName || !wPhone || !wService || !wStylist) return;
        setSaving(true);

        let startTime: string;
        if (wTime) {
            const [h, m] = wTime.split(':').map(Number);
            const dt = new Date(); dt.setHours(h, m, 0, 0);
            startTime = dt.toISOString();
        } else {
            startTime = new Date().toISOString();
        }

        const { data, error } = await supabase.rpc('rpc_add_walkin', {
            p_tenant_id: TENANT_ID,
            p_client_name: wName,
            p_client_phone: wPhone,
            p_service_id: wService,
            p_stylist_id: wStylist,
            p_start_time: startTime,
        });

        if (!error && data?.success) {
            showToast('Walk-in booked!');
            setShowModal(false);
            setWName(''); setWPhone(''); setWService(''); setWStylist(''); setWTime('');
            fetchData();
        } else {
            showToast(data?.error || error?.message || 'Failed', 'error');
        }
        setSaving(false);
    };

    // Confirm payment handler
    const handleConfirmPayment = async (bookingId: string) => {
        const { error } = await supabase
            .from('bookings')
            .update({ payment_status: 'paid' })
            .eq('id', bookingId);
        if (!error) {
            showToast('Payment confirmed!');
            fetchData();
        } else {
            showToast('Failed: ' + error.message, 'error');
        }
    };

    // Group bookings by date for list view
    const bookingsByDate = bookings.reduce<Record<string, Booking[]>>((acc, b) => {
        const key = b.date_label;
        if (!acc[key]) acc[key] = [];
        acc[key].push(b);
        return acc;
    }, {});

    const { label: rangeLabel } = getDateRange(viewMode);
    const displayStaff = staff.slice(0, 5);

    if (loading) {
        return <div className="flex items-center justify-center h-64"><Loader2 className="w-8 h-8 text-luxe-gold animate-spin" /></div>;
    }

    return (
        <div className="h-full flex flex-col space-y-6 animate-in fade-in duration-500 overflow-hidden">


            {/* Header with View Tabs */}
            <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div className="flex items-center gap-3">
                    {/* View Mode Tabs */}
                    <div className="flex items-center bg-white/5 p-1 rounded-xl border border-white/10">
                        {(['today', 'weekly', 'monthly'] as ViewMode[]).map(mode => (
                            <button
                                key={mode}
                                onClick={() => setViewMode(mode)}
                                className={`px-4 py-2 rounded-lg text-xs font-bold uppercase tracking-wider transition-all ${viewMode === mode
                                    ? 'bg-luxe-gold text-luxe-obsidian shadow-lg'
                                    : 'text-white/50 hover:text-white hover:bg-white/5'
                                    }`}
                            >
                                {mode}
                            </button>
                        ))}
                    </div>
                    {/* Date Label */}
                    <span className="text-sm text-white/40 font-medium hidden md:block">{rangeLabel}</span>
                </div>
                <div className="flex items-center gap-3">
                    <button
                        onClick={() => setShowModal(true)}
                        className="bg-gold-gradient text-luxe-obsidian px-6 py-2 rounded-xl font-bold flex items-center gap-2 shadow-lg shadow-luxe-gold/20 hover:scale-[1.02] active:scale-[0.98] transition-all"
                    >
                        <Plus className="w-5 h-5" />
                        <span className="text-sm">ADD WALK-IN</span>
                    </button>
                </div>
            </div>

            {/* Calendar Grid (Today View) */}
            {viewMode === 'today' && (
                <div className="flex-1 glass-panel border border-white/5 flex flex-col overflow-hidden relative">
                    {/* Staff Header */}
                    <div className="grid border-b border-white/5 bg-white/5" style={{ gridTemplateColumns: `80px repeat(${displayStaff.length}, 1fr)` }}>
                        <div className="p-4 border-r border-white/5 flex items-center justify-center">
                            <Clock className="w-4 h-4 text-white/20" />
                        </div>
                        {displayStaff.map(s => (
                            <div key={s.id} className="p-4 border-r border-white/5 flex items-center gap-3">
                                <div className="w-8 h-8 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-xs font-bold" style={{ color: s.color }}>
                                    {s.full_name.charAt(0)}
                                </div>
                                <div className="min-w-0">
                                    <p className="text-xs font-bold truncate">{s.full_name.split(' ')[0]}</p>
                                    <p className="text-[9px] text-white/30 uppercase tracking-tighter truncate">{s.role}</p>
                                </div>
                            </div>
                        ))}
                    </div>

                    {/* Scrollable Grid */}
                    <div ref={scrollRef} className="flex-1 overflow-y-auto custom-scrollbar relative">
                        <div className="relative" style={{ gridTemplateColumns: `80px repeat(${displayStaff.length}, 1fr)`, display: 'grid' }}>
                            <div className="flex flex-col">
                                {timeSlots.map(time => (
                                    <div key={time} className="h-20 border-r border-b border-white/5 flex items-start justify-center pt-2">
                                        <span className="text-[10px] font-bold text-white/20 uppercase tracking-tighter">{time}</span>
                                    </div>
                                ))}
                            </div>
                            {displayStaff.map(s => (
                                <div key={s.id} className="relative border-r border-white/5 min-h-full">
                                    {timeSlots.map(time => (
                                        <div key={time} className="h-20 border-b border-white/5 w-full pointer-events-none" />
                                    ))}
                                    {bookings.filter(b => b.stylist_id === s.id).map(b => {
                                        const colors = statusColors[b.status] || statusColors.pending;
                                        return (
                                            <div
                                                key={b.id}
                                                className={`absolute left-1 right-1 rounded-xl p-3 border shadow-2xl transition-all hover:scale-[1.02] cursor-pointer group z-10 ${colors.bg} ${colors.text} ${colors.border}`}
                                                style={{
                                                    top: `${(b.start_hour - 8) * 80}px`,
                                                    height: `${Math.max(b.duration_hours * 80, 40)}px`
                                                }}
                                            >
                                                <div className="flex justify-between items-start">
                                                    <div className="min-w-0">
                                                        <p className="text-[11px] font-black uppercase tracking-tight truncate">{b.client_name}</p>
                                                        <p className="text-[10px] font-bold mt-0.5 truncate opacity-70">{b.service_name}</p>
                                                    </div>
                                                    <Scissors className="w-3 h-3 opacity-40" />
                                                </div>
                                                <div className="mt-auto pt-1 flex items-center justify-between">
                                                    <span className="text-[9px] font-bold opacity-50">
                                                        {Math.floor(b.start_hour)}:{String(Math.round((b.start_hour % 1) * 60)).padStart(2, '0')}
                                                    </span>
                                                    <span className="text-[8px] font-bold uppercase opacity-60">{b.status.replace('_', ' ')}</span>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            )}

            {/* List View (Weekly / Monthly) */}
            {(viewMode === 'weekly' || viewMode === 'monthly') && (
                <div className="flex-1 glass-panel border border-white/5 overflow-y-auto custom-scrollbar p-6 space-y-6">
                    {Object.keys(bookingsByDate).length === 0 ? (
                        <div className="flex flex-col items-center justify-center h-48 text-white/30">
                            <CalendarIcon className="w-12 h-12 mb-3 opacity-30" />
                            <p className="text-sm font-bold">No bookings found for this period</p>
                        </div>
                    ) : (
                        Object.entries(bookingsByDate).map(([dateLabel, dayBookings]) => (
                            <div key={dateLabel}>
                                {/* Day Header */}
                                <div className="flex items-center gap-3 mb-3">
                                    <div className="w-2 h-2 rounded-full bg-luxe-gold" />
                                    <h4 className="text-sm font-bold text-luxe-gold uppercase tracking-wider">{dateLabel}</h4>
                                    <span className="text-xs text-white/30 font-medium">{dayBookings.length} booking{dayBookings.length !== 1 ? 's' : ''}</span>
                                    <div className="flex-1 h-px bg-white/5" />
                                </div>
                                {/* Booking Cards */}
                                <div className="space-y-2">
                                    {dayBookings.map(b => {
                                        const colors = statusColors[b.status] || statusColors.pending;
                                        const timeStr = `${Math.floor(b.start_hour)}:${String(Math.round((b.start_hour % 1) * 60)).padStart(2, '0')}`;
                                        const stylist = staff.find(s => s.id === b.stylist_id);
                                        return (
                                            <div key={b.id} className={`flex items-center gap-4 p-4 rounded-xl border transition-all hover:bg-white/5 ${colors.border} bg-white/[0.02]`}>
                                                {/* Time */}
                                                <div className="w-14 text-center shrink-0">
                                                    <p className="text-sm font-black text-white/70">{timeStr}</p>
                                                </div>
                                                {/* Divider */}
                                                <div className={`w-1 h-10 rounded-full ${colors.bg}`} />
                                                {/* Details */}
                                                <div className="flex-1 min-w-0">
                                                    <p className="text-sm font-bold truncate">{b.client_name}</p>
                                                    <p className="text-xs text-white/40 truncate">{b.service_name}</p>
                                                </div>
                                                {/* Stylist */}
                                                <div className="flex items-center gap-2 shrink-0">
                                                    <div
                                                        className="w-7 h-7 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-[10px] font-bold"
                                                        style={{ color: stylist?.color || '#999' }}
                                                    >
                                                        {stylist?.full_name?.charAt(0) || '?'}
                                                    </div>
                                                    <span className="text-xs text-white/40 hidden lg:block">{stylist?.full_name?.split(' ')[0] || '—'}</span>
                                                </div>
                                                {/* Price */}
                                                <div className="text-right shrink-0 w-16">
                                                    <p className="text-sm font-bold text-luxe-gold">${b.price}</p>
                                                </div>
                                                {/* Status Badge */}
                                                <span className={`text-[9px] font-bold uppercase tracking-wider px-2 py-1 rounded-lg shrink-0 ${colors.bg} ${colors.text}`}>
                                                    {b.status.replace('_', ' ')}
                                                </span>
                                                {/* Payment Badge */}
                                                {b.payment_status === 'paid' ? (
                                                    <span className="text-[9px] font-bold uppercase tracking-wider px-2 py-1 rounded-lg shrink-0 bg-green-500/15 text-green-400 border border-green-500/20">
                                                        ✓ PAID
                                                    </span>
                                                ) : b.payment_status === 'advance' ? (
                                                    <span className="text-[9px] font-bold uppercase tracking-wider px-2 py-1 rounded-lg shrink-0 bg-blue-500/15 text-blue-400 border border-blue-500/20">
                                                        ADVANCE
                                                    </span>
                                                ) : (
                                                    <button
                                                        onClick={() => handleConfirmPayment(b.id)}
                                                        title="Confirm Payment"
                                                        className="text-[9px] font-bold uppercase tracking-wider px-2 py-1 rounded-lg shrink-0 bg-orange-500/15 text-orange-400 border border-orange-500/20 hover:bg-orange-500/30 transition-colors cursor-pointer flex items-center gap-1"
                                                    >
                                                        <DollarSign className="w-3 h-3" /> CONFIRM PAY
                                                    </button>
                                                )}
                                                {/* Source badge for walk-ins */}
                                                {b.source === 'walk_in' && (
                                                    <span className="text-[8px] font-bold uppercase tracking-wider px-1.5 py-0.5 rounded bg-white/5 text-white/40 border border-white/10 shrink-0">
                                                        WALK-IN
                                                    </span>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        ))
                    )}
                </div>
            )}

            {/* Stats Bar */}
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 pb-2">
                <div className="glass-panel p-4 text-center">
                    <p className="text-[10px] text-white/40 uppercase font-bold mb-1">Total</p>
                    <p className="text-xl font-black text-luxe-gold">{bookings.length}</p>
                </div>
                <div className="glass-panel p-4 text-center">
                    <p className="text-[10px] text-white/40 uppercase font-bold mb-1">Confirmed</p>
                    <p className="text-xl font-black text-green-400">{bookings.filter(b => b.status === 'confirmed').length}</p>
                </div>
                <div className="glass-panel p-4 text-center">
                    <p className="text-[10px] text-white/40 uppercase font-bold mb-1">Pending</p>
                    <p className="text-xl font-black text-yellow-400">{bookings.filter(b => b.status === 'pending' || b.status === 'pending_deposit').length}</p>
                </div>
                <div className="glass-panel p-4 text-center">
                    <p className="text-[10px] text-white/40 uppercase font-bold mb-1">Completed</p>
                    <p className="text-xl font-black text-blue-400">{bookings.filter(b => b.status === 'completed').length}</p>
                </div>
            </div>

            {/* Walk-in Modal */}
            {showModal && (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" onClick={() => setShowModal(false)}>
                    <div className="bg-luxe-obsidian border border-white/10 rounded-2xl p-8 w-full max-w-lg shadow-2xl" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="text-xl font-bold flex items-center gap-2">
                                <UserPlus className="w-6 h-6 text-luxe-gold" />
                                Add Walk-in Customer
                            </h3>
                            <button onClick={() => setShowModal(false)} title="Close" className="p-2 hover:bg-white/10 rounded-xl transition-all">
                                <X className="w-5 h-5" />
                            </button>
                        </div>

                        <div className="space-y-4">
                            <div>
                                <label className="text-xs font-bold text-white/50 uppercase tracking-wider mb-2 block">Client Name *</label>
                                <input
                                    value={wName} onChange={e => setWName(e.target.value)}
                                    placeholder="e.g. Jessica Martinez"
                                    className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-luxe-gold/50 transition-all"
                                />
                            </div>
                            <div>
                                <label className="text-xs font-bold text-white/50 uppercase tracking-wider mb-2 block">Phone Number *</label>
                                <input
                                    value={wPhone} onChange={e => setWPhone(e.target.value)}
                                    placeholder="+1 555-0101"
                                    className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-luxe-gold/50 transition-all"
                                />
                            </div>
                            <div>
                                <label className="text-xs font-bold text-white/50 uppercase tracking-wider mb-2 block">Service *</label>
                                <select
                                    value={wService} onChange={e => setWService(e.target.value)}
                                    title="Select a service"
                                    className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-luxe-gold/50 transition-all"
                                >
                                    <option value="">Select service...</option>
                                    {services.map(s => (
                                        <option key={s.id} value={s.id}>{s.name} — ${s.price} ({s.duration} min)</option>
                                    ))}
                                </select>
                            </div>
                            <div>
                                <label className="text-xs font-bold text-white/50 uppercase tracking-wider mb-2 block">Stylist *</label>
                                <select
                                    value={wStylist} onChange={e => setWStylist(e.target.value)}
                                    title="Select a stylist"
                                    className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-luxe-gold/50 transition-all"
                                >
                                    <option value="">Select stylist...</option>
                                    {staff.map(s => (
                                        <option key={s.id} value={s.id}>{s.full_name} ({s.role})</option>
                                    ))}
                                </select>
                            </div>
                            <div>
                                <label className="text-xs font-bold text-white/50 uppercase tracking-wider mb-2 block">Start Time (optional — defaults to NOW)</label>
                                <input
                                    type="time" value={wTime} onChange={e => setWTime(e.target.value)}
                                    placeholder="Select time"
                                    className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-luxe-gold/50 transition-all"
                                />
                            </div>
                        </div>

                        <button
                            onClick={handleWalkin}
                            disabled={saving || !wName || !wPhone || !wService || !wStylist}
                            className="w-full mt-6 bg-gold-gradient text-luxe-obsidian font-bold py-3 rounded-xl shadow-lg shadow-luxe-gold/20 hover:scale-[1.02] active:scale-[0.98] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                        >
                            {saving ? <Loader2 className="w-5 h-5 animate-spin" /> : <Plus className="w-5 h-5" />}
                            {saving ? 'BOOKING...' : 'CONFIRM WALK-IN'}
                        </button>
                    </div>
                </div>
            )}
        </div>
    );
};

--- FILE: C:\Users\syeda\OneDrive\Desktop\Voxali New\dashboard\src\components\CallLogs.tsx ---

import React, { useState, useEffect, useCallback } from 'react';
import {
    PhoneCall, Search, Play, Clock, Calendar, CheckCircle2,
    MessageSquare, ChevronRight, Bot, Loader2, X, Filter,
    FileText, Volume2
} from 'lucide-react';
import { supabase } from '../lib/supabase';
import { TENANT_ID } from '../config/constants';
import { showToast } from './ui/ToastNotification';

interface CallLog {
    id: string; caller_phone: string; call_duration: number;
    transcript: string; action_taken: string; created_at: string;
    booking_id: string | null; recording_url?: string | null;
}

export const CallLogs: React.FC = () => {
    const [logs, setLogs] = useState<CallLog[]>([]);
    const [loading, setLoading] = useState(true);
    const [selectedLog, setSelectedLog] = useState<CallLog | null>(null);
    const [search, setSearch] = useState('');
    const [showTranscript, setShowTranscript] = useState(false);

    // Date range filter
    const [dateFrom, setDateFrom] = useState('');
    const [dateTo, setDateTo] = useState('');

    const fetchLogs = useCallback(async () => {
        if (!TENANT_ID) return;
        setLoading(true);

        let query = supabase
            .from('call_logs')
            .select('*')
            .eq('tenant_id', TENANT_ID)
            .order('created_at', { ascending: false })
            .limit(50);

        if (dateFrom) {
            query = query.gte('created_at', new Date(dateFrom).toISOString());
        }
        if (dateTo) {
            const endDate = new Date(dateTo);
            endDate.setHours(23, 59, 59, 999);
            query = query.lte('created_at', endDate.toISOString());
        }

        const { data } = await query;
        if (data) {
            setLogs(data);
            if (data.length > 0) setSelectedLog(data[0]);
            else setSelectedLog(null);
        }
        setLoading(false);
    }, [dateFrom, dateTo]);

    useEffect(() => { fetchLogs(); }, [fetchLogs]);

    const formatDuration = (seconds: number) => {
        if (!seconds) return '0:00';
        const m = Math.floor(seconds / 60);
        const s = seconds % 60;
        return `${m}:${String(s).padStart(2, '0')}`;
    };

    const formatTime = (iso: string) => {
        const d = new Date(iso);
        const now = new Date();
        const diff = now.getTime() - d.getTime();
        if (diff < 86400000) return d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        if (diff < 172800000) return 'Yesterday';
        return d.toLocaleDateString();
    };

    const getStatus = (log: CallLog): 'Booked' | 'Inquiry' | 'Missed' => {
        if (log.booking_id) return 'Booked';
        if (log.action_taken?.toLowerCase().includes('miss') || !log.transcript) return 'Missed';
        return 'Inquiry';
    };

    const filtered = logs.filter(l =>
        l.caller_phone?.includes(search) ||
        l.transcript?.toLowerCase().includes(search.toLowerCase()) ||
        l.action_taken?.toLowerCase().includes(search.toLowerCase())
    );

    const clearFilters = () => {
        setDateFrom('');
        setDateTo('');
    };

    if (loading) {
        return <div className="flex items-center justify-center h-64"><Loader2 className="w-8 h-8 text-luxe-gold animate-spin" /></div>;
    }

    return (
        <div className="h-full flex flex-col space-y-6 animate-in fade-in duration-500 overflow-hidden">
            {/* Header */}
            <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div className="flex items-center gap-3">
                    <div className="p-3 bg-luxe-gold/10 rounded-2xl border border-luxe-gold/20">
                        <PhoneCall className="w-6 h-6 text-luxe-gold" />
                    </div>
                    <div>
                        <h3 className="text-xl font-bold">Bella Call Logs</h3>
                        <p className="text-xs text-white/40 uppercase tracking-widest">Live Voice Agent Activity</p>
                    </div>
                </div>
                <div className="flex items-center gap-3 flex-wrap">
                    {/* Date Range Filter */}
                    <div className="flex items-center gap-2 bg-white/5 border border-white/10 rounded-xl px-3 py-1.5">
                        <Filter className="w-3.5 h-3.5 text-white/30" />
                        <input
                            type="date" value={dateFrom}
                            onChange={e => setDateFrom(e.target.value)}
                            className="bg-transparent text-xs outline-none text-white/60 w-28"
                            title="From date"
                        />
                        <span className="text-white/20 text-xs">→</span>
                        <input
                            type="date" value={dateTo}
                            onChange={e => setDateTo(e.target.value)}
                            className="bg-transparent text-xs outline-none text-white/60 w-28"
                            title="To date"
                        />
                        {(dateFrom || dateTo) && (
                            <button onClick={clearFilters} className="p-0.5 hover:bg-white/10 rounded transition-all" title="Clear dates">
                                <X className="w-3.5 h-3.5 text-white/40" />
                            </button>
                        )}
                    </div>
                    <div className="relative">
                        <Search className="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-white/30" />
                        <input
                            type="text" placeholder="Search logs..." value={search}
                            onChange={e => setSearch(e.target.value)}
                            className="bg-white/5 border border-white/10 rounded-xl pl-10 pr-4 py-2 text-xs outline-none focus:border-luxe-gold/50 w-64"
                        />
                    </div>
                    <button
                        onClick={fetchLogs}
                        className="bg-gold-gradient text-luxe-obsidian px-6 py-2 rounded-xl font-bold flex items-center gap-2 shadow-lg shadow-luxe-gold/20 hover:scale-[1.02] active:scale-[0.98] transition-all"
                    >
                        REFRESH
                    </button>
                </div>
            </div>

            <div className="flex-1 grid grid-cols-1 lg:grid-cols-3 gap-6 overflow-hidden">
                {/* Logs List */}
                <div className="lg:col-span-1 glass-panel flex flex-col overflow-hidden border border-white/5">
                    <div className="p-4 border-b border-white/5 bg-white/5 flex items-center justify-between">
                        <span className="text-[10px] font-black uppercase tracking-[0.2em] text-white/30">Recent Conversations</span>
                        <span className="text-[10px] bg-luxe-gold/20 text-luxe-gold px-2 py-0.5 rounded-full font-bold">{filtered.length} CALLS</span>
                    </div>
                    <div className="flex-1 overflow-y-auto custom-scrollbar">
                        {filtered.length === 0 && (
                            <div className="p-8 text-center text-white/30 text-sm">No call logs found</div>
                        )}
                        {filtered.map(log => {
                            const status = getStatus(log);
                            return (
                                <button
                                    key={log.id}
                                    onClick={() => setSelectedLog(log)}
                                    className={`w-full p-5 text-left border-b border-white/5 transition-all hover:bg-white/[0.03] group relative ${selectedLog?.id === log.id ? 'bg-white/[0.05]' : ''}`}
                                >
                                    <div className="flex justify-between items-start mb-1">
                                        <h4 className={`font-bold text-sm ${selectedLog?.id === log.id ? 'text-luxe-gold' : ''}`}>
                                            {log.caller_phone || 'Unknown'}
                                        </h4>
                                        <span className="text-[10px] text-white/30">{formatTime(log.created_at)}</span>
                                    </div>
                                    <p className="text-[11px] text-white/40 truncate">{log.action_taken || log.transcript || 'No details'}</p>
                                    <div className="flex items-center gap-3 mt-3">
                                        <span className={`text-[9px] font-bold px-2 py-0.5 rounded ${status === 'Booked' ? 'bg-green-500/10 text-green-400' :
                                            status === 'Inquiry' ? 'bg-blue-500/10 text-blue-400' :
                                                'bg-red-500/10 text-red-400'
                                            }`}>{status.toUpperCase()}</span>
                                        <span className="text-[9px] text-white/20 flex items-center gap-1 font-bold">
                                            <Clock className="w-2.5 h-2.5" /> {formatDuration(log.call_duration)}
                                        </span>
                                        {log.recording_url && (
                                            <span className="text-[9px] text-luxe-gold/60 flex items-center gap-1 font-bold">
                                                <Volume2 className="w-2.5 h-2.5" /> REC
                                            </span>
                                        )}
                                    </div>
                                    {selectedLog?.id === log.id && (
                                        <div className="absolute left-0 top-0 bottom-0 w-1 bg-luxe-gold shadow-[0_0_10px_#D4AF37]" />
                                    )}
                                </button>
                            );
                        })}
                    </div>
                </div>

                {/* Call Detail */}
                <div className="lg:col-span-2 flex flex-col gap-6 overflow-hidden">
                    {selectedLog ? (
                        <>
                            <div className="glass-panel p-8 flex flex-col relative overflow-hidden">
                                <div className="absolute top-0 right-0 p-8 opacity-[0.03]">
                                    <PhoneCall className="w-48 h-48 -mr-12 -mt-12" />
                                </div>
                                <div className="flex justify-between items-start mb-10 relative z-10">
                                    <div className="flex items-center gap-6">
                                        <div className="w-20 h-20 rounded-3xl bg-gold-gradient flex items-center justify-center shadow-xl shadow-luxe-gold/20">
                                            <Bot className="w-10 h-10 text-luxe-obsidian" />
                                        </div>
                                        <div>
                                            <div className="flex items-center gap-3 mb-1">
                                                <h2 className="text-2xl font-black tracking-tight">{selectedLog.caller_phone || 'Unknown'}</h2>
                                                <span className={`text-[9px] font-bold px-2 py-0.5 rounded ${getStatus(selectedLog) === 'Booked' ? 'bg-green-500/10 text-green-400' :
                                                    getStatus(selectedLog) === 'Inquiry' ? 'bg-blue-500/10 text-blue-400' :
                                                        'bg-red-500/10 text-red-400'
                                                    }`}>{getStatus(selectedLog).toUpperCase()}</span>
                                            </div>
                                            <p className="text-white/40 text-sm flex items-center gap-2">
                                                <Calendar className="w-4 h-4" />
                                                {new Date(selectedLog.created_at).toLocaleString()} • {formatDuration(selectedLog.call_duration)}
                                            </p>
                                        </div>
                                    </div>
                                    {/* Action Buttons */}
                                    <div className="flex items-center gap-2 relative z-10">
                                        {selectedLog.recording_url && (
                                            <button
                                                onClick={() => window.open(selectedLog.recording_url!, '_blank')}
                                                className="flex items-center gap-2 px-4 py-2 rounded-xl bg-green-500/10 text-green-400 border border-green-500/20 text-xs font-bold hover:bg-green-500/20 transition-all"
                                            >
                                                <Play className="w-4 h-4" /> Play Recording
                                            </button>
                                        )}
                                        {selectedLog.transcript && (
                                            <button
                                                onClick={() => setShowTranscript(true)}
                                                className="flex items-center gap-2 px-4 py-2 rounded-xl bg-blue-500/10 text-blue-400 border border-blue-500/20 text-xs font-bold hover:bg-blue-500/20 transition-all"
                                            >
                                                <FileText className="w-4 h-4" /> View Transcript
                                            </button>
                                        )}
                                    </div>
                                </div>

                                {/* Action Taken */}
                                {selectedLog.action_taken && (
                                    <div className="bg-luxe-gold/5 border border-luxe-gold/10 rounded-3xl p-6 mb-6 relative z-10">
                                        <div className="flex items-center gap-2 mb-3 text-luxe-gold">
                                            <CheckCircle2 className="w-4 h-4" />
                                            <span className="text-[10px] font-black uppercase tracking-widest">Action Taken</span>
                                        </div>
                                        <p className="text-white/80 text-sm">{selectedLog.action_taken}</p>
                                    </div>
                                )}

                                {/* Transcript Preview */}
                                {selectedLog.transcript && (
                                    <div className="bg-white/[0.03] border border-white/5 rounded-3xl p-6 relative z-10">
                                        <div className="flex items-center gap-2 mb-4 text-luxe-gold">
                                            <MessageSquare className="w-4 h-4" />
                                            <span className="text-[10px] font-black uppercase tracking-widest">AI Conversation Transcript</span>
                                        </div>
                                        <p className="text-white/70 text-sm leading-relaxed italic whitespace-pre-wrap line-clamp-6">
                                            "{selectedLog.transcript}"
                                        </p>
                                        {selectedLog.transcript.length > 300 && (
                                            <button
                                                onClick={() => setShowTranscript(true)}
                                                className="mt-3 text-luxe-gold text-xs font-bold hover:underline"
                                            >
                                                Read full transcript →
                                            </button>
                                        )}
                                    </div>
                                )}
                            </div>

                            {/* Info Cards */}
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div className="glass-panel p-6 flex items-center gap-4 group hover:gold-border transition-all">
                                    <div className="w-10 h-10 rounded-xl bg-green-500/10 flex items-center justify-center">
                                        <CheckCircle2 className="w-5 h-5 text-green-400" />
                                    </div>
                                    <div>
                                        <p className="text-[10px] text-white/30 uppercase font-bold">Status</p>
                                        <p className="text-sm font-bold">{getStatus(selectedLog)}</p>
                                    </div>
                                    <ChevronRight className="w-4 h-4 ml-auto text-white/10" />
                                </div>
                                <div className="glass-panel p-6 flex items-center gap-4 group hover:gold-border transition-all">
                                    <div className="w-10 h-10 rounded-xl bg-blue-500/10 flex items-center justify-center">
                                        <Clock className="w-5 h-5 text-blue-400" />
                                    </div>
                                    <div>
                                        <p className="text-[10px] text-white/30 uppercase font-bold">Duration</p>
                                        <p className="text-sm font-bold">{formatDuration(selectedLog.call_duration)}</p>
                                    </div>
                                    <ChevronRight className="w-4 h-4 ml-auto text-white/10" />
                                </div>
                            </div>
                        </>
                    ) : (
                        <div className="glass-panel flex-1 flex flex-col items-center justify-center text-center p-20">
                            <Bot className="w-16 h-16 text-white/5 mb-6 animate-pulse" />
                            <h3 className="text-xl font-bold">No call logs yet</h3>
                            <p className="text-white/30 mt-2">Bella's conversations will appear here</p>
                        </div>
                    )}
                </div>
            </div>

            {/* Transcript Modal */}
            {showTranscript && selectedLog?.transcript && (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" onClick={() => setShowTranscript(false)}>
                    <div className="bg-luxe-obsidian border border-white/10 rounded-2xl p-8 w-full max-w-2xl shadow-2xl max-h-[80vh] flex flex-col" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="text-xl font-bold flex items-center gap-2">
                                <MessageSquare className="w-6 h-6 text-luxe-gold" />
                                Full Transcript
                            </h3>
                            <div className="flex items-center gap-3">
                                <span className="text-xs text-white/30">{selectedLog.caller_phone} • {new Date(selectedLog.created_at).toLocaleString()}</span>
                                <button onClick={() => setShowTranscript(false)} className="p-2 hover:bg-white/10 rounded-xl transition-all">
                                    <X className="w-5 h-5" />
                                </button>
                            </div>
                        </div>
                        <div className="flex-1 overflow-y-auto custom-scrollbar bg-white/[0.02] border border-white/5 rounded-2xl p-6">
                            <p className="text-white/80 text-sm leading-relaxed whitespace-pre-wrap">
                                {selectedLog.transcript}
                            </p>
                        </div>
                    </div>
                </div>
            )}
        </div>
    );
};

--- FILE: C:\Users\syeda\OneDrive\Desktop\Voxali New\dashboard\src\components\ClientCRM.tsx ---

import React, { useState, useEffect, useCallback, useRef } from 'react';
import {
    Users, Search, Plus, CreditCard, Calendar, DollarSign,
    MoreHorizontal, Mail, Phone, Tag, Loader2, X, Edit3,
    Trash2, Download, FileText
} from 'lucide-react';
import { supabase } from '../lib/supabase';
import { TENANT_ID } from '../config/constants';
import { showToast } from './ui/ToastNotification';
import { ConfirmModal } from './ui/ConfirmModal';
import jsPDF from 'jspdf';
import autoTable from 'jspdf-autotable';

interface Client {
    id: string; name: string; phone: string; email: string | null;
    total_visits: number; total_spend: number; created_at: string;
}

export const ClientCRM: React.FC = () => {
    const [clients, setClients] = useState<Client[]>([]);
    const [loading, setLoading] = useState(true);
    const [search, setSearch] = useState('');
    const [showModal, setShowModal] = useState(false);
    const [saving, setSaving] = useState(false);
    const [formName, setFormName] = useState('');
    const [formPhone, setFormPhone] = useState('');
    const [formEmail, setFormEmail] = useState('');

    // Edit state
    const [editingClient, setEditingClient] = useState<Client | null>(null);
    const [showEditModal, setShowEditModal] = useState(false);
    const [editName, setEditName] = useState('');
    const [editPhone, setEditPhone] = useState('');
    const [editEmail, setEditEmail] = useState('');

    // Dropdown & delete state
    const [openMenu, setOpenMenu] = useState<string | null>(null);
    const [deleteTarget, setDeleteTarget] = useState<Client | null>(null);
    const [deleting, setDeleting] = useState(false);
    const menuRef = useRef<HTMLDivElement>(null);

    const fetchClients = useCallback(async () => {
        if (!TENANT_ID) return;
        setLoading(true);

        const { data } = await supabase
            .from('clients')
            .select('id, name, phone, email, created_at')
            .eq('tenant_id', TENANT_ID)
            .order('created_at', { ascending: false });

        if (data) {
            const enriched = await Promise.all(data.map(async (c: any) => {
                const { count } = await supabase
                    .from('bookings')
                    .select('*', { count: 'exact', head: true })
                    .eq('client_id', c.id)
                    .eq('status', 'completed');

                const { data: spendData } = await supabase
                    .from('bookings')
                    .select('total_price')
                    .eq('client_id', c.id)
                    .in('status', ['completed', 'confirmed']);

                const totalSpend = spendData?.reduce((sum: number, b: any) => sum + (b.total_price || 0), 0) || 0;
                return { ...c, total_visits: count || 0, total_spend: totalSpend };
            }));
            setClients(enriched);
        }
        setLoading(false);
    }, []);

    useEffect(() => { fetchClients(); }, [fetchClients]);

    // Close menu on outside click
    useEffect(() => {
        const handler = (e: MouseEvent) => {
            if (menuRef.current && !menuRef.current.contains(e.target as Node)) {
                setOpenMenu(null);
            }
        };
        document.addEventListener('mousedown', handler);
        return () => document.removeEventListener('mousedown', handler);
    }, []);

    const handleAddClient = async () => {
        if (!formName || !formPhone) return;
        setSaving(true);

        const { error } = await supabase
            .from('clients')
            .insert({ tenant_id: TENANT_ID, name: formName, phone: formPhone, email: formEmail || null })
            .select('id')
            .single();

        if (!error) {
            showToast('Client added successfully');
            setShowModal(false);
            setFormName(''); setFormPhone(''); setFormEmail('');
            fetchClients();
        } else {
            showToast(error.message, 'error');
        }
        setSaving(false);
    };

    // -- Edit --
    const openEdit = (client: Client) => {
        setEditingClient(client);
        setEditName(client.name);
        setEditPhone(client.phone);
        setEditEmail(client.email || '');
        setShowEditModal(true);
        setOpenMenu(null);
    };

    const handleEditClient = async () => {
        if (!editingClient || !editName || !editPhone) return;
        setSaving(true);

        const { error } = await supabase
            .from('clients')
            .update({ name: editName, phone: editPhone, email: editEmail || null })
            .eq('id', editingClient.id);

        if (!error) {
            showToast('Client updated');
            setShowEditModal(false);
            setEditingClient(null);
            fetchClients();
        } else {
            showToast(error.message, 'error');
        }
        setSaving(false);
    };

    // -- Delete --
    const handleDeleteClient = async () => {
        if (!deleteTarget) return;
        setDeleting(true);

        const { error } = await supabase
            .from('clients')
            .delete()
            .eq('id', deleteTarget.id);

        if (!error) {
            showToast(`${deleteTarget.name} deleted`);
            setDeleteTarget(null);
            fetchClients();
        } else {
            showToast(error.message, 'error');
        }
        setDeleting(false);
    };

    // -- Export PDF --
    const exportPDF = () => {
        const doc = new jsPDF();

        // Title
        doc.setFontSize(20);
        doc.setTextColor(40, 40, 40);
        doc.text('Client Report', 14, 22);

        doc.setFontSize(10);
        doc.setTextColor(130, 130, 130);
        doc.text(`Generated: ${new Date().toLocaleDateString()}`, 14, 30);
        doc.text(`Total Clients: ${filtered.length}`, 14, 36);

        // Table
        autoTable(doc, {
            startY: 44,
            head: [['Name', 'Phone', 'Email', 'Visits', 'Lifetime Spend']],
            body: filtered.map(c => [
                c.name,
                c.phone,
                c.email || '—',
                String(c.total_visits),
                `$${c.total_spend.toLocaleString()}`,
            ]),
            headStyles: {
                fillColor: [212, 175, 55],
                textColor: [20, 20, 20],
                fontStyle: 'bold',
                fontSize: 9,
            },
            bodyStyles: { fontSize: 9 },
            alternateRowStyles: { fillColor: [248, 248, 248] },
            margin: { left: 14, right: 14 },
        });

        doc.save('client-report.pdf');
        showToast('PDF exported!');
    };

    const filtered = clients.filter(c =>
        c.name.toLowerCase().includes(search.toLowerCase()) ||
        c.phone.includes(search) ||
        (c.email || '').toLowerCase().includes(search.toLowerCase())
    );

    const totalClients = clients.length;
    const avgSpend = clients.length ? (clients.reduce((s, c) => s + c.total_spend, 0) / clients.length) : 0;
    const newThisMonth = clients.filter(c => {
        const d = new Date(c.created_at);
        const now = new Date();
        return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
    }).length;

    if (loading) {
        return <div className="flex items-center justify-center h-64"><Loader2 className="w-8 h-8 text-luxe-gold animate-spin" /></div>;
    }

    return (
        <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
            {/* Header */}
            <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div className="flex items-center gap-3">
                    <div className="p-3 bg-luxe-gold/10 rounded-2xl border border-luxe-gold/20">
                        <Users className="w-6 h-6 text-luxe-gold" />
                    </div>
                    <div>
                        <h3 className="text-xl font-bold">Client Database</h3>
                        <p className="text-xs text-white/40 uppercase tracking-widest">360° Management View</p>
                    </div>
                </div>
                <div className="flex items-center gap-3">
                    <div className="relative">
                        <Search className="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-white/30" />
                        <input
                            type="text" placeholder="Search clients..." value={search}
                            onChange={(e) => setSearch(e.target.value)}
                            className="bg-white/5 border border-white/10 rounded-xl pl-10 pr-4 py-2 text-xs outline-none focus:border-luxe-gold/50 w-64"
                        />
                    </div>
                    <button
                        onClick={exportPDF}
                        className="px-4 py-2 rounded-xl border border-white/10 text-white/60 hover:text-luxe-gold hover:border-luxe-gold/30 transition-all flex items-center gap-2 text-xs font-bold"
                    >
                        <FileText className="w-4 h-4" /> EXPORT PDF
                    </button>
                    <button
                        onClick={() => setShowModal(true)}
                        className="bg-gold-gradient text-luxe-obsidian px-6 py-2 rounded-xl font-bold flex items-center gap-2 shadow-lg shadow-luxe-gold/20 hover:scale-[1.02] active:scale-[0.98] transition-all"
                    >
                        <Plus className="w-5 h-5" />
                        ADD CLIENT
                    </button>
                </div>
            </div>

            {/* Stats */}
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                <SummaryItem label="Total Clients" value={String(totalClients)} trend={`+${newThisMonth} this month`} />
                <SummaryItem label="Avg. Lifetime Value" value={`$${avgSpend.toLocaleString(undefined, { maximumFractionDigits: 0 })}`} trend="Per client" />
                <SummaryItem label="New This Month" value={String(newThisMonth)} trend="Active growth" />
            </div>

            {/* Client Grid */}
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {filtered.map(client => {
                    const isNew = new Date(client.created_at).getTime() > Date.now() - 7 * 24 * 3600 * 1000;
                    const isVip = client.total_spend > 1000;
                    return (
                        <div key={client.id} className="glass-panel p-6 group hover:gold-border duration-300 transition-all relative overflow-visible flex flex-col h-full">
                            <div className="flex justify-between items-start mb-6">
                                <div className="flex items-center gap-4">
                                    <div className="w-14 h-14 rounded-2xl bg-white/5 border border-white/5 flex items-center justify-center text-xl font-black text-luxe-gold group-hover:bg-luxe-gold/10 transition-colors">
                                        {client.name.charAt(0)}
                                    </div>
                                    <div>
                                        <h4 className="font-bold tracking-tight">{client.name}</h4>
                                        <p className="text-xs text-white/40 flex items-center gap-1.5 mt-0.5">
                                            <Phone className="w-3 h-3" /> {client.phone}
                                        </p>
                                    </div>
                                </div>
                                <div className="flex flex-col items-end gap-2">
                                    {isVip && (
                                        <span className="text-[9px] font-black uppercase tracking-widest bg-luxe-gold/20 text-luxe-gold px-2 py-1 rounded-full flex items-center gap-1">
                                            <Tag className="w-2 h-2" /> VIP
                                        </span>
                                    )}
                                    {isNew && (
                                        <span className="text-[9px] font-black uppercase tracking-widest bg-blue-500/20 text-blue-400 px-2 py-1 rounded-full">NEW</span>
                                    )}
                                </div>
                            </div>
                            <div className="grid grid-cols-2 gap-4 mb-6">
                                <div className="p-3 bg-white/5 rounded-xl border border-white/5 group-hover:bg-white/10 transition-colors">
                                    <p className="text-[9px] text-white/30 uppercase font-black tracking-widest mb-1">Lifetime</p>
                                    <p className="text-sm font-bold text-green-400">${client.total_spend.toLocaleString()}</p>
                                </div>
                                <div className="p-3 bg-white/5 rounded-xl border border-white/5 group-hover:bg-white/10 transition-colors">
                                    <p className="text-[9px] text-white/30 uppercase font-black tracking-widest mb-1">Visits</p>
                                    <p className="text-sm font-bold">{client.total_visits} times</p>
                                </div>
                            </div>
                            <div className="mt-auto pt-6 border-t border-white/5 flex items-center justify-between">
                                <p className="text-[10px] text-white/30">
                                    {client.email || 'No email'}
                                </p>
                                {/* 3-dots Dropdown */}
                                <div className="relative" ref={openMenu === client.id ? menuRef : undefined}>
                                    <button
                                        onClick={() => setOpenMenu(openMenu === client.id ? null : client.id)}
                                        className="p-2 bg-white/5 rounded-xl hover:bg-white/10 transition-all"
                                    >
                                        <MoreHorizontal className="w-4 h-4" />
                                    </button>
                                    {openMenu === client.id && (
                                        <div className="absolute right-0 bottom-full mb-2 w-48 bg-luxe-obsidian border border-white/10 rounded-xl shadow-2xl overflow-hidden z-50 animate-in fade-in slide-in-from-bottom-2 duration-200">
                                            <button
                                                onClick={() => openEdit(client)}
                                                className="w-full px-4 py-3 text-left text-sm flex items-center gap-3 hover:bg-white/5 transition-colors"
                                            >
                                                <Edit3 className="w-4 h-4 text-luxe-gold" /> Edit Client
                                            </button>
                                            <button
                                                onClick={() => { setDeleteTarget(client); setOpenMenu(null); }}
                                                className="w-full px-4 py-3 text-left text-sm flex items-center gap-3 hover:bg-red-500/10 text-red-400 transition-colors"
                                            >
                                                <Trash2 className="w-4 h-4" /> Delete Client
                                            </button>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    );
                })}
            </div>

            {filtered.length === 0 && !loading && (
                <div className="glass-panel p-16 flex flex-col items-center justify-center text-center">
                    <Users className="w-12 h-12 text-white/10 mb-4" />
                    <h4 className="font-bold text-lg text-white/50">No clients found</h4>
                    <p className="text-white/30 text-sm mt-1">Try a different search or add a new client.</p>
                </div>
            )}

            {/* Add Client Modal */}
            {showModal && (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" onClick={() => setShowModal(false)}>
                    <div className="bg-luxe-obsidian border border-white/10 rounded-2xl p-8 w-full max-w-lg shadow-2xl" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="text-xl font-bold flex items-center gap-2">
                                <Plus className="w-6 h-6 text-luxe-gold" />
                                Add New Client
                            </h3>
                            <button onClick={() => setShowModal(false)} className="p-2 hover:bg-white/10 rounded-xl transition-all">
                                <X className="w-5 h-5" />
                            </button>
                        </div>
                        <div className="space-y-4">
                            <div>
                                <label className="text-xs font-bold text-white/50 uppercase tracking-wider mb-2 block">Full Name *</label>
                                <input value={formName} onChange={e => setFormName(e.target.value)} placeholder="Jessica Martinez"
                                    className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-luxe-gold/50 transition-all" />
                            </div>
                            <div>
                                <label className="text-xs font-bold text-white/50 uppercase tracking-wider mb-2 block">Phone *</label>
                                <input value={formPhone} onChange={e => setFormPhone(e.target.value)} placeholder="+1 555-0101"
                                    className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-luxe-gold/50 transition-all" />
                            </div>
                            <div>
                                <label className="text-xs font-bold text-white/50 uppercase tracking-wider mb-2 block">Email (optional)</label>
                                <input value={formEmail} onChange={e => setFormEmail(e.target.value)} placeholder="jessica@email.com"
                                    className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-luxe-gold/50 transition-all" />
                            </div>
                        </div>
                        <button
                            onClick={handleAddClient}
                            disabled={saving || !formName || !formPhone}
                            className="w-full mt-6 bg-gold-gradient text-luxe-obsidian font-bold py-3 rounded-xl shadow-lg shadow-luxe-gold/20 hover:scale-[1.02] active:scale-[0.98] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                        >
                            {saving ? <Loader2 className="w-5 h-5 animate-spin" /> : <Plus className="w-5 h-5" />}
                            {saving ? 'ADDING...' : 'ADD CLIENT'}
                        </button>
                    </div>
                </div>
            )}

            {/* Edit Client Modal */}
            {showEditModal && editingClient && (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" onClick={() => setShowEditModal(false)}>
                    <div className="bg-luxe-obsidian border border-white/10 rounded-2xl p-8 w-full max-w-lg shadow-2xl" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="text-xl font-bold flex items-center gap-2">
                                <Edit3 className="w-6 h-6 text-luxe-gold" />
                                Edit Client
                            </h3>
                            <button onClick={() => setShowEditModal(false)} className="p-2 hover:bg-white/10 rounded-xl transition-all">
                                <X className="w-5 h-5" />
                            </button>
                        </div>
                        <div className="space-y-4">
                            <div>
                                <label className="text-xs font-bold text-white/50 uppercase tracking-wider mb-2 block">Full Name *</label>
                                <input value={editName} onChange={e => setEditName(e.target.value)} placeholder="Jessica Martinez"
                                    className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-luxe-gold/50 transition-all" />
                            </div>
                            <div>
                                <label className="text-xs font-bold text-white/50 uppercase tracking-wider mb-2 block">Phone *</label>
                                <input value={editPhone} onChange={e => setEditPhone(e.target.value)} placeholder="+1 555-0101"
                                    className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-luxe-gold/50 transition-all" />
                            </div>
                            <div>
                                <label className="text-xs font-bold text-white/50 uppercase tracking-wider mb-2 block">Email (optional)</label>
                                <input value={editEmail} onChange={e => setEditEmail(e.target.value)} placeholder="jessica@email.com"
                                    className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-luxe-gold/50 transition-all" />
                            </div>
                        </div>
                        <button
                            onClick={handleEditClient}
                            disabled={saving || !editName || !editPhone}
                            className="w-full mt-6 bg-gold-gradient text-luxe-obsidian font-bold py-3 rounded-xl shadow-lg shadow-luxe-gold/20 hover:scale-[1.02] active:scale-[0.98] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                        >
                            {saving ? <Loader2 className="w-5 h-5 animate-spin" /> : <Edit3 className="w-5 h-5" />}
                            {saving ? 'SAVING...' : 'UPDATE CLIENT'}
                        </button>
                    </div>
                </div>
            )}

            {/* Delete Confirmation Modal */}
            <ConfirmModal
                open={!!deleteTarget}
                title="Delete Client"
                message={`Are you sure you want to delete ${deleteTarget?.name}? This action cannot be undone. All associated booking history will remain.`}
                confirmLabel="Delete"
                danger
                loading={deleting}
                onConfirm={handleDeleteClient}
                onCancel={() => setDeleteTarget(null)}
            />
        </div>
    );
};

const SummaryItem: React.FC<{ label: string; value: string; trend: string }> = ({ label, value, trend }) => (
    <div className="glass-panel p-6 border-b-2 border-transparent hover:border-luxe-gold/30 transition-all">
        <p className="text-white/40 text-xs font-black uppercase tracking-[0.2em] mb-2">{label}</p>
        <div className="flex items-end justify-between">
            <h3 className="text-2xl font-black">{value}</h3>
            <span className="text-[10px] font-bold text-luxe-gold bg-luxe-gold/10 px-2 py-1 rounded">{trend}</span>
        </div>
    </div>
);

--- FILE: C:\Users\syeda\OneDrive\Desktop\Voxali New\dashboard\src\components\DashboardHome.tsx ---

import React, { useState, useEffect, useCallback } from 'react';
import {
    TrendingUp,
    Users,
    Calendar as CalendarIcon,
    PhoneCall,
    Activity,
    Zap,
    ShieldAlert,
    MessageSquare,
    MoreVertical,
    CheckCircle2,
    XCircle,
    Bot,
    Loader2
} from 'lucide-react';
import {
    XAxis,
    YAxis,
    CartesianGrid,
    Tooltip,
    ResponsiveContainer,
    AreaChart,
    Area
} from 'recharts';
import { supabase } from '../lib/supabase';
import { TENANT_ID } from '../config/constants';
import { showToast } from './ui/ToastNotification';

interface DashboardStats {
    bookings_today: number;
    revenue_today: number;
    new_clients: number;
    calls_today: number;
}

interface RevenueDay {
    day: string;
    revenue: number;
}

interface RecentBooking {
    id: string;
    client_name: string;
    service_name: string;
    stylist_name: string;
    status: string;
    created_at: string;
}

interface DashboardHomeProps {
    setActiveTab?: (tab: string) => void;
}

export const DashboardHome: React.FC<DashboardHomeProps> = ({ setActiveTab }) => {
    const [stats, setStats] = useState<DashboardStats | null>(null);
    const [chartData, setChartData] = useState<RevenueDay[]>([]);
    const [activities, setActivities] = useState<RecentBooking[]>([]);
    const [loading, setLoading] = useState(true);

    const [announcement, setAnnouncement] = useState('');
    const [announceSaving, setAnnounceSaving] = useState(false);


    const fetchAll = useCallback(async () => {
        if (!TENANT_ID) return;
        setLoading(true);
        try {
            const [statsRes, revenueRes, activityRes] = await Promise.all([
                supabase.rpc('rpc_dashboard_stats', { p_tenant_id: TENANT_ID }),
                supabase.rpc('rpc_weekly_revenue', { p_tenant_id: TENANT_ID }),
                supabase.rpc('rpc_recent_activity', { p_tenant_id: TENANT_ID }),
            ]);

            if (statsRes.data) setStats(statsRes.data as DashboardStats);
            if (revenueRes.data) setChartData((revenueRes.data as RevenueDay[]).map(r => ({ day: r.day, revenue: Number(r.revenue) })));
            if (activityRes.data) setActivities(activityRes.data as RecentBooking[]);
        } catch (err) {
            console.error('Dashboard fetch error:', err);
        } finally {
            setLoading(false);
        }
    }, []);

    useEffect(() => {
        fetchAll();
    }, [fetchAll]);

    const fmt = (n: number) => n >= 1000 ? `$${(n / 1000).toFixed(1)}k` : `$${n.toFixed(0)}`;

    if (loading) {
        return (
            <div className="flex items-center justify-center h-64">
                <Loader2 className="w-8 h-8 text-luxe-gold animate-spin" />
            </div>
        );
    }

    return (
        <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-700">

            {/* Stats Grid */}
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <StatCard label="Today's Bookings" value={String(stats?.bookings_today ?? 0)} trend="live" icon={CalendarIcon} />
                <StatCard label="Today's Revenue" value={fmt(stats?.revenue_today ?? 0)} trend="live" icon={TrendingUp} />
                <StatCard label="New Clients" value={String(stats?.new_clients ?? 0)} trend="today" icon={Users} />
                <StatCard label="Bella Calls Today" value={String(stats?.calls_today ?? 0)} trend="live" icon={PhoneCall} />
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                {/* Main Chart */}
                <div className="lg:col-span-2 glass-panel p-6 flex flex-col h-[400px]">
                    <div className="flex justify-between items-center mb-6">
                        <h3 className="font-bold text-lg flex items-center gap-2">
                            <Activity className="w-5 h-5 text-luxe-gold" />
                            Weekly Revenue
                        </h3>
                        <span className="text-xs text-white/40">Last 7 days</span>
                    </div>
                    <div className="flex-1 w-full">
                        {chartData.length > 0 ? (
                            <ResponsiveContainer width="100%" height="100%">
                                <AreaChart data={chartData}>
                                    <defs>
                                        <linearGradient id="colorRevenue" x1="0" y1="0" x2="0" y2="1">
                                            <stop offset="5%" stopColor="#D4AF37" stopOpacity={0.3} />
                                            <stop offset="95%" stopColor="#D4AF37" stopOpacity={0} />
                                        </linearGradient>
                                    </defs>
                                    <CartesianGrid strokeDasharray="3 3" stroke="#ffffff05" vertical={false} />
                                    <XAxis dataKey="day" axisLine={false} tickLine={false} tick={{ fill: '#ffffff40', fontSize: 12 }} dy={10} />
                                    <YAxis axisLine={false} tickLine={false} tick={{ fill: '#ffffff40', fontSize: 12 }} tickFormatter={(v: number) => `$${v}`} />
                                    <Tooltip
                                        contentStyle={{ backgroundColor: '#1A1A1A', border: '1px solid rgba(255,255,255,0.1)', borderRadius: '12px' }}
                                        itemStyle={{ color: '#D4AF37' }}
                                        formatter={(value: number) => [`$${value}`, 'Revenue']}
                                    />
                                    <Area type="monotone" dataKey="revenue" stroke="#D4AF37" strokeWidth={3} fillOpacity={1} fill="url(#colorRevenue)" />
                                </AreaChart>
                            </ResponsiveContainer>
                        ) : (
                            <div className="flex items-center justify-center h-full text-white/30 text-sm">No revenue data this week</div>
                        )}
                    </div>
                </div>

                {/* Live Activity Feed */}
                <div className="glass-panel p-6 flex flex-col">
                    <h3 className="font-bold text-lg mb-6 flex items-center gap-2">
                        <Zap className="w-5 h-5 text-luxe-gold" />
                        Recent Bookings
                    </h3>
                    <div className="flex-1 space-y-4 overflow-y-auto max-h-72">
                        {activities.length === 0 && (
                            <p className="text-white/30 text-sm text-center py-8">No recent bookings</p>
                        )}
                        {activities.map((act) => (
                            <div key={act.id} className="flex gap-4 p-3 rounded-xl hover:bg-white/5 transition-colors border border-transparent hover:border-white/5 group">
                                <div className="w-10 h-10 rounded-full bg-luxe-gold/10 flex items-center justify-center flex-shrink-0">
                                    <CalendarIcon className="w-5 h-5 text-luxe-gold" />
                                </div>
                                <div className="flex-1 min-w-0">
                                    <p className="text-sm font-medium truncate">
                                        <span className="text-luxe-gold">{act.client_name}</span>
                                        {' — '}{act.service_name}
                                    </p>
                                    <p className="text-[11px] text-white/40 mt-0.5">with {act.stylist_name} · {act.status}</p>
                                </div>
                                <button
                                    aria-label="More options"
                                    className="opacity-0 group-hover:opacity-100 p-1 text-white/40 hover:text-white transition-all"
                                >
                                    <MoreVertical className="w-4 h-4" />
                                </button>
                            </div>
                        ))}
                    </div>
                    <button
                        onClick={fetchAll}
                        className="mt-6 w-full py-2.5 rounded-xl border border-white/10 text-xs font-bold text-white/60 hover:text-white hover:bg-white/5 transition-all"
                    >
                        ↻ REFRESH
                    </button>
                </div>
            </div>

            {/* AI Control Center */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div className="glass-panel p-6 border-l-4 border-l-luxe-gold">
                    <div className="flex justify-between items-start mb-6">
                        <div>
                            <h3 className="font-bold text-lg flex items-center gap-2">
                                <Bot className="w-6 h-6 text-luxe-gold" />
                                AI Control Center (Bella)
                            </h3>
                            <p className="text-white/40 text-xs mt-1">Manage Bella's behavior and knowledge in real-time</p>
                        </div>
                        <button
                            onClick={async () => {
                                const { data } = await supabase.from('ai_agent_config').select('id, is_active').eq('tenant_id', TENANT_ID).single();
                                if (data) {
                                    await supabase.from('ai_agent_config').update({ is_active: !data.is_active, updated_at: new Date().toISOString() }).eq('id', data.id);
                                    showToast(data.is_active ? '🛑 Bella STOPPED' : '✅ Bella RESTARTED');
                                }
                            }}
                            className="p-2 rounded-lg bg-red-500/10 text-red-500 border border-red-500/20 hover:bg-red-500/20 transition-all flex items-center gap-2"
                        >
                            <ShieldAlert className="w-4 h-4" />
                            <span className="text-xs font-bold">EMERGENCY STOP</span>
                        </button>
                    </div>

                    <div className="space-y-4">
                        <div>
                            <label className="text-xs font-bold text-white/50 uppercase tracking-wider mb-2 block">Shop Announcements</label>
                            <textarea
                                value={announcement}
                                onChange={e => setAnnouncement(e.target.value)}
                                placeholder="e.g. Closing early at 3pm today for a team event..."
                                className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-luxe-gold/50 h-24 resize-none transition-all"
                            />
                        </div>
                        <button
                            disabled={announceSaving}
                            onClick={async () => {
                                setAnnounceSaving(true);
                                const { data } = await supabase.from('ai_agent_config').select('id').eq('tenant_id', TENANT_ID).single();
                                if (data) {
                                    await supabase.from('ai_agent_config').update({ announcements: announcement, updated_at: new Date().toISOString() }).eq('id', data.id);
                                    showToast('Bella updated!');
                                }
                                setAnnounceSaving(false);
                            }}
                            className="w-full bg-gold-gradient text-luxe-obsidian font-bold py-3 rounded-xl shadow-lg shadow-luxe-gold/20 hover:scale-[1.02] active:scale-[0.98] transition-all disabled:opacity-50"
                        >
                            {announceSaving ? 'SAVING...' : "UPDATE BELLA'S KNOWLEDGE"}
                        </button>
                    </div>
                </div>

                <div className="grid grid-cols-2 gap-6">
                    <QuickActionCard title="Add Walk-in" desc="One-click manual booking" icon={Zap} color="text-yellow-400" onClick={() => setActiveTab?.('bookings')} />
                    <QuickActionCard title="Marketing Blast" desc="Send SMS to all clients" icon={MessageSquare} color="text-blue-400" onClick={() => setActiveTab?.('marketing')} />
                    <QuickActionCard title="Confirmations" desc={`${stats?.bookings_today ?? 0} bookings today`} icon={CheckCircle2} color="text-green-400" onClick={() => setActiveTab?.('bookings')} />
                    <QuickActionCard title="No-Shows" desc="Track missed appointments" icon={XCircle} color="text-red-400" onClick={() => setActiveTab?.('bookings')} />
                </div>
            </div>
        </div>
    );
};

interface StatCardProps {
    label: string;
    value: string;
    trend: string;
    icon: React.ElementType;
}

const StatCard: React.FC<StatCardProps> = ({ label, value, trend, icon: Icon }) => (
    <div className="glass-panel p-6 group hover:gold-border duration-300 transition-all relative overflow-hidden">
        <div className="flex justify-between items-start mb-4 relative z-10">
            <div className="w-10 h-10 rounded-xl bg-white/5 flex items-center justify-center group-hover:bg-luxe-gold/10 transition-colors">
                <Icon className="w-5 h-5 text-white/40 group-hover:text-luxe-gold" />
            </div>
            <span className="text-xs font-bold text-luxe-gold bg-luxe-gold/10 px-2 py-1 rounded flex items-center gap-1">
                <span className="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse" />
                {trend}
            </span>
        </div>
        <p className="text-white/40 text-sm font-medium relative z-10">{label}</p>
        <h3 className="text-3xl font-bold mt-1 relative z-10">{value}</h3>
        <div className="absolute top-0 right-0 p-4 opacity-[0.02] group-hover:opacity-[0.05] transition-opacity">
            <Icon className="w-24 h-24 -mr-8 -mt-8" />
        </div>
    </div>
);

interface QuickActionProps {
    title: string;
    desc: string;
    icon: React.ElementType;
    color: string;
    onClick?: () => void;
}

const QuickActionCard: React.FC<QuickActionProps> = ({ title, desc, icon: Icon, color, onClick }) => (
    <button onClick={onClick} className="glass-panel p-6 flex flex-col items-center justify-center text-center group hover:gold-border duration-300 transition-all">
        <Icon className={`w-8 h-8 ${color} mb-3 group-hover:scale-110 transition-transform`} />
        <h4 className="font-bold text-sm tracking-tight">{title}</h4>
        <p className="text-[10px] text-white/30 mt-1 uppercase tracking-widest">{desc}</p>
    </button>
);

--- FILE: C:\Users\syeda\OneDrive\Desktop\Voxali New\dashboard\src\components\LoginPage.tsx ---

import React, { useState, useEffect } from 'react';
import { supabase } from '../lib/supabase';
import { useTenant } from '../context/TenantContext';
import { Eye, EyeOff, Loader2, Sparkles } from 'lucide-react';

export const LoginPage: React.FC<{ onLogin: () => void }> = ({ onLogin }) => {
    const { salonName, salonTagline, logoUrl } = useTenant();
    const [email, setEmail] = useState('');
    const [password, setPassword] = useState('');
    const [showPw, setShowPw] = useState(false);
    const [loading, setLoading] = useState(false);
    const [error, setError] = useState('');
    const [checkingSession, setCheckingSession] = useState(true);

    // Check existing session on mount
    useEffect(() => {
        const checkSession = async () => {
            const { data: { session } } = await supabase.auth.getSession();
            if (session) {
                onLogin();
            }
            setCheckingSession(false);
        };
        checkSession();
    }, [onLogin]);

    // Listen for auth changes
    useEffect(() => {
        const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {
            if (session) onLogin();
        });
        return () => subscription.unsubscribe();
    }, [onLogin]);

    const handleLogin = async (e: React.FormEvent) => {
        e.preventDefault();
        if (!email || !password) return;
        setLoading(true);
        setError('');

        const { error: authError } = await supabase.auth.signInWithPassword({
            email: email.trim(),
            password,
        });

        if (authError) {
            setError(authError.message === 'Invalid login credentials'
                ? 'Invalid email or password'
                : authError.message
            );
        }
        setLoading(false);
    };

    if (checkingSession) {
        return (
            <div className="min-h-screen bg-luxe-obsidian flex items-center justify-center">
                <Loader2 className="w-8 h-8 text-luxe-gold animate-spin" />
            </div>
        );
    }

    return (
        <div className="min-h-screen bg-luxe-obsidian flex items-center justify-center p-6 relative overflow-hidden">
            {/* Background effects */}
            <div className="absolute inset-0 pointer-events-none">
                <div className="absolute top-0 left-1/2 -translate-x-1/2 w-[800px] h-[400px] bg-luxe-gold/5 rounded-full blur-[120px]" />
                <div className="absolute bottom-0 right-0 w-[400px] h-[400px] bg-luxe-gold/3 rounded-full blur-[100px]" />
            </div>

            <div className="w-full max-w-md relative z-10">
                {/* Logo & Header */}
                <div className="text-center mb-10">
                    {logoUrl ? (
                        <img src={logoUrl} alt={salonName} className="w-20 h-20 rounded-2xl mx-auto mb-6 shadow-2xl shadow-luxe-gold/20 border border-white/10" />
                    ) : (
                        <div className="w-20 h-20 bg-gold-gradient rounded-2xl mx-auto mb-6 flex items-center justify-center shadow-2xl shadow-luxe-gold/30">
                            <span className="text-luxe-obsidian font-black text-3xl">{salonName.charAt(0)}</span>
                        </div>
                    )}
                    <h1 className="text-3xl font-black text-luxe-white tracking-tight">{salonName.toUpperCase()}</h1>
                    <p className="text-luxe-gold/60 text-xs uppercase tracking-[0.3em] mt-2">{salonTagline}</p>
                </div>

                {/* Login Card */}
                <div className="bg-white/[0.03] backdrop-blur-xl border border-white/10 rounded-3xl p-8 shadow-2xl">
                    <div className="flex items-center gap-2 mb-8">
                        <Sparkles className="w-5 h-5 text-luxe-gold" />
                        <h2 className="text-lg font-bold text-luxe-white">Dashboard Login</h2>
                    </div>

                    <form onSubmit={handleLogin} className="space-y-5">
                        <div>
                            <label className="text-[10px] font-black text-white/40 uppercase tracking-[0.2em] mb-2 block">Email Address</label>
                            <input
                                type="email"
                                value={email}
                                onChange={e => setEmail(e.target.value)}
                                placeholder="you@salon.com"
                                autoComplete="email"
                                className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3.5 text-sm text-luxe-white placeholder:text-white/20 outline-none focus:border-luxe-gold/50 focus:bg-white/[0.07] transition-all"
                            />
                        </div>

                        <div>
                            <label className="text-[10px] font-black text-white/40 uppercase tracking-[0.2em] mb-2 block">Password</label>
                            <div className="relative">
                                <input
                                    type={showPw ? 'text' : 'password'}
                                    value={password}
                                    onChange={e => setPassword(e.target.value)}
                                    placeholder="••••••••"
                                    autoComplete="current-password"
                                    className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3.5 pr-12 text-sm text-luxe-white placeholder:text-white/20 outline-none focus:border-luxe-gold/50 focus:bg-white/[0.07] transition-all"
                                />
                                <button
                                    type="button"
                                    onClick={() => setShowPw(!showPw)}
                                    className="absolute right-3 top-1/2 -translate-y-1/2 text-white/30 hover:text-white/60 transition-colors"
                                >
                                    {showPw ? <EyeOff className="w-5 h-5" /> : <Eye className="w-5 h-5" />}
                                </button>
                            </div>
                        </div>

                        {error && (
                            <div className="bg-red-500/10 border border-red-500/20 text-red-400 px-4 py-3 rounded-xl text-sm font-medium animate-in slide-in-from-top-1">
                                {error}
                            </div>
                        )}

                        <button
                            type="submit"
                            disabled={loading || !email || !password}
                            className="w-full bg-gold-gradient text-luxe-obsidian font-black py-4 rounded-xl shadow-lg shadow-luxe-gold/25 hover:shadow-luxe-gold/40 hover:scale-[1.02] active:scale-[0.98] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 text-sm uppercase tracking-wider"
                        >
                            {loading ? (
                                <><Loader2 className="w-5 h-5 animate-spin" /> Signing in...</>
                            ) : (
                                'Sign In'
                            )}
                        </button>
                    </form>

                    <p className="text-center text-white/20 text-xs mt-6">
                        Powered by <span className="text-luxe-gold/40 font-bold">Voxali</span>
                    </p>
                </div>
            </div>
        </div>
    );
};

--- FILE: C:\Users\syeda\OneDrive\Desktop\Voxali New\dashboard\src\components\Marketing.tsx ---

import React, { useState, useEffect, useCallback } from 'react';
import {
    Megaphone,
    Send,
    Plus,
    Loader2,
    Users,
    MessageSquare,
    Mail,
    X,
    Rocket
} from 'lucide-react';
import { supabase } from '../lib/supabase';
import { TENANT_ID } from '../config/constants';
import { showToast } from './ui/ToastNotification';
import { ConfirmModal } from './ui/ConfirmModal';

interface Campaign {
    id: string;
    name: string;
    message: string;
    audience: string;
    channel: string;
    status: string;
    sent_count: number;
    created_at: string;
}

const AUDIENCE_LABELS: Record<string, string> = {
    all_clients: 'All Clients',
    vip_only: 'VIP Only',
    inactive: 'Inactive (30+ days)',
    new_this_month: 'New This Month',
};

const CHANNEL_ICONS: Record<string, React.ElementType> = {
    sms: MessageSquare,
    email: Mail,
    both: Send,
};

export const Marketing: React.FC = () => {
    const [campaigns, setCampaigns] = useState<Campaign[]>([]);
    const [loading, setLoading] = useState(true);
    const [showForm, setShowForm] = useState(false);
    const [saving, setSaving] = useState(false);
    const [form, setForm] = useState({ name: '', message: '', audience: 'all_clients', channel: 'sms' });
    const [launching, setLaunching] = useState<string | null>(null);
    const [launchTarget, setLaunchTarget] = useState<Campaign | null>(null);

    const fetchCampaigns = useCallback(async () => {
        if (!TENANT_ID) return;
        setLoading(true);
        const { data, error } = await supabase
            .from('marketing_campaigns')
            .select('*')
            .eq('tenant_id', TENANT_ID)
            .order('created_at', { ascending: false });
        if (!error && data) setCampaigns(data as Campaign[]);
        setLoading(false);
    }, []);

    useEffect(() => { fetchCampaigns(); }, [fetchCampaigns]);

    const handleSave = async () => {
        if (!form.name.trim() || !form.message.trim()) return;
        setSaving(true);
        const { error } = await supabase.from('marketing_campaigns').insert({
            tenant_id: TENANT_ID,
            name: form.name.trim(),
            message: form.message.trim(),
            audience: form.audience,
            channel: form.channel,
            status: 'draft',
        });
        if (!error) {
            setForm({ name: '', message: '', audience: 'all_clients', channel: 'sms' });
            setShowForm(false);
            showToast('Campaign saved as draft');
            fetchCampaigns();
        } else {
            showToast(error.message, 'error');
        }
        setSaving(false);
    };

    const handleLaunch = async () => {
        if (!launchTarget) return;
        setLaunching(launchTarget.id);

        // Update status to 'sending'
        await supabase.from('marketing_campaigns')
            .update({ status: 'sending' })
            .eq('id', launchTarget.id);

        // Count target audience
        let audienceCount = 0;
        const { count } = await supabase
            .from('clients')
            .select('*', { count: 'exact', head: true })
            .eq('tenant_id', TENANT_ID);
        audienceCount = count || 0;

        // Update to sent with count
        const { error } = await supabase.from('marketing_campaigns')
            .update({
                status: 'sent',
                sent_count: audienceCount,
            })
            .eq('id', launchTarget.id);

        if (!error) {
            showToast(`🚀 Campaign launched to ${audienceCount} clients!`);
        } else {
            showToast('Launch failed: ' + error.message, 'error');
        }

        setLaunching(null);
        setLaunchTarget(null);
        fetchCampaigns();
    };

    if (loading) {
        return (
            <div className="flex items-center justify-center h-64">
                <Loader2 className="w-8 h-8 text-luxe-gold animate-spin" />
            </div>
        );
    }

    return (
        <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
            {/* Header */}
            <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                <div className="flex items-center gap-3">
                    <div className="p-3 bg-luxe-gold/10 rounded-2xl border border-luxe-gold/20">
                        <Megaphone className="w-6 h-6 text-luxe-gold" />
                    </div>
                    <div>
                        <h3 className="text-xl font-bold">Marketing Campaigns</h3>
                        <p className="text-xs text-white/40 uppercase tracking-widest">Client Outreach & Promotions</p>
                    </div>
                </div>
                <button
                    onClick={() => setShowForm(!showForm)}
                    className="flex items-center gap-2 bg-gold-gradient text-luxe-obsidian px-6 py-2.5 rounded-xl font-bold shadow-lg shadow-luxe-gold/20 hover:scale-[1.02] active:scale-[0.98] transition-all text-sm"
                >
                    {showForm ? <X className="w-4 h-4" /> : <Plus className="w-4 h-4" />}
                    {showForm ? 'CANCEL' : 'NEW CAMPAIGN'}
                </button>
            </div>

            {/* Create Form */}
            {showForm && (
                <div className="glass-panel p-6 border border-luxe-gold/20 space-y-4 animate-in slide-in-from-top-2 duration-300">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label className="text-xs font-bold text-white/50 uppercase tracking-wider mb-2 block">Campaign Name</label>
                            <input
                                type="text"
                                value={form.name}
                                onChange={(e) => setForm(p => ({ ...p, name: e.target.value }))}
                                placeholder="e.g. Valentine's Day Promo"
                                className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-luxe-gold/50"
                            />
                        </div>
                        <div className="grid grid-cols-2 gap-4">
                            <div>
                                <label className="text-xs font-bold text-white/50 uppercase tracking-wider mb-2 block">Audience</label>
                                <select
                                    aria-label="Select audience"
                                    value={form.audience}
                                    onChange={(e) => setForm(p => ({ ...p, audience: e.target.value }))}
                                    className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-luxe-gold/50"
                                >
                                    {Object.entries(AUDIENCE_LABELS).map(([k, v]) => (
                                        <option key={k} value={k}>{v}</option>
                                    ))}
                                </select>
                            </div>
                            <div>
                                <label className="text-xs font-bold text-white/50 uppercase tracking-wider mb-2 block">Channel</label>
                                <select
                                    aria-label="Select channel"
                                    value={form.channel}
                                    onChange={(e) => setForm(p => ({ ...p, channel: e.target.value }))}
                                    className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-luxe-gold/50"
                                >
                                    <option value="sms">SMS</option>
                                    <option value="email">Email</option>
                                    <option value="both">SMS + Email</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label className="text-xs font-bold text-white/50 uppercase tracking-wider mb-2 block">Message</label>
                        <textarea
                            value={form.message}
                            onChange={(e) => setForm(p => ({ ...p, message: e.target.value }))}
                            placeholder="Hi {name}! 💇‍♀️ Book this week and get 20% off any color service..."
                            className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-luxe-gold/50 h-28 resize-none"
                        />
                        <p className="text-[10px] text-white/30 mt-1">{form.message.length} / 160 characters (SMS limit)</p>
                    </div>
                    <button
                        onClick={handleSave}
                        disabled={saving || !form.name.trim() || !form.message.trim()}
                        className="w-full bg-gold-gradient text-luxe-obsidian font-bold py-3 rounded-xl shadow-lg shadow-luxe-gold/20 hover:scale-[1.02] active:scale-[0.98] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                    >
                        {saving ? <Loader2 className="w-4 h-4 animate-spin" /> : <Send className="w-4 h-4" />}
                        SAVE AS DRAFT
                    </button>
                </div>
            )}

            {/* Campaign List */}
            {campaigns.length === 0 ? (
                <div className="glass-panel p-16 flex flex-col items-center justify-center text-center">
                    <Megaphone className="w-12 h-12 text-white/10 mb-4" />
                    <h4 className="font-bold text-lg text-white/50">No campaigns yet</h4>
                    <p className="text-white/30 text-sm mt-1">Create your first marketing campaign to reach your clients</p>
                </div>
            ) : (
                <div className="glass-panel overflow-hidden border border-white/5">
                    <table className="w-full text-left border-collapse">
                        <thead>
                            <tr className="bg-white/5 border-b border-white/5">
                                <th className="px-6 py-4 text-[10px] font-black uppercase tracking-[0.2em] text-white/30">Campaign</th>
                                <th className="px-6 py-4 text-[10px] font-black uppercase tracking-[0.2em] text-white/30 text-center">Audience</th>
                                <th className="px-6 py-4 text-[10px] font-black uppercase tracking-[0.2em] text-white/30 text-center">Channel</th>
                                <th className="px-6 py-4 text-[10px] font-black uppercase tracking-[0.2em] text-white/30 text-center">Status</th>
                                <th className="px-6 py-4 text-[10px] font-black uppercase tracking-[0.2em] text-white/30 text-center">Sent</th>
                                <th className="px-6 py-4 text-[10px] font-black uppercase tracking-[0.2em] text-white/30 text-right">Actions</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y divide-white/5">
                            {campaigns.map((c) => {
                                const ChannelIcon = CHANNEL_ICONS[c.channel] ?? Send;
                                const isLaunching = launching === c.id;
                                return (
                                    <tr key={c.id} className="group hover:bg-white/[0.02] transition-colors">
                                        <td className="px-6 py-5">
                                            <div className="flex items-center gap-3">
                                                <div className="w-10 h-10 rounded-full bg-luxe-gold/10 flex items-center justify-center">
                                                    <Megaphone className="w-5 h-5 text-luxe-gold" />
                                                </div>
                                                <div>
                                                    <p className="font-bold text-sm">{c.name}</p>
                                                    <p className="text-[10px] text-white/40 truncate max-w-[200px]">{c.message}</p>
                                                </div>
                                            </div>
                                        </td>
                                        <td className="px-6 py-5 text-center">
                                            <span className="text-xs bg-white/5 text-white/60 px-3 py-1 rounded-full flex items-center gap-1 mx-auto w-fit">
                                                <Users className="w-3 h-3" /> {AUDIENCE_LABELS[c.audience] ?? c.audience}
                                            </span>
                                        </td>
                                        <td className="px-6 py-5 text-center">
                                            <span className="text-xs flex items-center gap-1 justify-center text-white/60">
                                                <ChannelIcon className="w-3.5 h-3.5" /> {c.channel.toUpperCase()}
                                            </span>
                                        </td>
                                        <td className="px-6 py-5 text-center">
                                            <span className={`text-[9px] font-black uppercase tracking-widest px-3 py-1 rounded-full ${c.status === 'sent' ? 'bg-green-500/20 text-green-400' :
                                                c.status === 'sending' ? 'bg-yellow-500/20 text-yellow-400' :
                                                    c.status === 'scheduled' ? 'bg-blue-500/20 text-blue-400' :
                                                        'bg-white/10 text-white/40'
                                                }`}>
                                                {c.status}
                                            </span>
                                        </td>
                                        <td className="px-6 py-5 text-center text-sm font-bold text-white/60">
                                            {c.sent_count > 0 ? c.sent_count : '—'}
                                        </td>
                                        <td className="px-6 py-5 text-right">
                                            {c.status === 'draft' && (
                                                <button
                                                    onClick={() => setLaunchTarget(c)}
                                                    disabled={isLaunching}
                                                    className="inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-green-500/10 text-green-400 border border-green-500/20 text-xs font-bold hover:bg-green-500/20 transition-all disabled:opacity-50"
                                                >
                                                    {isLaunching ? <Loader2 className="w-3.5 h-3.5 animate-spin" /> : <Rocket className="w-3.5 h-3.5" />}
                                                    LAUNCH
                                                </button>
                                            )}
                                            {c.status === 'sent' && (
                                                <span className="text-xs text-white/30">{new Date(c.created_at).toLocaleDateString()}</span>
                                            )}
                                        </td>
                                    </tr>
                                );
                            })}
                        </tbody>
                    </table>
                </div>
            )}

            {/* Launch Confirmation */}
            <ConfirmModal
                open={!!launchTarget}
                title="Launch Campaign"
                message={`Launch "${launchTarget?.name}" to ${AUDIENCE_LABELS[launchTarget?.audience || ''] || launchTarget?.audience} via ${launchTarget?.channel?.toUpperCase()}? This will send the campaign immediately.`}
                confirmLabel="🚀 Launch Now"
                loading={!!launching}
                onConfirm={handleLaunch}
                onCancel={() => setLaunchTarget(null)}
            />
        </div>
    );
};

--- FILE: C:\Users\syeda\OneDrive\Desktop\Voxali New\dashboard\src\components\Settings.tsx ---

import React, { useState, useEffect, useCallback, useRef } from 'react';
import {
    Clock, Plus, Edit3, Upload, Building2, Trash2,
    Loader2, X, Scissors, Save, ToggleLeft, ToggleRight
} from 'lucide-react';
import { supabase } from '../lib/supabase';
import { TENANT_ID } from '../config/constants';
import { useTenant } from '../context/TenantContext';
import { showToast } from './ui/ToastNotification';

interface Service {
    id: string; name: string; duration: number; price: number;
    category: string; is_active: boolean;
}

interface BusinessHour {
    id: string; day_of_week: number; open_time: string;
    close_time: string; is_open: boolean;
}

const DAY_NAMES = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
const CATEGORIES = ['Hair', 'Nails', 'Skin', 'Makeup', 'Treatment', 'Barber', 'Other'];

export const Settings: React.FC = () => {
    const { salonName, salonTagline, logoUrl, ownerName, updateBranding, refetch } = useTenant();

    // Branding form state
    const [bName, setBName] = useState(salonName);
    const [bTagline, setBTagline] = useState(salonTagline);
    const [bOwner, setBOwner] = useState(ownerName);
    const [bLogoPreview, setBLogoPreview] = useState<string | null>(logoUrl);
    const [brandingSaving, setBrandingSaving] = useState(false);
    const [logoUploading, setLogoUploading] = useState(false);
    const fileInputRef = useRef<HTMLInputElement>(null);

    const [services, setServices] = useState<Service[]>([]);
    const [hours, setHours] = useState<BusinessHour[]>([]);
    const [loading, setLoading] = useState(true);
    const [showSvcModal, setShowSvcModal] = useState(false);
    const [editSvc, setEditSvc] = useState<Service | null>(null);
    const [saving, setSaving] = useState(false);

    // Service form
    const [sName, setSName] = useState('');
    const [sDuration, setSDuration] = useState('60');
    const [sPrice, setSPrice] = useState('');
    const [sCategory, setSCategory] = useState('Hair');



    // Sync branding form when context updates
    useEffect(() => {
        setBName(salonName);
        setBTagline(salonTagline);
        setBOwner(ownerName);
        setBLogoPreview(logoUrl);
    }, [salonName, salonTagline, ownerName, logoUrl]);

    const fetchAll = useCallback(async () => {
        if (!TENANT_ID) return;
        setLoading(true);

        const { data: svcData } = await supabase
            .from('services').select('*')
            .eq('tenant_id', TENANT_ID).order('category').order('name');

        const { data: hourData } = await supabase
            .from('business_hours').select('*')
            .eq('tenant_id', TENANT_ID).order('day_of_week');

        if (svcData) setServices(svcData);
        if (hourData) setHours(hourData);
        setLoading(false);
    }, []);

    useEffect(() => { fetchAll(); }, [fetchAll]);

    // -- Branding --
    const handleLogoUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
        const file = e.target.files?.[0];
        if (!file || !TENANT_ID) return;

        // Show local preview immediately
        const reader = new FileReader();
        reader.onload = (ev) => setBLogoPreview(ev.target?.result as string);
        reader.readAsDataURL(file);

        setLogoUploading(true);
        const ext = file.name.split('.').pop() || 'png';
        const path = `${TENANT_ID}/logo.${ext}`;

        const { error: upErr } = await supabase.storage
            .from('logos')
            .upload(path, file, { upsert: true, contentType: file.type });

        if (!upErr) {
            const { data: urlData } = supabase.storage.from('logos').getPublicUrl(path);
            setBLogoPreview(urlData.publicUrl);
            showToast('✅ Logo uploaded!');
        } else {
            showToast('❌ Upload failed: ' + upErr.message);
        }
        setLogoUploading(false);
    };

    const handleRemoveLogo = () => {
        setBLogoPreview(null);
        if (fileInputRef.current) fileInputRef.current.value = '';
    };

    const handleSaveBranding = async () => {
        setBrandingSaving(true);
        const updates: Record<string, string> = {};
        if (bName !== salonName) updates.salonName = bName;
        if (bTagline !== salonTagline) updates.salonTagline = bTagline;
        if (bOwner !== ownerName) updates.ownerName = bOwner;

        // Handle logo: uploaded new, removed, or unchanged
        if (bLogoPreview !== logoUrl) {
            updates.logoUrl = bLogoPreview || '';
        }

        const ok = await updateBranding(updates);
        if (ok) {
            showToast('✅ Branding updated!');
            refetch();
        } else {
            showToast('❌ Failed to save branding');
        }
        setBrandingSaving(false);
    };

    const brandingChanged = bName !== salonName || bTagline !== salonTagline || bOwner !== ownerName || bLogoPreview !== logoUrl;

    // -- Service CRUD --
    const openAddService = () => {
        setEditSvc(null);
        setSName(''); setSDuration('60'); setSPrice(''); setSCategory('Hair');
        setShowSvcModal(true);
    };

    const openEditService = (s: Service) => {
        setEditSvc(s);
        setSName(s.name); setSDuration(String(s.duration)); setSPrice(String(s.price)); setSCategory(s.category);
        setShowSvcModal(true);
    };

    const handleSaveService = async () => {
        if (!sName || !sPrice) return;
        setSaving(true);
        const { error } = await supabase.rpc('rpc_upsert_service', {
            p_tenant_id: TENANT_ID,
            p_name: sName,
            p_duration: parseInt(sDuration) || 60,
            p_price: parseFloat(sPrice) || 0,
            p_category: sCategory,
            p_service_id: editSvc?.id || null,
        });
        if (!error) {
            showToast(editSvc ? 'Service updated!' : 'Service added!');
            setShowSvcModal(false);
            fetchAll();
        } else {
            showToast(error.message, 'error');
        }
        setSaving(false);
    };

    const toggleService = async (s: Service) => {
        const { error } = await supabase
            .from('services')
            .update({ is_active: !s.is_active, updated_at: new Date().toISOString() })
            .eq('id', s.id);
        if (!error) {
            showToast(`${s.name} ${!s.is_active ? 'activated' : 'deactivated'}`);
            fetchAll();
        }
    };

    // -- Business Hours --
    const updateHour = async (day: number, field: 'open_time' | 'close_time' | 'is_open', value: string | boolean) => {
        const existing = hours.find(h => h.day_of_week === day);
        const openT = field === 'open_time' ? value as string : (existing?.open_time || '09:00');
        const closeT = field === 'close_time' ? value as string : (existing?.close_time || '21:00');
        const isO = field === 'is_open' ? value as boolean : (existing?.is_open ?? true);

        const { error } = await supabase.rpc('rpc_update_hours', {
            p_tenant_id: TENANT_ID,
            p_day: day,
            p_open: openT,
            p_close: closeT,
            p_is_open: isO,
        });
        if (!error) {
            showToast(`${DAY_NAMES[day]} updated`);
            fetchAll();
        }
    };

    if (loading) {
        return <div className="flex items-center justify-center h-64"><Loader2 className="w-8 h-8 text-luxe-gold animate-spin" /></div>;
    }

    const grouped = CATEGORIES.map(cat => ({
        category: cat,
        items: services.filter(s => s.category === cat),
    })).filter(g => g.items.length > 0);

    return (
        <div className="space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500">


            {/* ============ BRANDING SECTION ============ */}
            <div>
                <div className="flex items-center gap-3 mb-6">
                    <div className="p-3 bg-luxe-gold/10 rounded-2xl border border-luxe-gold/20">
                        <Building2 className="w-6 h-6 text-luxe-gold" />
                    </div>
                    <div>
                        <h3 className="text-xl font-bold">Salon Branding</h3>
                        <p className="text-xs text-white/40 uppercase tracking-widest">Name, Logo & Identity</p>
                    </div>
                </div>

                <div className="glass-panel border border-white/5 p-6">
                    <div className="flex flex-col md:flex-row gap-8">
                        {/* Logo Upload */}
                        <div className="flex flex-col items-center gap-4">
                            <div className="relative">
                                <div
                                    onClick={() => fileInputRef.current?.click()}
                                    className="w-28 h-28 rounded-2xl border-2 border-dashed border-white/20 hover:border-luxe-gold/50 flex items-center justify-center cursor-pointer transition-all group overflow-hidden bg-white/5"
                                >
                                    {bLogoPreview ? (
                                        <img src={bLogoPreview} alt="Logo" className="w-full h-full object-cover rounded-2xl" />
                                    ) : (
                                        <div className="flex flex-col items-center gap-2 text-white/30 group-hover:text-luxe-gold transition-colors">
                                            <Upload className="w-8 h-8" />
                                            <span className="text-[9px] font-bold uppercase tracking-wider">Upload Logo</span>
                                        </div>
                                    )}
                                    {logoUploading && (
                                        <div className="absolute inset-0 bg-black/50 flex items-center justify-center rounded-2xl">
                                            <Loader2 className="w-6 h-6 text-luxe-gold animate-spin" />
                                        </div>
                                    )}
                                </div>
                                {bLogoPreview && (
                                    <button
                                        onClick={handleRemoveLogo}
                                        title="Remove logo"
                                        className="absolute -top-2 -right-2 w-7 h-7 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center shadow-lg transition-all hover:scale-110"
                                    >
                                        <Trash2 className="w-3.5 h-3.5" />
                                    </button>
                                )}
                            </div>
                            <input
                                ref={fileInputRef}
                                type="file"
                                accept="image/*"
                                onChange={handleLogoUpload}
                                className="hidden"
                            />
                            <p className="text-[9px] text-white/20 text-center">Click to upload<br />PNG, JPG (max 2MB)</p>
                        </div>

                        {/* Form Fields */}
                        <div className="flex-1 space-y-4">
                            <div>
                                <label className="text-xs font-bold text-white/50 uppercase tracking-wider mb-2 block">Salon Name</label>
                                <input
                                    value={bName}
                                    onChange={e => setBName(e.target.value)}
                                    placeholder="e.g. Luxe Aurea"
                                    className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-luxe-gold/50 transition-all"
                                />
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="text-xs font-bold text-white/50 uppercase tracking-wider mb-2 block">Tagline</label>
                                    <input
                                        value={bTagline}
                                        onChange={e => setBTagline(e.target.value)}
                                        placeholder="e.g. Salon & Spa"
                                        className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-luxe-gold/50 transition-all"
                                    />
                                </div>
                                <div>
                                    <label className="text-xs font-bold text-white/50 uppercase tracking-wider mb-2 block">Owner Name</label>
                                    <input
                                        value={bOwner}
                                        onChange={e => setBOwner(e.target.value)}
                                        placeholder="e.g. Sarah"
                                        className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-luxe-gold/50 transition-all"
                                    />
                                </div>
                            </div>

                            {/* Live Preview */}
                            <div className="bg-white/[0.02] rounded-xl p-4 border border-white/5">
                                <p className="text-[9px] text-white/30 uppercase tracking-wider font-bold mb-3">Live Preview</p>
                                <div className="flex items-center gap-3">
                                    {bLogoPreview ? (
                                        <img src={bLogoPreview} alt="Preview" className="w-10 h-10 rounded-lg object-cover" />
                                    ) : (
                                        <div className="w-10 h-10 bg-gold-gradient rounded-lg flex items-center justify-center">
                                            <span className="text-luxe-obsidian font-bold text-xl">{bName.charAt(0)}</span>
                                        </div>
                                    )}
                                    <div>
                                        <p className="text-sm font-bold">{bName.toUpperCase()}</p>
                                        <p className="text-[10px] text-luxe-gold/60 uppercase tracking-[0.2em]">{bTagline}</p>
                                    </div>
                                    <div className="ml-auto text-right">
                                        <p className="text-xs font-bold">{bOwner} (Owner)</p>
                                    </div>
                                </div>
                            </div>

                            <button
                                onClick={handleSaveBranding}
                                disabled={brandingSaving || !brandingChanged}
                                className="bg-gold-gradient text-luxe-obsidian px-8 py-3 rounded-xl font-bold shadow-lg shadow-luxe-gold/20 hover:scale-[1.02] active:scale-[0.98] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
                            >
                                {brandingSaving ? <Loader2 className="w-4 h-4 animate-spin" /> : <Save className="w-4 h-4" />}
                                {brandingSaving ? 'SAVING...' : 'SAVE BRANDING'}
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            {/* ============ SERVICES SECTION ============ */}
            <div>
                <div className="flex justify-between items-center mb-6">
                    <div className="flex items-center gap-3">
                        <div className="p-3 bg-luxe-gold/10 rounded-2xl border border-luxe-gold/20">
                            <Scissors className="w-6 h-6 text-luxe-gold" />
                        </div>
                        <div>
                            <h3 className="text-xl font-bold">Services</h3>
                            <p className="text-xs text-white/40 uppercase tracking-widest">Manage your salon menu</p>
                        </div>
                    </div>
                    <button onClick={openAddService}
                        className="bg-gold-gradient text-luxe-obsidian px-6 py-2 rounded-xl font-bold flex items-center gap-2 shadow-lg shadow-luxe-gold/20 hover:scale-[1.02] active:scale-[0.98] transition-all">
                        <Plus className="w-5 h-5" /> ADD SERVICE
                    </button>
                </div>

                {/* Service Groups */}
                <div className="space-y-6">
                    {grouped.map(g => (
                        <div key={g.category} className="glass-panel border border-white/5 overflow-hidden">
                            <div className="px-6 py-3 bg-white/5 border-b border-white/5">
                                <span className="text-[10px] font-black uppercase tracking-[0.2em] text-luxe-gold">{g.category}</span>
                            </div>
                            <div className="divide-y divide-white/5">
                                {g.items.map(svc => (
                                    <div key={svc.id} className={`flex items-center justify-between px-6 py-4 hover:bg-white/[0.02] transition-colors ${!svc.is_active ? 'opacity-40' : ''}`}>
                                        <div className="flex items-center gap-4 flex-1">
                                            <div className="w-10 h-10 rounded-xl bg-luxe-gold/10 flex items-center justify-center">
                                                <Scissors className="w-5 h-5 text-luxe-gold" />
                                            </div>
                                            <div className="flex-1">
                                                <p className="font-bold text-sm">{svc.name}</p>
                                                <p className="text-[10px] text-white/30">{svc.duration} min</p>
                                            </div>
                                        </div>
                                        <div className="flex items-center gap-4">
                                            <span className="text-lg font-black text-green-400">${svc.price}</span>
                                            <button onClick={() => openEditService(svc)} title="Edit"
                                                className="p-2 rounded-lg bg-white/5 text-white/40 hover:text-luxe-gold hover:bg-luxe-gold/10 transition-all">
                                                <Edit3 className="w-4 h-4" />
                                            </button>
                                            <button onClick={() => toggleService(svc)} title={svc.is_active ? 'Deactivate' : 'Activate'}
                                                className="p-2 rounded-lg bg-white/5 text-white/40 hover:text-white transition-all">
                                                {svc.is_active ? <ToggleRight className="w-5 h-5 text-green-400" /> : <ToggleLeft className="w-5 h-5 text-red-400" />}
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    ))}

                    {grouped.length === 0 && (
                        <div className="glass-panel p-12 text-center">
                            <Scissors className="w-12 h-12 text-white/10 mx-auto mb-4" />
                            <p className="text-white/40">No services yet. Add your first service!</p>
                        </div>
                    )}
                </div>
            </div>

            {/* ============ BUSINESS HOURS SECTION ============ */}
            <div>
                <div className="flex items-center gap-3 mb-6">
                    <div className="p-3 bg-luxe-gold/10 rounded-2xl border border-luxe-gold/20">
                        <Clock className="w-6 h-6 text-luxe-gold" />
                    </div>
                    <div>
                        <h3 className="text-xl font-bold">Business Hours</h3>
                        <p className="text-xs text-white/40 uppercase tracking-widest">Set opening times per day</p>
                    </div>
                </div>

                <div className="glass-panel border border-white/5 overflow-hidden">
                    <div className="divide-y divide-white/5">
                        {[1, 2, 3, 4, 5, 6, 0].map(dow => {
                            const h = hours.find(hr => hr.day_of_week === dow);
                            return (
                                <div key={dow} className={`flex items-center justify-between px-6 py-4 hover:bg-white/[0.02] transition-colors ${h?.is_open === false ? 'opacity-40' : ''}`}>
                                    <div className="w-32">
                                        <p className="font-bold text-sm">{DAY_NAMES[dow]}</p>
                                    </div>
                                    <div className="flex items-center gap-4 flex-1 justify-center">
                                        <input type="time" value={h?.open_time?.slice(0, 5) || '09:00'}
                                            onChange={e => updateHour(dow, 'open_time', e.target.value)}
                                            disabled={h?.is_open === false}
                                            className="bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-sm outline-none focus:border-luxe-gold/50 disabled:opacity-30 transition-all" />
                                        <span className="text-white/30 text-xs font-bold">TO</span>
                                        <input type="time" value={h?.close_time?.slice(0, 5) || '21:00'}
                                            onChange={e => updateHour(dow, 'close_time', e.target.value)}
                                            disabled={h?.is_open === false}
                                            className="bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-sm outline-none focus:border-luxe-gold/50 disabled:opacity-30 transition-all" />
                                    </div>
                                    <button onClick={() => updateHour(dow, 'is_open', !(h?.is_open ?? true))}
                                        className="ml-4">
                                        {h?.is_open !== false ? (
                                            <div className="flex items-center gap-2 bg-green-500/10 text-green-400 px-3 py-1.5 rounded-lg border border-green-500/20 text-xs font-bold">
                                                <ToggleRight className="w-4 h-4" /> OPEN
                                            </div>
                                        ) : (
                                            <div className="flex items-center gap-2 bg-red-500/10 text-red-400 px-3 py-1.5 rounded-lg border border-red-500/20 text-xs font-bold">
                                                <ToggleLeft className="w-4 h-4" /> CLOSED
                                            </div>
                                        )}
                                    </button>
                                </div>
                            );
                        })}
                    </div>
                </div>
            </div>

            {/* ============ SERVICE MODAL ============ */}
            {showSvcModal && (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" onClick={() => setShowSvcModal(false)}>
                    <div className="bg-luxe-obsidian border border-white/10 rounded-2xl p-8 w-full max-w-lg shadow-2xl" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="text-xl font-bold flex items-center gap-2">
                                {editSvc ? <Edit3 className="w-6 h-6 text-luxe-gold" /> : <Plus className="w-6 h-6 text-luxe-gold" />}
                                {editSvc ? 'Edit Service' : 'Add New Service'}
                            </h3>
                            <button onClick={() => setShowSvcModal(false)} title="Close" className="p-2 hover:bg-white/10 rounded-xl transition-all">
                                <X className="w-5 h-5" />
                            </button>
                        </div>
                        <div className="space-y-4">
                            <div>
                                <label className="text-xs font-bold text-white/50 uppercase tracking-wider mb-2 block">Service Name *</label>
                                <input value={sName} onChange={e => setSName(e.target.value)} placeholder="e.g. Balayage"
                                    className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-luxe-gold/50 transition-all" />
                            </div>
                            <div>
                                <label className="text-xs font-bold text-white/50 uppercase tracking-wider mb-2 block">Category</label>
                                <select value={sCategory} onChange={e => setSCategory(e.target.value)} title="Select category"
                                    className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-luxe-gold/50 transition-all">
                                    {CATEGORIES.map(c => <option key={c} value={c}>{c}</option>)}
                                </select>
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="text-xs font-bold text-white/50 uppercase tracking-wider mb-2 block">Duration (min)</label>
                                    <select value={sDuration} onChange={e => setSDuration(e.target.value)} title="Select duration"
                                        className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-luxe-gold/50 transition-all">
                                        {[15, 30, 45, 60, 75, 90, 120, 150, 180].map(d => (
                                            <option key={d} value={String(d)}>{d} min</option>
                                        ))}
                                    </select>
                                </div>
                                <div>
                                    <label className="text-xs font-bold text-white/50 uppercase tracking-wider mb-2 block">Price ($) *</label>
                                    <input type="number" value={sPrice} onChange={e => setSPrice(e.target.value)} placeholder="0.00" min="0" step="5"
                                        className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-luxe-gold/50 transition-all" />
                                </div>
                            </div>
                        </div>
                        <button onClick={handleSaveService} disabled={saving || !sName || !sPrice}
                            className="w-full mt-6 bg-gold-gradient text-luxe-obsidian font-bold py-3 rounded-xl shadow-lg shadow-luxe-gold/20 hover:scale-[1.02] active:scale-[0.98] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2">
                            {saving ? <Loader2 className="w-5 h-5 animate-spin" /> : <Save className="w-5 h-5" />}
                            {saving ? 'SAVING...' : editSvc ? 'UPDATE SERVICE' : 'ADD SERVICE'}
                        </button>
                    </div>
                </div>
            )}
        </div>
    );
};

--- FILE: C:\Users\syeda\OneDrive\Desktop\Voxali New\dashboard\src\components\Sidebar.tsx ---

import React from 'react';
import {
    LayoutDashboard,
    Calendar,
    Users,
    UsersRound,
    BarChart3,
    PhoneCall,
    Megaphone,
    Bot,
    Settings,
    Moon,
    Sun,
    LogOut,
    Building2
} from 'lucide-react';
import { useAuth } from '../context/AuthContext';
import { clsx, type ClassValue } from 'clsx';
import { twMerge } from 'tailwind-merge';
import { useTenant } from '../context/TenantContext';

function cn(...inputs: ClassValue[]) {
    return twMerge(clsx(inputs));
}

const navItems = [
    { icon: LayoutDashboard, label: 'Dashboard', id: 'dashboard', roles: ['super_admin', 'owner', 'manager'] },
    { icon: Calendar, label: 'Bookings', id: 'bookings', roles: ['super_admin', 'owner', 'manager', 'staff'] },
    { icon: Users, label: 'Clients', id: 'clients', roles: ['super_admin', 'owner', 'manager', 'receptionist'] },
    { icon: UsersRound, label: 'Stylists', id: 'stylists', roles: ['super_admin', 'owner', 'manager'] },
    { icon: BarChart3, label: 'Analytics', id: 'analytics', roles: ['super_admin', 'owner', 'manager'] },
    { icon: PhoneCall, label: 'Call Logs', id: 'calls', roles: ['super_admin', 'owner', 'manager', 'receptionist'] },
    { icon: Megaphone, label: 'Marketing', id: 'marketing', roles: ['super_admin', 'owner', 'manager'] },
    { icon: Bot, label: 'Bella AI', id: 'bella', roles: ['super_admin', 'owner', 'manager'] },
    { icon: Settings, label: 'Settings', id: 'settings', roles: ['super_admin', 'owner'] },
];

const superAdminItems = [
    { icon: LayoutDashboard, label: 'SaaS Overview', id: 'saas_dashboard', roles: ['super_admin'] },
    { icon: Building2, label: 'All Salons', id: 'salons_list', roles: ['super_admin'] },
];

interface SidebarProps {
    activeTab: string;
    setActiveTab: (id: string) => void;
    isDarkMode: boolean;
    toggleTheme: () => void;
    onLogout?: () => void;
}

export const Sidebar: React.FC<SidebarProps> = ({
    activeTab,
    setActiveTab,
    isDarkMode,
    toggleTheme,
    onLogout
}) => {
    const { salonName, salonTagline, logoUrl } = useTenant();
    const { role } = useAuth(); // Use role from AuthContext

    const handleLogout = () => {
        if (onLogout) {
            onLogout();
        } else {
            localStorage.clear();
            sessionStorage.clear();
            window.location.reload();
        }
    };

    // Filter items based on role
    const filteredItems = navItems.filter(item =>
        !item.roles || (role && item.roles.includes(role))
    );

    const filteredSuperAdminItems = superAdminItems.filter(item =>
        role === 'super_admin'
    );

    return (
        <div className="w-64 h-screen bg-luxe-obsidian border-r border-white/5 flex flex-col p-6">
            <div className="mb-10 flex items-center gap-3">
                {logoUrl ? (
                    <img src={logoUrl} alt={salonName} className="w-8 h-8 rounded-lg object-cover" />
                ) : (
                    <div className="w-8 h-8 bg-gold-gradient rounded-lg flex items-center justify-center">
                        <span className="text-luxe-obsidian font-bold text-xl">{salonName.charAt(0)}</span>
                    </div>
                )}
                <div>
                    <h1 className="text-luxe-white font-bold tracking-tight text-lg leading-none">{salonName.toUpperCase()}</h1>
                    <p className="text-luxe-gold/60 text-[10px] uppercase tracking-[0.2em] mt-1">{salonTagline}</p>
                </div>
            </div>

            <nav className="flex-1 space-y-1">
                {/* Super Admin Section */}
                {filteredSuperAdminItems.length > 0 && (
                    <>
                        <div className="text-xs font-bold text-white/40 uppercase tracking-wider px-4 mb-2 mt-2">
                            Super Admin
                        </div>
                        {filteredSuperAdminItems.map((item) => (
                            <button
                                key={item.id}
                                onClick={() => setActiveTab(item.id)}
                                className={cn(
                                    "w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 group",
                                    activeTab === item.id
                                        ? "bg-luxe-gold/10 text-luxe-gold"
                                        : "text-white/50 hover:text-white hover:bg-white/5"
                                )}
                            >
                                <item.icon className={cn(
                                    "w-5 h-5",
                                    activeTab === item.id ? "text-luxe-gold" : "text-white/40 group-hover:text-white"
                                )} />
                                <span className="font-medium">{item.label}</span>
                                {activeTab === item.id && (
                                    <div className="ml-auto w-1.5 h-1.5 rounded-full bg-luxe-gold shadow-[0_0_8px_#D4AF37]" />
                                )}
                            </button>
                        ))}
                        <div className="my-4 border-t border-white/5" />
                        <div className="text-xs font-bold text-white/40 uppercase tracking-wider px-4 mb-2">
                            Salon Management
                        </div>
                    </>
                )}

                {/* Standard Nav Items */}
                {filteredItems.map((item) => (
                    <button
                        key={item.id}
                        onClick={() => setActiveTab(item.id)}
                        className={cn(
                            "w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 group",
                            activeTab === item.id
                                ? "bg-luxe-gold/10 text-luxe-gold"
                                : "text-white/50 hover:text-white hover:bg-white/5"
                        )}
                    >
                        <item.icon className={cn(
                            "w-5 h-5",
                            activeTab === item.id ? "text-luxe-gold" : "text-white/40 group-hover:text-white"
                        )} />
                        <span className="font-medium">{item.label}</span>
                        {activeTab === item.id && (
                            <div className="ml-auto w-1.5 h-1.5 rounded-full bg-luxe-gold shadow-[0_0_8px_#D4AF37]" />
                        )}
                    </button>
                ))}
            </nav>

            <div className="mt-auto space-y-4">
                <button
                    onClick={toggleTheme}
                    className="w-full flex items-center justify-center gap-2 py-3 rounded-xl border border-white/10 text-white/70 hover:bg-white/5 transition-all"
                >
                    {isDarkMode ? <Sun className="w-4 h-4" /> : <Moon className="w-4 h-4" />}
                    <span className="text-sm font-medium">{isDarkMode ? 'Light Mode' : 'Dark Mode'}</span>
                </button>

                <button
                    onClick={handleLogout}
                    className="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-red-400/70 hover:text-red-400 hover:bg-red-400/5 transition-all"
                >
                    <LogOut className="w-5 h-5" />
                    <span className="font-medium">Logout</span>
                </button>
            </div>
        </div>
    );
};

--- FILE: C:\Users\syeda\OneDrive\Desktop\Voxali New\dashboard\src\components\StaffBoard.tsx ---

import React, { useState, useEffect, useCallback } from 'react';
import {
    BarChart3, TrendingUp, Trophy, ArrowUpRight, Scissors,
    Loader2, Ban, CheckCircle2, Undo2, Plus, X,
    UserMinus, Percent, UserPlus, Key, Lock
} from 'lucide-react';
import { supabase } from '../lib/supabase';
import { TENANT_ID } from '../config/constants';
import { showToast } from './ui/ToastNotification';
import { ConfirmModal } from './ui/ConfirmModal';

interface StaffMember {
    id: string; full_name: string; role: string; color: string;
    is_active: boolean; bookings_count: number; revenue: number;
    is_blocked_today: boolean; commission_rate: number;
    email?: string; // Added email
}

export const StaffBoard: React.FC = () => {
    const [staff, setStaff] = useState<StaffMember[]>([]);
    const [loading, setLoading] = useState(true);
    const [showAddModal, setShowAddModal] = useState(false);
    const [showCommModal, setShowCommModal] = useState(false);
    const [showLoginModal, setShowLoginModal] = useState(false);
    const [selectedStaff, setSelectedStaff] = useState<StaffMember | null>(null);
    const [saving, setSaving] = useState(false);
    const [showInactive, setShowInactive] = useState(false);

    // Deactivate confirm
    const [deactivateTarget, setDeactivateTarget] = useState<StaffMember | null>(null);

    // Add form
    const [aName, setAName] = useState('');
    const [aEmail, setAEmail] = useState('');
    const [aPhone, setAPhone] = useState('');
    const [aRole, setARole] = useState('stylist');
    const [aComm, setAComm] = useState('15');

    // Commission form
    const [commRate, setCommRate] = useState('');

    // Login form
    const [loginEmail, setLoginEmail] = useState('');
    const [loginPassword, setLoginPassword] = useState('');

    // Change Password form
    const [changePwStaff, setChangePwStaff] = useState<StaffMember | null>(null);
    const [newPw, setNewPw] = useState('');

    const fetchStaff = useCallback(async () => {
        if (!TENANT_ID) return;
        setLoading(true);
        const { data, error } = await supabase.rpc('rpc_staff_board', { p_tenant_id: TENANT_ID });
        if (data && Array.isArray(data)) {
            setStaff(data.map((s: any) => ({
                ...s,
                commission_rate: s.commission_rate ?? 15,
            })));
        }
        setLoading(false);
    }, []);

    useEffect(() => { fetchStaff(); }, [fetchStaff]);

    const handleBlock = async (staffId: string, staffName: string) => {
        const { error } = await supabase.rpc('rpc_block_staff_today', { p_tenant_id: TENANT_ID, p_staff_id: staffId });
        if (!error) { showToast(`${staffName} blocked for today`); fetchStaff(); }
    };

    const handleUnblock = async (staffId: string, staffName: string) => {
        const { error } = await supabase.rpc('rpc_unblock_staff_today', { p_tenant_id: TENANT_ID, p_staff_id: staffId });
        if (!error) { showToast(`${staffName} unblocked`); fetchStaff(); }
    };

    const handleAddStaff = async () => {
        if (!aName) return;
        setSaving(true);
        const { data, error } = await supabase.rpc('rpc_add_staff', {
            p_tenant_id: TENANT_ID,
            p_name: aName,
            p_email: aEmail || null,
            p_phone: aPhone || null,
            p_role: aRole,
            p_commission: parseFloat(aComm) || 15,
        });
        if (!error && data?.success) {
            showToast('Staff added!');
            setShowAddModal(false);
            setAName(''); setAEmail(''); setAPhone(''); setARole('stylist'); setAComm('15');
            fetchStaff();
        } else {
            showToast(error?.message || 'Failed', 'error');
        }
        setSaving(false);
    };

    const handleChangePassword = async () => {
        if (!changePwStaff || !newPw) return;
        setSaving(true);

        // Fetch email first
        const { data: staffData, error: fetchError } = await supabase
            .from('staff')
            .select('email')
            .eq('id', changePwStaff.id)
            .single();

        if (fetchError || !staffData?.email) {
            showToast('Could not find staff email', 'error');
            setSaving(false);
            return;
        }

        const { error } = await supabase.rpc('rpc_change_staff_password', {
            p_staff_email: staffData.email,
            p_new_password: newPw
        });

        if (!error) {
            showToast('Password updated successfully');
            setChangePwStaff(null);
            setNewPw('');
        } else {
            showToast(error.message || 'Failed to update password', 'error');
        }
        setSaving(false);
    };

    const handleDeactivate = async () => {
        if (!deactivateTarget) return;
        const { error } = await supabase.rpc('rpc_deactivate_staff', {
            p_tenant_id: TENANT_ID, p_staff_id: deactivateTarget.id,
        });
        if (!error) { showToast(`${deactivateTarget.full_name} deactivated`); fetchStaff(); }
        setDeactivateTarget(null);
    };

    const handleReactivate = async (s: StaffMember) => {
        const { error } = await supabase.rpc('rpc_reactivate_staff', {
            p_tenant_id: TENANT_ID, p_staff_id: s.id,
        });
        if (!error) { showToast(`${s.full_name} reactivated`); fetchStaff(); }
    };

    const openCommModal = (s: StaffMember) => {
        setSelectedStaff(s);
        setCommRate(String(s.commission_rate));
        setShowCommModal(true);
    };

    const handleUpdateComm = async () => {
        if (!selectedStaff) return;
        setSaving(true);
        const { error } = await supabase.rpc('rpc_update_commission', {
            p_tenant_id: TENANT_ID,
            p_staff_id: selectedStaff.id,
            p_rate: parseFloat(commRate) || 15,
        });
        if (!error) {
            showToast(`Commission updated to ${commRate}%`);
            setShowCommModal(false);
            fetchStaff();
        }
        setSaving(false);
    };

    // Staff Login
    const openLoginModal = (s: StaffMember) => {
        setSelectedStaff(s);
        setLoginEmail(s.full_name.replace(/\s+/g, '.').toLowerCase() + '@salon.com');
        setLoginPassword('');
        setShowLoginModal(true);
    };

    const handleCreateLogin = async () => {
        if (!selectedStaff || !loginEmail || !loginPassword) return;
        if (loginPassword.length < 6) {
            showToast('Password must be at least 6 characters', 'error');
            return;
        }
        setSaving(true);

        const { data, error } = await supabase.rpc('rpc_create_staff_login', {
            p_tenant_id: TENANT_ID,
            p_staff_id: selectedStaff.id,
            p_email: loginEmail,
            p_password: loginPassword,
        });

        if (!error && data?.success) {
            showToast(`Login created for ${selectedStaff.full_name}`);
            setShowLoginModal(false);
        } else {
            showToast(error?.message || data?.error || 'Failed to create login', 'error');
        }
        setSaving(false);
    };

    const fmt = (n: number) => n >= 1000 ? `${(n / 1000).toFixed(1)}k` : String(n);

    const activeStaff = staff.filter(s => s.is_active);
    const inactiveStaff = staff.filter(s => !s.is_active);
    const totalRev = activeStaff.reduce((s, m) => s + m.revenue, 0);
    const totalBookings = activeStaff.reduce((s, m) => s + m.bookings_count, 0);

    if (loading) {
        return <div className="flex items-center justify-center h-64"><Loader2 className="w-8 h-8 text-luxe-gold animate-spin" /></div>;
    }

    return (
        <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
            {/* Header */}
            <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div className="flex items-center gap-3">
                    <div className="p-3 bg-luxe-gold/10 rounded-2xl border border-luxe-gold/20">
                        <Scissors className="w-6 h-6 text-luxe-gold" />
                    </div>
                    <div>
                        <h3 className="text-xl font-bold">Staff Board</h3>
                        <p className="text-xs text-white/40 uppercase tracking-widest">Team Performance & Management</p>
                    </div>
                </div>
                <div className="flex items-center gap-3">
                    <button
                        onClick={() => setShowInactive(!showInactive)}
                        className={`px-4 py-2 rounded-xl text-xs font-bold border transition-all ${showInactive ? 'bg-white/10 border-white/20 text-white' : 'bg-white/5 border-white/10 text-white/40'}`}
                    >
                        {showInactive ? 'Hide Inactive' : `Show Inactive (${inactiveStaff.length})`}
                    </button>
                    <button
                        onClick={() => setShowAddModal(true)}
                        className="bg-gold-gradient text-luxe-obsidian px-6 py-2 rounded-xl font-bold flex items-center gap-2 shadow-lg shadow-luxe-gold/20 hover:scale-[1.02] active:scale-[0.98] transition-all"
                    >
                        <Plus className="w-5 h-5" /> ADD STAFF
                    </button>
                </div>
            </div>

            {/* Summary Stats */}
            <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                <PerformanceStat label="Active Staff" value={String(activeStaff.length)} trend="+1 this month" icon={Scissors} />
                <PerformanceStat label="Total Revenue" value={`$${fmt(totalRev)}`} trend="This month" icon={TrendingUp} />
                <PerformanceStat label="Total Bookings" value={String(totalBookings)} trend="This month" icon={BarChart3} />
                <PerformanceStat label="Top Earner" value={activeStaff.length > 0 ? activeStaff.sort((a, b) => b.revenue - a.revenue)[0].full_name.split(' ')[0] : '—'} trend="🏆" icon={Trophy} />
            </div>

            {/* Staff Table */}
            <div className="glass-panel border border-white/5 overflow-hidden">
                <div className="overflow-x-auto">
                    <table className="w-full">
                        <thead>
                            <tr className="border-b border-white/5 bg-white/[0.02]">
                                <th className="text-left px-6 py-4 text-[10px] font-black text-white/30 uppercase tracking-[0.2em]">Stylist</th>
                                <th className="text-center px-6 py-4 text-[10px] font-black text-white/30 uppercase tracking-[0.2em]">Bookings</th>
                                <th className="text-center px-6 py-4 text-[10px] font-black text-white/30 uppercase tracking-[0.2em]">Revenue</th>
                                <th className="text-center px-6 py-4 text-[10px] font-black text-white/30 uppercase tracking-[0.2em]">Commission %</th>
                                <th className="text-center px-6 py-4 text-[10px] font-black text-white/30 uppercase tracking-[0.2em]">Earned</th>
                                <th className="text-center px-6 py-4 text-[10px] font-black text-white/30 uppercase tracking-[0.2em]">Status</th>
                                <th className="text-center px-6 py-4 text-[10px] font-black text-white/30 uppercase tracking-[0.2em]">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {activeStaff.map((s) => {
                                const commission = s.revenue * (s.commission_rate / 100);
                                return (
                                    <tr key={s.id} className="border-b border-white/5 hover:bg-white/[0.02] transition-colors">
                                        <td className="px-6 py-5">
                                            <div className="flex items-center gap-4">
                                                <div className="w-10 h-10 rounded-xl flex items-center justify-center text-sm font-black border border-white/10" style={{ color: s.color, backgroundColor: `${s.color}15` }}>
                                                    {s.full_name.charAt(0)}
                                                </div>
                                                <div>
                                                    <p className="font-bold text-sm">{s.full_name}</p>
                                                    <p className="text-[10px] text-white/30 uppercase tracking-wider">{s.role}</p>
                                                </div>
                                            </div>
                                        </td>
                                        <td className="px-6 py-5 text-center font-bold text-sm">{s.bookings_count}</td>
                                        <td className="px-6 py-5 text-center font-bold text-sm text-green-400">${s.revenue.toLocaleString(undefined, { maximumFractionDigits: 0 })}</td>
                                        <td className="px-6 py-5 text-center">
                                            <button
                                                onClick={() => openCommModal(s)}
                                                className="font-bold text-sm text-luxe-gold hover:underline cursor-pointer"
                                            >
                                                {s.commission_rate}%
                                            </button>
                                        </td>
                                        <td className="px-6 py-5 text-center font-bold text-sm text-luxe-gold">${commission.toLocaleString(undefined, { maximumFractionDigits: 0 })}</td>
                                        <td className="px-6 py-5 text-center">
                                            {s.is_blocked_today ? (
                                                <span className="text-[9px] font-bold bg-red-500/10 text-red-400 px-3 py-1.5 rounded-full border border-red-500/20">BLOCKED</span>
                                            ) : (
                                                <span className="text-[9px] font-bold bg-green-500/10 text-green-400 px-3 py-1.5 rounded-full border border-green-500/20">ACTIVE</span>
                                            )}
                                        </td>
                                        <td className="px-6 py-5 text-center">
                                            <div className="flex items-center justify-center gap-2">
                                                {s.is_blocked_today ? (
                                                    <button onClick={() => handleUnblock(s.id, s.full_name)} title="Unblock"
                                                        className="p-2 rounded-lg bg-green-500/10 text-green-400 border border-green-500/20 hover:bg-green-500/20 transition-all">
                                                        <Undo2 className="w-4 h-4" />
                                                    </button>
                                                ) : (
                                                    <button onClick={() => handleBlock(s.id, s.full_name)} title="Block Today (Leave/Sick)"
                                                        className="p-2 rounded-lg bg-white/5 text-white/40 hover:text-red-400 hover:bg-red-400/10 transition-all">
                                                        <Ban className="w-4 h-4" />
                                                    </button>
                                                )}
                                                <button onClick={() => openLoginModal(s)} title="Create Login"
                                                    className="p-2 rounded-lg bg-white/5 text-white/40 hover:text-blue-400 hover:bg-blue-400/10 transition-all">
                                                    <Key className="w-4 h-4" />
                                                </button>
                                                <button onClick={() => {
                                                    setChangePwStaff(s);
                                                    setNewPw('');
                                                }} title="Change Password" aria-label="Change Password"
                                                    className="p-2 rounded-lg bg-white/5 text-white/40 hover:text-white hover:bg-white/10 transition-all">
                                                    <Lock className="w-4 h-4" />
                                                </button>
                                                <button onClick={() => setDeactivateTarget(s)} title="Remove Staff"
                                                    className="p-2 rounded-lg bg-white/5 text-white/40 hover:text-red-400 hover:bg-red-400/10 transition-all">
                                                    <UserMinus className="w-4 h-4" />
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                );
                            })}
                        </tbody>
                    </table>
                </div>
            </div>

            {/* Inactive Staff */}
            {showInactive && inactiveStaff.length > 0 && (
                <div className="glass-panel p-6 border border-white/5">
                    <h4 className="font-bold text-sm text-white/50 mb-4 flex items-center gap-2">
                        <UserMinus className="w-4 h-4" /> Inactive Staff
                    </h4>
                    <div className="space-y-3">
                        {inactiveStaff.map(s => (
                            <div key={s.id} className="flex items-center justify-between p-3 bg-white/5 rounded-xl border border-white/10">
                                <div className="flex items-center gap-3">
                                    <div className="w-8 h-8 rounded-lg bg-white/5 flex items-center justify-center text-xs font-bold text-white/40">{s.full_name.charAt(0)}</div>
                                    <div>
                                        <p className="text-sm font-bold text-white/50">{s.full_name}</p>
                                        <p className="text-[10px] text-white/30">{s.role}</p>
                                    </div>
                                </div>
                                <button onClick={() => handleReactivate(s)}
                                    className="px-4 py-2 rounded-xl bg-green-500/10 text-green-400 border border-green-500/20 text-xs font-bold hover:bg-green-500/20 transition-all">
                                    REACTIVATE
                                </button>
                            </div>
                        ))}
                    </div>
                </div>
            )}

            {/* Add Staff Modal */}
            {showAddModal && (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" onClick={() => setShowAddModal(false)}>
                    <div className="bg-luxe-obsidian border border-white/10 rounded-2xl p-8 w-full max-w-lg shadow-2xl" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="text-xl font-bold flex items-center gap-2">
                                <UserPlus className="w-6 h-6 text-luxe-gold" /> Add New Staff
                            </h3>
                            <button onClick={() => setShowAddModal(false)} className="p-2 hover:bg-white/10 rounded-xl transition-all">
                                <X className="w-5 h-5" />
                            </button>
                        </div>
                        <div className="space-y-4">
                            <div>
                                <label className="text-xs font-bold text-white/50 uppercase tracking-wider mb-2 block">Full Name *</label>
                                <input value={aName} onChange={e => setAName(e.target.value)} placeholder="Sarah Johnson"
                                    className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-luxe-gold/50 transition-all" />
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="text-xs font-bold text-white/50 uppercase tracking-wider mb-2 block">Email</label>
                                    <input value={aEmail} onChange={e => setAEmail(e.target.value)} placeholder="sarah@salon.com"
                                        className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-luxe-gold/50 transition-all" />
                                </div>
                                <div>
                                    <label className="text-xs font-bold text-white/50 uppercase tracking-wider mb-2 block">Phone</label>
                                    <input value={aPhone} onChange={e => setAPhone(e.target.value)} placeholder="+1 555-0101"
                                        className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-luxe-gold/50 transition-all" />
                                </div>
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="text-xs font-bold text-white/50 uppercase tracking-wider mb-2 block">Role</label>
                                    <select value={aRole} onChange={e => setARole(e.target.value)}
                                        className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-luxe-gold/50 transition-all">
                                        <option value="stylist">Stylist</option>
                                        <option value="manager">Manager</option>
                                        <option value="nail_tech">Nail Tech</option>
                                        <option value="barber">Barber</option>
                                        <option value="colorist">Colorist</option>
                                    </select>
                                </div>
                                <div>
                                    <label className="text-xs font-bold text-white/50 uppercase tracking-wider mb-2 block">Commission %</label>
                                    <input type="number" value={aComm} onChange={e => setAComm(e.target.value)} min="0" max="100" step="1"
                                        className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-luxe-gold/50 transition-all" />
                                </div>
                            </div>
                        </div>
                        <button onClick={handleAddStaff} disabled={saving || !aName}
                            className="w-full mt-6 bg-gold-gradient text-luxe-obsidian font-bold py-3 rounded-xl shadow-lg shadow-luxe-gold/20 hover:scale-[1.02] active:scale-[0.98] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2">
                            {saving ? <Loader2 className="w-5 h-5 animate-spin" /> : <Plus className="w-5 h-5" />}
                            {saving ? 'ADDING...' : 'ADD STAFF'}
                        </button>
                    </div>
                </div>
            )}

            {/* Commission Modal */}
            {showCommModal && selectedStaff && (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" onClick={() => setShowCommModal(false)}>
                    <div className="bg-luxe-obsidian border border-white/10 rounded-2xl p-8 w-full max-w-md shadow-2xl" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="text-xl font-bold flex items-center gap-2">
                                <Percent className="w-6 h-6 text-luxe-gold" /> Set Commission
                            </h3>
                            <button onClick={() => setShowCommModal(false)} className="p-2 hover:bg-white/10 rounded-xl transition-all">
                                <X className="w-5 h-5" />
                            </button>
                        </div>
                        <p className="text-white/50 text-sm mb-4">Commission rate for <span className="text-white font-bold">{selectedStaff.full_name}</span></p>
                        <div className="flex items-center gap-3">
                            <input type="number" value={commRate} onChange={e => setCommRate(e.target.value)} min="0" max="100" step="1"
                                className="flex-1 bg-white/5 border border-white/10 rounded-xl p-3 text-lg font-bold text-center outline-none focus:border-luxe-gold/50 transition-all" />
                            <span className="text-2xl font-bold text-white/40">%</span>
                        </div>
                        <p className="text-[10px] text-white/30 mt-2">
                            Current revenue: ${selectedStaff.revenue.toLocaleString()} → Earned: ${(selectedStaff.revenue * parseFloat(commRate || '0') / 100).toLocaleString(undefined, { maximumFractionDigits: 0 })}
                        </p>
                        <button onClick={handleUpdateComm} disabled={saving}
                            className="w-full mt-6 bg-gold-gradient text-luxe-obsidian font-bold py-3 rounded-xl shadow-lg shadow-luxe-gold/20 hover:scale-[1.02] active:scale-[0.98] transition-all disabled:opacity-50 flex items-center justify-center gap-2">
                            {saving ? <Loader2 className="w-5 h-5 animate-spin" /> : <CheckCircle2 className="w-5 h-5" />}
                            UPDATE COMMISSION
                        </button>
                    </div>
                </div>
            )}

            {/* Create Login Modal */}
            {showLoginModal && selectedStaff && (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" onClick={() => setShowLoginModal(false)}>
                    <div className="bg-luxe-obsidian border border-white/10 rounded-2xl p-8 w-full max-w-md shadow-2xl" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="text-xl font-bold flex items-center gap-2">
                                <Key className="w-6 h-6 text-luxe-gold" /> Create Staff Login
                            </h3>
                            <button onClick={() => setShowLoginModal(false)} className="p-2 hover:bg-white/10 rounded-xl transition-all">
                                <X className="w-5 h-5" />
                            </button>
                        </div>
                        <p className="text-white/50 text-sm mb-6">
                            Create a dashboard login for <span className="text-white font-bold">{selectedStaff.full_name}</span> so they can access the system.
                        </p>
                        <div className="space-y-4">
                            <div>
                                <label className="text-xs font-bold text-white/50 uppercase tracking-wider mb-2 block">Email *</label>
                                <input value={loginEmail} onChange={e => setLoginEmail(e.target.value)} placeholder="staff@salon.com"
                                    className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-luxe-gold/50 transition-all" />
                            </div>
                            <div>
                                <label className="text-xs font-bold text-white/50 uppercase tracking-wider mb-2 block">Temporary Password *</label>
                                <input type="password" value={loginPassword} onChange={e => setLoginPassword(e.target.value)} placeholder="Min 6 characters"
                                    className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm outline-none focus:border-luxe-gold/50 transition-all" />
                                <p className="text-[10px] text-white/20 mt-1">Staff member should change this on first login</p>
                            </div>
                        </div>
                        <button
                            onClick={handleCreateLogin}
                            disabled={saving || !loginEmail || loginPassword.length < 6}
                            className="w-full mt-6 bg-gold-gradient text-luxe-obsidian font-bold py-3 rounded-xl shadow-lg shadow-luxe-gold/20 hover:scale-[1.02] active:scale-[0.98] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                        >
                            {saving ? <Loader2 className="w-5 h-5 animate-spin" /> : <Key className="w-5 h-5" />}
                            {saving ? 'CREATING...' : 'CREATE LOGIN'}
                        </button>
                    </div>
                </div>
            )}

            {/* Change Password Modal */}
            {changePwStaff && (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in">
                    <div className="w-full max-w-md bg-luxe-obsidian border border-white/10 rounded-2xl p-6 shadow-2xl">
                        <div className="flex items-center justify-between mb-6">
                            <h3 className="text-xl font-bold flex items-center gap-2">
                                <Lock className="w-5 h-5 text-luxe-gold" />
                                Change Password
                            </h3>
                            <button onClick={() => setChangePwStaff(null)} className="text-white/40 hover:text-white transition-colors">
                                <X className="w-5 h-5" />
                            </button>
                        </div>

                        <div className="mb-6">
                            <p className="text-sm text-white/60 mb-4">
                                Setting new password for <span className="text-white font-bold">{changePwStaff.full_name}</span>.
                            </p>

                            <label className="text-[10px] font-bold uppercase tracking-wider text-white/40 mb-2 block">New Password</label>
                            <input
                                type="text"
                                value={newPw}
                                onChange={e => setNewPw(e.target.value)}
                                placeholder="Enter new password"
                                className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-sm outline-none focus:border-luxe-gold/50 transition-all"
                            />
                        </div>

                        <div className="flex justify-end gap-3">
                            <button
                                onClick={() => setChangePwStaff(null)}
                                className="px-4 py-2 rounded-xl text-xs font-bold uppercase tracking-wider text-white/40 hover:bg-white/5 transition-all"
                            >
                                Cancel
                            </button>
                            <button
                                onClick={handleChangePassword}
                                disabled={saving || !newPw}
                                className="px-6 py-2 rounded-xl bg-gold-gradient text-luxe-obsidian text-xs font-bold uppercase tracking-wider hover:shadow-lg hover:shadow-luxe-gold/20 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
                            >
                                {saving ? <Loader2 className="w-4 h-4 animate-spin" /> : 'Update Password'}
                            </button>
                        </div>
                    </div>
                </div>
            )}

            {/* Deactivate Confirmation */}
            <ConfirmModal
                open={!!deactivateTarget}
                title="Deactivate Staff"
                message={`Remove ${deactivateTarget?.full_name} from active staff? They won't appear in booking options but their history will be preserved.`}
                confirmLabel="Deactivate"
                danger
                onConfirm={handleDeactivate}
                onCancel={() => setDeactivateTarget(null)}
            />
        </div>
    );
};

const PerformanceStat: React.FC<{ label: string; value: string; trend: string; icon: React.ElementType }> = ({ label, value, trend, icon: Icon }) => (
    <div className="glass-panel p-6 group hover:gold-border transition-all">
        <div className="flex items-center justify-between mb-4">
            <p className="text-[10px] font-black uppercase tracking-[0.2em] text-white/30">{label}</p>
            <div className="p-2 rounded-xl bg-luxe-gold/10 group-hover:bg-luxe-gold/20 transition-all">
                <Icon className="w-4 h-4 text-luxe-gold" />
            </div>
        </div>
        <p className="text-2xl font-black">{value}</p>
        <p className="text-[10px] text-luxe-gold mt-1 font-bold flex items-center gap-1">
            <ArrowUpRight className="w-3 h-3" /> {trend}
        </p>
    </div>
);

--- FILE: C:\Users\syeda\OneDrive\Desktop\Voxali New\dashboard\src\config\constants.ts ---

/**
 * Central config constants.
 * TENANT_ID is read from .env so it's easy to swap when adding multi-tenant auth later.
 */
export const TENANT_ID: string = import.meta.env.VITE_TENANT_ID ?? ''

/** Commission rate used in the Staff Board */
export const COMMISSION_RATE = 0.15

/** Salon timezone */
export const SALON_TIMEZONE = 'America/Chicago'

--- FILE: C:\Users\syeda\OneDrive\Desktop\Voxali New\dashboard\src\context\AuthContext.tsx ---

import React, { createContext, useContext, useState, useEffect, useRef } from 'react';
import { supabase } from '../lib/supabase';
import { type Session, type User } from '@supabase/supabase-js';

type UserRole = 'owner' | 'manager' | 'staff' | 'receptionist' | 'super_admin';

interface AuthContextType {
    user: User | null;
    session: Session | null;
    profile: Record<string, unknown> | null;
    role: UserRole | null;
    loading: boolean;
    timedOut: boolean;
    isAdmin: boolean;
    isOwner: boolean;
    isSuperAdmin: boolean;
    forceLogout: () => Promise<void>;
}

const AuthContext = createContext<AuthContextType>({
    user: null,
    session: null,
    profile: null,
    role: null,
    loading: true,
    timedOut: false,
    isAdmin: false,
    isOwner: false,
    isSuperAdmin: false,
    forceLogout: async () => { },
});

export const useAuth = () => useContext(AuthContext);

const QUERY_TIMEOUT_MS = 5000;

export const AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
    const [user, setUser] = useState<User | null>(null);
    const [session, setSession] = useState<Session | null>(null);
    const [profile, setProfile] = useState<Record<string, unknown> | null>(null);
    const [role, setRole] = useState<UserRole | null>(null);
    const [loading, setLoading] = useState(true);
    const [timedOut, setTimedOut] = useState(false);
    const mountedRef = useRef(true);

    const forceLogout = async () => {
        localStorage.removeItem('voxali_impersonate_tenant');
        localStorage.removeItem('admin_viewing_tenant');
        localStorage.removeItem('voxali_impersonate_name');
        try { await supabase.auth.signOut(); } catch { /* ignore */ }
        setUser(null);
        setSession(null);
        setProfile(null);
        setRole(null);
        setLoading(false);
        setTimedOut(false);
    };

    // Wrap any promise with a timeout
    function raceTimeout<T>(promise: Promise<T>, ms: number, label: string): Promise<T> {
        let timer: ReturnType<typeof setTimeout>;
        const timeout = new Promise<never>((_, reject) => {
            timer = setTimeout(() => reject(new Error(`${label} timed out after ${ms}ms`)), ms);
        });
        return Promise.race([promise, timeout]).finally(() => clearTimeout(timer));
    }

    // Try to query profile from DB, with timeout. Returns profile data or null.
    const queryProfile = async (userId: string): Promise<Record<string, unknown> | null> => {
        // Try by `id` first
        try {
            const { data, error } = await raceTimeout(
                Promise.resolve(supabase.from('profiles').select('*').eq('id', userId).single()),
                QUERY_TIMEOUT_MS,
                'profiles.id'
            );
            if (data && !error) return data;
        } catch (e) {
            console.warn('[AuthContext] Profile by id:', (e as Error).message);
        }

        // Try by `user_id` as fallback
        try {
            const { data, error } = await raceTimeout(
                Promise.resolve(supabase.from('profiles').select('*').eq('user_id', userId).single()),
                QUERY_TIMEOUT_MS,
                'profiles.user_id'
            );
            if (data && !error) return data;
        } catch (e) {
            console.warn('[AuthContext] Profile by user_id:', (e as Error).message);
        }

        return null;
    };

    // Full profile fetch with email fallback
    const fetchProfile = async (userId: string, userEmail?: string) => {
        try {
            const profileData = await queryProfile(userId);

            if (profileData && mountedRef.current) {
                setProfile(profileData);
                setRole(profileData.role as UserRole);
                return;
            }

            // Database queries failed or timed out — fallback to email
            if (userEmail && mountedRef.current) {
                console.warn('[AuthContext] Using email-based role fallback for:', userEmail);
                const fallbackRole: UserRole = userEmail === 'super@voxali.com' ? 'super_admin' : 'owner';
                setProfile({ id: userId, email: userEmail, role: fallbackRole });
                setRole(fallbackRole);
            } else if (mountedRef.current) {
                setTimedOut(true);
            }
        } catch (err) {
            console.error('[AuthContext] fetchProfile exception:', err);
            if (userEmail && mountedRef.current) {
                const fallbackRole: UserRole = userEmail === 'super@voxali.com' ? 'super_admin' : 'owner';
                setProfile({ id: userId, email: userEmail, role: fallbackRole });
                setRole(fallbackRole);
            } else if (mountedRef.current) {
                setTimedOut(true);
            }
        } finally {
            if (mountedRef.current) {
                setLoading(false);
            }
        }
    };

    // Try to extract user info from Supabase localStorage token (fallback if getSession hangs/errors)
    const recoverFromLocalStorage = (): { id: string; email: string } | null => {
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key && key.startsWith('sb-') && key.endsWith('-auth-token')) {
                try {
                    const raw = localStorage.getItem(key);
                    if (raw) {
                        const parsed = JSON.parse(raw);
                        const u = parsed?.user || parsed?.currentSession?.user;
                        if (u?.id && u?.email) return { id: u.id, email: u.email };
                    }
                } catch { /* skip bad JSON */ }
            }
        }
        return null;
    };

    useEffect(() => {
        mountedRef.current = true;

        const initAuth = async () => {
            try {
                const { data: { session: currentSession } } = await raceTimeout(
                    supabase.auth.getSession(),
                    QUERY_TIMEOUT_MS,
                    'getSession'
                );

                if (!mountedRef.current) return;

                if (currentSession?.user) {
                    setSession(currentSession);
                    setUser(currentSession.user);
                    await fetchProfile(currentSession.user.id, currentSession.user.email);
                } else {
                    setLoading(false);
                }
            } catch (err) {
                console.warn('[AuthContext] getSession failed:', (err as Error).message);
                if (!mountedRef.current) return;

                // Fallback: try recovering from localStorage
                const recovered = recoverFromLocalStorage();
                if (recovered) {
                    console.log('[AuthContext] Recovered user from localStorage:', recovered.email);
                    await fetchProfile(recovered.id, recovered.email);
                } else {
                    setLoading(false);
                }
            }
        };

        initAuth();

        // Listen for auth changes (this may also fail with AbortError — handle gracefully)
        let subscription: { unsubscribe: () => void } | null = null;
        try {
            const { data } = supabase.auth.onAuthStateChange(async (_event, newSession) => {
                if (!mountedRef.current) return;

                if (newSession?.user) {
                    setSession(newSession);
                    setUser(newSession.user);
                    const currentId = profile?.id || profile?.user_id;
                    if (!profile || currentId !== newSession.user.id) {
                        setLoading(true);
                        await fetchProfile(newSession.user.id, newSession.user.email);
                    }
                } else {
                    setSession(null);
                    setUser(null);
                    setProfile(null);
                    setRole(null);
                    setLoading(false);
                }
            });
            subscription = data.subscription;
        } catch (err) {
            console.warn('[AuthContext] onAuthStateChange setup failed:', err);
        }

        return () => {
            mountedRef.current = false;
            subscription?.unsubscribe();
        };
        // eslint-disable-next-line react-hooks/exhaustive-deps
    }, []);

    const value: AuthContextType = {
        user,
        session,
        profile,
        role,
        loading,
        timedOut,
        isAdmin: role === 'owner' || role === 'manager',
        isOwner: role === 'owner',
        isSuperAdmin: role === 'super_admin',
        forceLogout,
    };

    return (
        <AuthContext.Provider value={value}>
            {children}
        </AuthContext.Provider>
    );
};

--- FILE: C:\Users\syeda\OneDrive\Desktop\Voxali New\dashboard\src\context\TenantContext.tsx ---

import React, { createContext, useContext, useState, useEffect, useCallback } from 'react';
import { supabase } from '../lib/supabase';
import { TENANT_ID } from '../config/constants';

interface TenantBranding {
    salonName: string;
    salonTagline: string;
    logoUrl: string | null;
    ownerName: string;
}

interface TenantContextType extends TenantBranding {
    loading: boolean;
    updateBranding: (updates: Partial<TenantBranding>) => Promise<boolean>;
    refetch: () => Promise<void>;
}

const defaults: TenantBranding = {
    salonName: 'My Salon',
    salonTagline: 'Salon & Spa',
    logoUrl: null,
    ownerName: 'Owner',
};

const TenantContext = createContext<TenantContextType>({
    ...defaults,
    loading: true,
    updateBranding: async () => false,
    refetch: async () => { },
});

export const useTenant = () => useContext(TenantContext);

export const TenantProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
    const [branding, setBranding] = useState<TenantBranding>(defaults);
    const [loading, setLoading] = useState(true);

    const fetchBranding = useCallback(async () => {
        if (!TENANT_ID) { setLoading(false); return; }
        const { data, error } = await supabase
            .from('tenants')
            .select('salon_name, salon_tagline, logo_url, owner_name, name')
            .eq('id', TENANT_ID)
            .single();

        if (!error && data) {
            setBranding({
                salonName: data.salon_name || data.name || defaults.salonName,
                salonTagline: data.salon_tagline || defaults.salonTagline,
                logoUrl: data.logo_url || null,
                ownerName: data.owner_name || defaults.ownerName,
            });
        }
        setLoading(false);
    }, []);

    useEffect(() => { fetchBranding(); }, [fetchBranding]);

    const updateBranding = useCallback(async (updates: Partial<TenantBranding>): Promise<boolean> => {
        if (!TENANT_ID) return false;
        const { data, error } = await supabase.rpc('rpc_update_branding', {
            p_tenant_id: TENANT_ID,
            p_salon_name: updates.salonName ?? null,
            p_salon_tagline: updates.salonTagline ?? null,
            p_logo_url: updates.logoUrl ?? null,
            p_owner_name: updates.ownerName ?? null,
        });
        if (!error && data?.success) {
            setBranding(prev => ({ ...prev, ...updates }));
            return true;
        }
        return false;
    }, []);

    return (
        <TenantContext.Provider value={{ ...branding, loading, updateBranding, refetch: fetchBranding }}>
            {children}
        </TenantContext.Provider>
    );
};

--- FILE: C:\Users\syeda\OneDrive\Desktop\Voxali New\dashboard\src\lib\supabase.ts ---

import { createClient, SupabaseClient } from '@supabase/supabase-js'

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL || ''
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY || ''

let supabase: SupabaseClient

if (!supabaseUrl || !supabaseAnonKey || supabaseAnonKey === 'YOUR_ANON_KEY_HERE') {
    console.warn(
        '⚠️ Supabase env vars not set. Dashboard will show empty data. ' +
        'Fill in VITE_SUPABASE_URL, VITE_SUPABASE_ANON_KEY, and VITE_TENANT_ID in dashboard/.env, then restart the dev server.'
    )
    // Create a dummy client pointing to a placeholder — all queries will fail gracefully
    supabase = createClient('https://placeholder.supabase.co', 'placeholder-key')
} else {
    supabase = createClient(supabaseUrl, supabaseAnonKey)
}

export { supabase }

--- FILE: C:\Users\syeda\OneDrive\Desktop\Voxali New\dashboard\src\App.css ---

#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}

--- FILE: C:\Users\syeda\OneDrive\Desktop\Voxali New\dashboard\src\App.tsx ---

import { useState, useEffect, useCallback } from 'react'
import { Sidebar } from './components/Sidebar'
import { DashboardHome } from './components/DashboardHome'
import { BookingsCalendar } from './components/BookingsCalendar'
import { ClientCRM } from './components/ClientCRM'
import { StaffBoard } from './components/StaffBoard'
import { CallLogs } from './components/CallLogs'
import { Analytics } from './components/Analytics'
import { Marketing } from './components/Marketing'
import { BellaAI } from './components/BellaAI'
import { Settings } from './components/Settings'
import { LoginPage } from './components/LoginPage'
import { TenantProvider, useTenant } from './context/TenantContext'
import { AuthProvider, useAuth } from './context/AuthContext'
import { ToastProvider } from './components/ui/ToastNotification'
import { SuperAdminLayout } from './components/SuperAdmin/SuperAdminLayout'
import { ArrowLeft, AlertTriangle, LogOut, Loader2 } from 'lucide-react'

// ─── Floating "Back to Admin" bar for impersonation ───
function ImpersonationBar() {
  const isImpersonating = localStorage.getItem('admin_viewing_tenant') === 'true'

  if (!isImpersonating) return null

  const handleExit = () => {
    localStorage.removeItem('voxali_impersonate_tenant')
    localStorage.removeItem('admin_viewing_tenant')
    localStorage.removeItem('voxali_impersonate_name')
    window.location.reload()
  }

  return (
    <div className="fixed top-0 left-0 right-0 z-[9999] bg-sa-accent text-white px-4 py-2 flex items-center justify-between shadow-lg">
      <div className="flex items-center gap-2 text-sm font-semibold">
        <AlertTriangle className="w-4 h-4" />
        You are viewing a tenant's dashboard as Super Admin
      </div>
      <button
        onClick={handleExit}
        className="flex items-center gap-2 px-4 py-1.5 bg-white/20 hover:bg-white/30 rounded-lg text-sm font-bold transition-all"
      >
        <ArrowLeft className="w-4 h-4" />
        Back to Admin Panel
      </button>
    </div>
  )
}

// ─── Error/Timeout screen ───
function AuthErrorScreen() {
  const { forceLogout } = useAuth()

  const handleClear = async () => {
    // Nuclear clear: remove ALL supabase keys from localStorage
    const keysToRemove: string[] = []
    for (let i = 0; i < localStorage.length; i++) {
      const key = localStorage.key(i)
      if (key && (key.startsWith('sb-') || key.includes('supabase') || key.includes('voxali'))) {
        keysToRemove.push(key)
      }
    }
    keysToRemove.forEach(k => localStorage.removeItem(k))
    await forceLogout()
    window.location.reload()
  }

  return (
    <div className="flex h-screen bg-sa-midnight items-center justify-center">
      <div className="text-center space-y-6 max-w-md px-8">
        <div className="w-16 h-16 rounded-full bg-red-500/10 border border-red-500/20 flex items-center justify-center mx-auto">
          <AlertTriangle className="w-8 h-8 text-red-400" />
        </div>
        <div>
          <h2 className="text-xl font-bold text-sa-platinum mb-2">Connection Failed</h2>
          <p className="text-sa-muted text-sm">
            Could not load your profile. This usually happens due to stale session data or a network issue.
          </p>
        </div>
        <button
          onClick={handleClear}
          className="inline-flex items-center gap-2 px-6 py-3 bg-red-500/20 text-red-400 border border-red-500/30 rounded-xl font-semibold hover:bg-red-500/30 transition-all"
        >
          <LogOut className="w-4 h-4" />
          Clear Session & Retry
        </button>
      </div>
    </div>
  )
}

function AppContent() {
  const [activeTab, setActiveTab] = useState('dashboard')
  const [isDarkMode, setIsDarkMode] = useState(true)
  const { salonName, ownerName } = useTenant()
  const { user, role, loading: authLoading, timedOut, forceLogout } = useAuth()

  useEffect(() => {
    if (isDarkMode) {
      document.documentElement.classList.add('dark')
    } else {
      document.documentElement.classList.remove('dark')
    }
  }, [isDarkMode])

  const handleLogout = useCallback(async () => {
    // Nuclear clear all supabase localStorage
    const keysToRemove: string[] = []
    for (let i = 0; i < localStorage.length; i++) {
      const key = localStorage.key(i)
      if (key && (key.startsWith('sb-') || key.includes('supabase') || key.includes('voxali'))) {
        keysToRemove.push(key)
      }
    }
    keysToRemove.forEach(k => localStorage.removeItem(k))
    await forceLogout()
  }, [forceLogout])

  // ─── Auth is still loading ───
  if (authLoading) {
    return (
      <div className="flex h-screen bg-luxe-obsidian items-center justify-center flex-col gap-4">
        <Loader2 className="w-8 h-8 text-luxe-gold animate-spin" />
        <p className="text-white/40 text-sm">Loading your profile...</p>
      </div>
    )
  }

  // ─── Timed out or errored ───
  if (timedOut) {
    return <AuthErrorScreen />
  }

  // ─── Not logged in — show login ───
  if (!user) {
    return <LoginPage onLogin={() => {
      // After login, the auth state change will trigger and set user
      // Force a reload to ensure clean state
      window.location.reload()
    }} />
  }

  // ─── No role found (profile error) → show error ───
  if (!role) {
    return <AuthErrorScreen />
  }

  // ─── Super Admin gets separate layout ───
  // But NOT if they're impersonating a tenant
  const isImpersonating = localStorage.getItem('admin_viewing_tenant') === 'true'

  if (role === 'super_admin' && !isImpersonating) {
    return <SuperAdminLayout />
  }

  // ─── Salon Dashboard (normal users OR impersonating super admin) ───
  const tabTitles: Record<string, string> = {
    dashboard: 'Dashboard',
    bookings: 'Bookings',
    clients: 'Clients',
    stylists: 'Stylists',
    analytics: 'Analytics',
    calls: 'Call Logs',
    marketing: 'Marketing',
    bella: 'Bella AI',
    settings: 'Settings',
  }

  return (
    <>
      {/* Impersonation bar at top */}
      <ImpersonationBar />

      <div className={`flex h-screen bg-luxe-obsidian text-luxe-white overflow-hidden ${isImpersonating ? 'pt-10' : ''}`}>
        <Sidebar
          activeTab={activeTab}
          setActiveTab={setActiveTab}
          isDarkMode={isDarkMode}
          toggleTheme={() => setIsDarkMode(!isDarkMode)}
          onLogout={handleLogout}
        />

        <main className="flex-1 overflow-y-auto custom-scrollbar relative">
          <div className="p-8 max-w-7xl mx-auto">
            {/* Header */}
            <header className="flex justify-between items-center mb-8">
              <div>
                <h2 className="text-3xl font-bold gold-text">{tabTitles[activeTab] ?? activeTab}</h2>
                <p className="text-white/40 mt-1">Welcome back to {salonName} Dashboard</p>
              </div>

              <div className="flex items-center gap-4">
                <div className="flex items-center gap-2 bg-green-500/10 text-green-500 px-4 py-2 rounded-full border border-green-500/20">
                  <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse" />
                  <span className="text-xs font-bold uppercase tracking-wider">Bella AI: Online</span>
                </div>
                <div className="flex items-center gap-3 bg-white/5 p-1 pr-4 rounded-full border border-white/10">
                  <div className="w-10 h-10 rounded-full bg-gold-gradient flex items-center justify-center text-luxe-obsidian font-bold">
                    {ownerName.charAt(0)}
                  </div>
                  <div>
                    <p className="text-xs font-bold">{ownerName} (Owner)</p>
                    <p className="text-[10px] text-white/40">{salonName}</p>
                  </div>
                </div>
              </div>
            </header>

            {/* Dynamic Content Area */}
            <div className="space-y-6 flex-1 flex flex-col h-full">
              {activeTab === 'dashboard' && <DashboardHome setActiveTab={setActiveTab} />}
              {activeTab === 'bookings' && <BookingsCalendar />}
              {activeTab === 'clients' && <ClientCRM />}
              {activeTab === 'stylists' && <StaffBoard />}
              {activeTab === 'analytics' && <Analytics />}
              {activeTab === 'calls' && <CallLogs />}
              {activeTab === 'marketing' && <Marketing />}
              {activeTab === 'bella' && <BellaAI />}
              {activeTab === 'settings' && <Settings />}
            </div>
          </div>
        </main>
      </div>
    </>
  )
}

function App() {
  return (
    <TenantProvider>
      <AuthProvider>
        <ToastProvider>
          <AppContent />
        </ToastProvider>
      </AuthProvider>
    </TenantProvider>
  )
}

export default App

--- FILE: C:\Users\syeda\OneDrive\Desktop\Voxali New\dashboard\src\index.css ---

@import "tailwindcss";

@theme {
  --color-luxe-obsidian: #0D0D0D;
  --color-luxe-obsidian-light: #1A1A1A;
  --color-luxe-gold: #D4AF37;
  --color-luxe-gold-muted: rgba(212, 175, 55, 0.1);
  --color-luxe-white: #F5F5F7;
  --color-luxe-glass: rgba(255, 255, 255, 0.03);

  --font-sans: 'Outfit', 'Inter', ui-sans-serif, system-ui, sans-serif;

  --background-image-gold-gradient: linear-gradient(135deg, #D4AF37 0%, #B8860B 100%);

  /* Super Admin Theme */
  --color-sa-midnight: #0B1120;
  --color-sa-navy: #111827;
  --color-sa-slate: #1E293B;
  --color-sa-platinum: #E2E8F0;
  --color-sa-muted: #94A3B8;
  --color-sa-accent: #60A5FA;
  --color-sa-accent-glow: rgba(96, 165, 250, 0.15);
  --color-sa-accent-dark: #3B82F6;
  --color-sa-border: rgba(148, 163, 184, 0.1);
  --background-image-sa-gradient: linear-gradient(135deg, #60A5FA 0%, #3B82F6 100%);
}

@layer base {
  :root {
    color-scheme: dark light;
  }

  body {
    @apply bg-luxe-obsidian text-luxe-white font-sans antialiased;
  }
}

@layer components {
  .glass-panel {
    @apply bg-luxe-glass backdrop-blur-md border border-white/5 rounded-2xl;
  }

  .gold-text {
    @apply text-transparent bg-clip-text bg-gold-gradient;
  }

  .gold-border {
    @apply border-luxe-gold/20 hover:border-luxe-gold/50 transition-colors;
  }

  /* Custom scrollbar for premium look */
  .custom-scrollbar::-webkit-scrollbar {
    width: 6px;
  }

  .custom-scrollbar::-webkit-scrollbar-track {
    background: transparent;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb {
    @apply bg-white/10 rounded-full hover:bg-white/20 transition-colors;
  }

  /* Fix native select/option dropdowns in dark theme */
  select,
  select option {
    background-color: #1A1A1A;
    color: #F5F5F7;
  }

  select option:checked {
    background-color: rgba(212, 175, 55, 0.3);
  }

  select option:hover {
    background-color: rgba(255, 255, 255, 0.1);
  }

  /* Ensure all form inputs have readable text */
  input,
  textarea,
  select {
    color-scheme: dark;
  }
}

--- FILE: C:\Users\syeda\OneDrive\Desktop\Voxali New\dashboard\src\main.tsx ---

import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.tsx'

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <App />
  </StrictMode>,
)
